
<!-- saved from url=(0084)https://raytracing.github.io/books/RayTracingInOneWeekend.html#metal/fuzzyreflection -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=600, initial-scale=1"><style>body{max-width:680px;margin:auto;padding:20px;text-align:justify;line-height:140%;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-smoothing:antialiased;color:#222;font-family:Palatino,Georgia,"Times New Roman",serif}</style><style>@media print{*{-webkit-print-color-adjust:exact;text-shadow:none !important}}body{counter-reset: h1 paragraph line item list-item}@page{margin:0;size:auto}#mdContextMenu{position:absolute;background:#383838;cursor:default;border:1px solid #999;color:#fff;padding:4px 0px;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,"Helvetica Neue",sans-serif;font-size:85%;font-weight:600;border-radius:4px;box-shadow:0px 3px 10px rgba(0,0,0,35%)}#mdContextMenu div{padding:0px 20px}#mdContextMenu div:hover{background:#1659d1}.md code,.md pre{font-family:Menlo,Consolas,monospace;font-size:93%;text-align:left;line-height:140%}.md .mediumToc code,.md longToc code,.md .shortToc code,.md h1 code,.md h2 code,.md h3 code,.md h4 code,.md h5 code,.md h6 code{font-size:unset}.md div.title{font-size:26px;font-weight:800;line-height:120%;text-align:center}.md div.afterTitles{height:10px}.md div.subtitle{text-align:center}.md iframe.textinsert, .md object.textinsert,.md iframe:not(.markdeep){display:block;margin-top:10px;margin-bottom:10px;width:100%;height:75vh;border:1px solid #000;border-radius:4px;background:#f5f5f4}.md .image{display:inline-block}.md img{max-width:100%;page-break-inside:avoid}.md li{text-align:left;text-indent:0}.md pre.listing {width:100%;tab-size:4;-moz-tab-size:4;-o-tab-size:4;counter-reset:line;overflow-x:auto;resize:horizontal}.md pre.listing .linenumbers span.line:before{width:30px;margin-left:-28px;font-size:80%;text-align:right;counter-increment:line;content:counter(line);display:inline-block;padding-right:13px;margin-right:8px;color:#ccc}.md div.tilde{margin:20px 0 -10px;text-align:center}.md .imagecaption,.md .tablecaption,.md .listingcaption{display:inline-block;margin:7px 5px 12px;text-align:justify;font-style:italic}.md img.pixel{image-rendering:-moz-crisp-edges;image-rendering:pixelated}.md blockquote.fancyquote{margin:25px 0 25px;text-align:left;line-height:160%}.md blockquote.fancyquote::before{content:"“";color:#DDD;font-family:Times New Roman;font-size:45px;line-height:0;margin-right:6px;vertical-align:-0.3em}.md span.fancyquote{font-size:118%;color:#777;font-style:italic}.md span.fancyquote::after{content:"”";font-style:normal;color:#DDD;font-family:Times New Roman;font-size:45px;line-height:0;margin-left:6px;vertical-align:-0.3em}.md blockquote.fancyquote .author{width:100%;margin-top:10px;display:inline-block;text-align:right}.md small{font-size:60%}.md big{font-size:150%}.md div.title,contents,.md .tocHeader,.md h1,.md h2,.md h3,.md h4,.md h5,.md h6,.md .shortTOC,.md .mediumTOC,.nonumberh1,.nonumberh2,.nonumberh3,.nonumberh4,.nonumberh5,.nonumberh6{font-family:Verdana,Helvetica,Arial,sans-serif;margin:13.4px 0 13.4px;padding:15px 0 3px;border-top:none;clear:both}.md .tocTop {display:none}.md h1,.md h2,.md h3,.md h4,.md h5,.md h6,.md .nonumberh1,.md .nonumberh2,.md .nonumberh3,.md .nonumberh4,.md .nonumberh5,.md .nonumberh6{page-break-after:avoid;break-after:avoid}.md svg.diagram{display:block;font-family:Menlo,Consolas,monospace;font-size:93%;text-align:center;stroke-linecap:round;stroke-width:2px;page-break-inside:avoid;stroke:#000;fill:#000}.md svg.diagram .opendot{fill:#fff}.md svg.diagram .shadeddot{fill:#CCC}.md svg.diagram .dotteddot{stroke:#000;stroke-dasharray:4;fill:none}.md svg.diagram text{stroke:none}@media print{@page{margin:1in 5mm;transform: scale(150%)}}@media print{.md .pagebreak{page-break-after:always;visibility:hidden}}.md a{font-family:Georgia,Palatino,'Times New Roman'}.md h1,.md .tocHeader,.md .nonumberh1{border-bottom:3px solid;font-size:20px;font-weight:bold;}.md h1,.md .nonumberh1{counter-reset:h2 h3 h4 h5 h6}.md h2,.md .nonumberh2{counter-reset:h3 h4 h5 h6;border-bottom:2px solid #999;color:#555;font-weight:bold;font-size:18px;}.md h3,.md h4,.md h5,.md h6,.md .nonumberh3,.md .nonumberh4,.md .nonumberh5,.md .nonumberh6{font-family:Verdana,Helvetica,Arial,sans-serif;color:#555;font-size:16px;}.md h3{counter-reset:h4 h5 h6}.md h4{counter-reset:h5 h6}.md h5{counter-reset:h6}.md div.table{margin:16px 0 16px 0}.md table{border-collapse:collapse;line-height:140%;page-break-inside:avoid}.md table.table{margin:auto}.md table.calendar{width:100%;margin:auto;font-size:11px;font-family:Verdana,Helvetica,Arial,sans-serif}.md table.calendar th{font-size:16px}.md .today{background:#ECF8FA}.md .calendar .parenthesized{color:#999;font-style:italic}.md table.table th{color:#FFF;background-color:#AAA;border:1px solid #888;padding:8px 15px 8px 15px}.md table.table td{padding:5px 15px 5px 15px;border:1px solid #888}.md table.table tr:nth-child(even){background:#EEE}.md pre.tilde{border-top: 1px solid #CCC;border-bottom: 1px solid #CCC;padding: 5px 0 5px 20px;margin:0 0 0 0;background:#FCFCFC;page-break-inside:avoid}.md a.target{width:0px;height:0px;visibility:hidden;font-size:0px;display:inline-block}.md a:link, .md a:visited{color:#38A;text-decoration:none}.md a:link:hover{text-decoration:underline}.md dt{font-weight:700}.md dl>dd{margin-top:-8px; margin-bottom:8px}.md dl>table{margin:35px 0 30px}.md code{page-break-inside:avoid;} @media print{.md .listing code{white-space:pre-wrap}}.md .endnote{font-size:13px;line-height:15px;padding-left:10px;text-indent:-10px}.md .bib{padding-left:80px;text-indent:-80px;text-align:left}.markdeepFooter{font-size:9px;text-align:right;padding-top:80px;color:#999}.md .mediumTOC{float:right;font-size:12px;line-height:15px;border-left:1px solid #CCC;padding-left:15px;margin:15px 0px 15px 25px}.md .mediumTOC .level1{font-weight:600}.md .longTOC .level1{font-weight:600;display:block;padding-top:12px;margin:0 0 -20px}.md .shortTOC{text-align:center;font-weight:bold;margin-top:15px;font-size:14px}.md .admonition{position:relative;margin:1em 0;padding:.4rem 1rem;border-radius:.2rem;border-left:2.5rem solid rgba(68,138,255,.4);background-color:rgba(68,138,255,.15);}.md .admonition-title{font-weight:bold;border-bottom:solid 1px rgba(68,138,255,.4);padding-bottom:4px;margin-bottom:4px;margin-left: -1rem;padding-left:1rem;margin-right:-1rem;border-color:rgba(68,138,255,.4)}.md .admonition.tip{border-left:2.5rem solid rgba(50,255,90,.4);background-color:rgba(50,255,90,.15)}.md .admonition.tip::before{content:"\24d8";font-weight:bold;font-size:150%;position:relative;top:3px;color:rgba(26,128,46,.8);left:-2.95rem;display:block;width:0;height:0}.md .admonition.tip>.admonition-title{border-color:rgba(50,255,90,.4)}.md .admonition.warn,.md .admonition.warning{border-left:2.5rem solid rgba(255,145,0,.4);background-color:rgba(255,145,0,.15)}.md .admonition.warn::before,.md .admonition.warning::before{content:"\26A0";font-weight:bold;font-size:150%;position:relative;top:2px;color:rgba(128,73,0,.8);left:-2.95rem;display:block;width:0;height:0}.md .admonition.warn>.admonition-title,.md .admonition.warning>.admonition-title{border-color:rgba(255,145,0,.4)}.md .admonition.error{border-left: 2.5rem solid rgba(255,23,68,.4);background-color:rgba(255,23,68,.15)}.md .admonition.error>.admonition-title{border-color:rgba(255,23,68,.4)}.md .admonition.error::before{content: "\2612";font-family:"Arial";font-size:200%;position:relative;color:rgba(128,12,34,.8);top:-2px;left:-3rem;display:block;width:0;height:0}.md .admonition p:last-child{margin-bottom:0}.md li.checked,.md li.unchecked{list-style:none;overflow:visible;text-indent:-1.2em}.md li.checked:before,.md li.unchecked:before{content:"\2611";display:block;float:left;width:1em;font-size:120%}.md li.unchecked:before{content:"\2610"}</style><style>.md h1::before {
content:counter(h1) " ";
counter-increment: h1;margin-right:10px}

.md h2::before {
content:counter(h1) "."counter(h2) " ";
counter-increment: h2;margin-right:10px}

.md h3::before {
content:counter(h1) "."counter(h2) "."counter(h3) " ";
counter-increment: h3;margin-right:10px}

.md h4::before {
content:counter(h1) "."counter(h2) "."counter(h3) "."counter(h4) " ";
counter-increment: h4;margin-right:10px}

.md h5::before {
content:counter(h1) "."counter(h2) "."counter(h3) "."counter(h4) "."counter(h5) " ";
counter-increment: h5;margin-right:10px}

.md h6::before {
content:counter(h1) "."counter(h2) "."counter(h3) "."counter(h4) "."counter(h5) "."counter(h6) " ";
counter-increment: h6;margin-right:10px}

</style><style>.hljs{display:block;overflow-x:auto;padding:0.5em;background:#fff;color:#000;-webkit-text-size-adjust:none}.hljs-comment{color:#006a00}.hljs-keyword{color:#02E}.hljs-literal,.nginx .hljs-title{color:#aa0d91}.method,.hljs-list .hljs-title,.hljs-tag .hljs-title,.setting .hljs-value,.hljs-winutils,.tex .hljs-command,.http .hljs-title,.hljs-request,.hljs-status,.hljs-name{color:#008}.hljs-envvar,.tex .hljs-special{color:#660}.hljs-string{color:#c41a16}.hljs-tag .hljs-value,.hljs-cdata,.hljs-filter .hljs-argument,.hljs-attr_selector,.apache .hljs-cbracket,.hljs-date,.hljs-regexp{color:#080}.hljs-sub .hljs-identifier,.hljs-pi,.hljs-tag,.hljs-tag .hljs-keyword,.hljs-decorator,.ini .hljs-title,.hljs-shebang,.hljs-prompt,.hljs-hexcolor,.hljs-rule .hljs-value,.hljs-symbol,.hljs-symbol .hljs-string,.hljs-number,.css .hljs-function,.hljs-function .hljs-title,.coffeescript .hljs-attribute{color:#A0C}.hljs-function .hljs-title{font-weight:bold;color:#000}.hljs-class .hljs-title,.smalltalk .hljs-class,.hljs-type,.hljs-typename,.hljs-tag .hljs-attribute,.hljs-doctype,.hljs-class .hljs-id,.hljs-built_in,.setting,.hljs-params,.clojure .hljs-attribute{color:#5c2699}.hljs-variable{color:#3f6e74}.css .hljs-tag,.hljs-rule .hljs-property,.hljs-pseudo,.hljs-subst{color:#000}.css .hljs-class,.css .hljs-id{color:#9b703f}.hljs-value .hljs-important{color:#ff7700;font-weight:bold}.hljs-rule .hljs-keyword{color:#c5af75}.hljs-annotation,.apache .hljs-sqbracket,.nginx .hljs-built_in{color:#9b859d}.hljs-preprocessor,.hljs-preprocessor *,.hljs-pragma{color:#643820}.tex .hljs-formula{background-color:#eee;font-style:italic}.diff .hljs-header,.hljs-chunk{color:#808080;font-weight:bold}.diff .hljs-change{background-color:#bccff9}.hljs-addition{background-color:#baeeba}.hljs-deletion{background-color:#ffc8bd}.hljs-comment .hljs-doctag{font-weight:bold}.method .hljs-id{color:#000}</style><style>div.title { padding-top: 40px; } div.afterTitles { height: 15px; }</style>
<!-- Markdeep: https://casual-effects.com/markdeep/ -->



                                   <script type="text/javascript" src="./Ray Tracing in One Weekend_files/MathJax.js.下载"></script><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 2px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 2px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: 1em}
.MathJax_MenuRadioCheck.RTL {right: 1em; left: auto}
.MathJax_MenuLabel {padding: 2px 2em 4px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #CCCCCC; margin: 4px 1px 0px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: Highlight; color: HighlightText}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover, .MJXp-munder {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > *, .MJXp-munder > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style type="text/css">.MathJax_Display {text-align: center; margin: 1em 0em; position: relative; display: block!important; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%}
.MathJax .merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MathJax .MJX-monospace {font-family: monospace}
.MathJax .MJX-sans-serif {font-family: sans-serif}
#MathJax_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true'); padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.MathJax {display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0}
.MathJax:focus, body :focus .MathJax {display: inline-table}
.MathJax.MathJax_FullWidth {text-align: center; display: table-cell!important; width: 10000em!important}
.MathJax img, .MathJax nobr, .MathJax a {border: 0; padding: 0; margin: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; vertical-align: 0; line-height: normal; text-decoration: none}
img.MathJax_strut {border: 0!important; padding: 0!important; margin: 0!important; vertical-align: 0!important}
.MathJax span {display: inline; position: static; border: 0; padding: 0; margin: 0; vertical-align: 0; line-height: normal; text-decoration: none; box-sizing: content-box}
.MathJax nobr {white-space: nowrap!important}
.MathJax img {display: inline!important; float: none!important}
.MathJax * {transition: none; -webkit-transition: none; -moz-transition: none; -ms-transition: none; -o-transition: none}
.MathJax_Processing {visibility: hidden; position: fixed; width: 0; height: 0; overflow: hidden}
.MathJax_Processed {display: none!important}
.MathJax_test {font-style: normal; font-weight: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-transform: none; letter-spacing: normal; word-spacing: normal; overflow: hidden; height: 1px}
.MathJax_test.mjx-test-display {display: table!important}
.MathJax_test.mjx-test-inline {display: inline!important; margin-right: -1px}
.MathJax_test.mjx-test-default {display: block!important; clear: both}
.MathJax_ex_box {display: inline-block!important; position: absolute; overflow: hidden; min-height: 0; max-height: none; padding: 0; border: 0; margin: 0; width: 1px; height: 60ex}
.MathJax_em_box {display: inline-block!important; position: absolute; overflow: hidden; min-height: 0; max-height: none; padding: 0; border: 0; margin: 0; width: 1px; height: 60em}
.mjx-test-inline .MathJax_left_box {display: inline-block; width: 0; float: left}
.mjx-test-inline .MathJax_right_box {display: inline-block; width: 0; float: right}
.mjx-test-display .MathJax_right_box {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0}
.MathJax .MathJax_HitBox {cursor: text; background: white; opacity: 0; filter: alpha(opacity=0)}
.MathJax .MathJax_HitBox * {filter: none; opacity: 1; background: transparent}
#MathJax_Tooltip * {filter: none; opacity: 1; background: transparent}
@font-face {font-family: MathJax_Main; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/woff/MathJax_Main-Regular.woff?V=2.7.6') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/otf/MathJax_Main-Regular.otf?V=2.7.6') format('opentype')}
@font-face {font-family: MathJax_Main-bold; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/woff/MathJax_Main-Bold.woff?V=2.7.6') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/otf/MathJax_Main-Bold.otf?V=2.7.6') format('opentype')}
@font-face {font-family: MathJax_Main-italic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/woff/MathJax_Main-Italic.woff?V=2.7.6') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/otf/MathJax_Main-Italic.otf?V=2.7.6') format('opentype')}
@font-face {font-family: MathJax_Math-italic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/woff/MathJax_Math-Italic.woff?V=2.7.6') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/otf/MathJax_Math-Italic.otf?V=2.7.6') format('opentype')}
@font-face {font-family: MathJax_Caligraphic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/woff/MathJax_Caligraphic-Regular.woff?V=2.7.6') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/otf/MathJax_Caligraphic-Regular.otf?V=2.7.6') format('opentype')}
@font-face {font-family: MathJax_Size1; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/woff/MathJax_Size1-Regular.woff?V=2.7.6') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/otf/MathJax_Size1-Regular.otf?V=2.7.6') format('opentype')}
@font-face {font-family: MathJax_Size2; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/woff/MathJax_Size2-Regular.woff?V=2.7.6') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/otf/MathJax_Size2-Regular.otf?V=2.7.6') format('opentype')}
@font-face {font-family: MathJax_Size3; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/woff/MathJax_Size3-Regular.woff?V=2.7.6') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/otf/MathJax_Size3-Regular.otf?V=2.7.6') format('opentype')}
@font-face {font-family: MathJax_Size4; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/woff/MathJax_Size4-Regular.woff?V=2.7.6') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/otf/MathJax_Size4-Regular.otf?V=2.7.6') format('opentype')}
.MathJax .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style type="text/css">@font-face {font-family: MathJax_AMS; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/woff/MathJax_AMS-Regular.woff?V=2.7.6') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/fonts/HTML-CSS/TeX/otf/MathJax_AMS-Regular.otf?V=2.7.6') format('opentype')}
</style></head><body style="visibility: visible;" id="md" class="scrolled"><div style="visibility: hidden; overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal;"><div id="MathJax_Hidden"><br></div></div><div id="MathJax_Message" style="display: none;"></div><script type="text/x-mathjax-config;executed=true">MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "AMS"} } });</script><span style="display:none"><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot; /&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1" style="width: 0em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(3.853em, 1000em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mrow" id="MathJax-Span-2"></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.128em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-1">\newcommand{\n}{\hat{n}}\newcommand{\thetai}{\theta_\mathrm{i}}\newcommand{\thetao}{\theta_\mathrm{o}}\newcommand{\d}[1]{\mathrm{d}#1}\newcommand{\w}{\hat{\omega}}\newcommand{\wi}{\w_\mathrm{i}}\newcommand{\wo}{\w_\mathrm{o}}\newcommand{\wh}{\w_\mathrm{h}}\newcommand{\Li}{L_\mathrm{i}}\newcommand{\Lo}{L_\mathrm{o}}\newcommand{\Le}{L_\mathrm{e}}\newcommand{\Lr}{L_\mathrm{r}}\newcommand{\Lt}{L_\mathrm{t}}\newcommand{\O}{\mathrm{O}}\newcommand{\degrees}{{^{\large\circ}}}\newcommand{\T}{\mathsf{T}}\newcommand{\mathset}[1]{\mathbb{#1}}\newcommand{\Real}{\mathset{R}}\newcommand{\Integer}{\mathset{Z}}\newcommand{\Boolean}{\mathset{B}}\newcommand{\Complex}{\mathset{C}}\newcommand{\un}[1]{\,\mathrm{#1}}</script>
</span>
<span class="md"><p><title>Ray Tracing in One Weekend</title></p><div class="title"> Ray Tracing in One Weekend </div>

<div class="subtitle"> <a href="https://github.com/petershirley">Peter Shirley</a> </div>
<div class="subtitle"> edited by <a href="https://github.com/hollasch">Steve Hollasch</a> and <a href="https://github.com/trevordblack">Trevor David Black</a> </div>
<div class="subtitle"> <br> </div>
<div class="subtitle"> Version 3.2.3, 2020-12-07 </div>
<div class="subtitle"> <br> </div>
<div class="subtitle"> Copyright 2018-2020 Peter Shirley. All rights reserved. </div>
<div class="afterTitles"></div>

<p></p>
<div class="longTOC"><div class="tocHeader">Contents</div><p><a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#" class="tocTop">(Top)</a><br>
<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#overview" class="level1"><span class="tocNumber">1&nbsp; </span>Overview</a><br>
<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#outputanimage" class="level1"><span class="tocNumber">2&nbsp; </span>Output an Image</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#outputanimage/theppmimageformat" class="level2"><span class="tocNumber">2.1&nbsp; </span>The PPM Image Format</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#outputanimage/creatinganimagefile" class="level2"><span class="tocNumber">2.2&nbsp; </span>Creating an Image File</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#outputanimage/addingaprogressindicator" class="level2"><span class="tocNumber">2.3&nbsp; </span>Adding a Progress Indicator</a><br>
<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#thevec3class" class="level1"><span class="tocNumber">3&nbsp; </span>The vec3 Class</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#thevec3class/variablesandmethods" class="level2"><span class="tocNumber">3.1&nbsp; </span>Variables and Methods</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#thevec3class/vec3utilityfunctions" class="level2"><span class="tocNumber">3.2&nbsp; </span>vec3 Utility Functions</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#thevec3class/colorutilityfunctions" class="level2"><span class="tocNumber">3.3&nbsp; </span>Color Utility Functions</a><br>
<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#rays,asimplecamera,andbackground" class="level1"><span class="tocNumber">4&nbsp; </span>Rays, a Simple Camera, and Background</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#rays,asimplecamera,andbackground/therayclass" class="level2"><span class="tocNumber">4.1&nbsp; </span>The ray Class</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#rays,asimplecamera,andbackground/sendingraysintothescene" class="level2"><span class="tocNumber">4.2&nbsp; </span>Sending Rays Into the Scene</a><br>
<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#addingasphere" class="level1"><span class="tocNumber">5&nbsp; </span>Adding a Sphere</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#addingasphere/ray-sphereintersection" class="level2"><span class="tocNumber">5.1&nbsp; </span>Ray-Sphere Intersection</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#addingasphere/creatingourfirstraytracedimage" class="level2"><span class="tocNumber">5.2&nbsp; </span>Creating Our First Raytraced Image</a><br>
<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#surfacenormalsandmultipleobjects" class="level1"><span class="tocNumber">6&nbsp; </span>Surface Normals and Multiple Objects</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#surfacenormalsandmultipleobjects/shadingwithsurfacenormals" class="level2"><span class="tocNumber">6.1&nbsp; </span>Shading with Surface Normals</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#surfacenormalsandmultipleobjects/simplifyingtheray-sphereintersectioncode" class="level2"><span class="tocNumber">6.2&nbsp; </span>Simplifying the Ray-Sphere Intersection Code</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#surfacenormalsandmultipleobjects/anabstractionforhittableobjects" class="level2"><span class="tocNumber">6.3&nbsp; </span>An Abstraction for Hittable Objects</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#surfacenormalsandmultipleobjects/frontfacesversusbackfaces" class="level2"><span class="tocNumber">6.4&nbsp; </span>Front Faces Versus Back Faces</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#surfacenormalsandmultipleobjects/alistofhittableobjects" class="level2"><span class="tocNumber">6.5&nbsp; </span>A List of Hittable Objects</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#surfacenormalsandmultipleobjects/somenewc++features" class="level2"><span class="tocNumber">6.6&nbsp; </span>Some New C++ Features</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#surfacenormalsandmultipleobjects/commonconstantsandutilityfunctions" class="level2"><span class="tocNumber">6.7&nbsp; </span>Common Constants and Utility Functions</a><br>
<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#antialiasing" class="level1"><span class="tocNumber">7&nbsp; </span>Antialiasing</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#antialiasing/somerandomnumberutilities" class="level2"><span class="tocNumber">7.1&nbsp; </span>Some Random Number Utilities</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#antialiasing/generatingpixelswithmultiplesamples" class="level2"><span class="tocNumber">7.2&nbsp; </span>Generating Pixels with Multiple Samples</a><br>
<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#diffusematerials" class="level1"><span class="tocNumber">8&nbsp; </span>Diffuse Materials</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#diffusematerials/asimplediffusematerial" class="level2"><span class="tocNumber">8.1&nbsp; </span>A Simple Diffuse Material</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#diffusematerials/limitingthenumberofchildrays" class="level2"><span class="tocNumber">8.2&nbsp; </span>Limiting the Number of Child Rays</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#diffusematerials/usinggammacorrectionforaccuratecolorintensity" class="level2"><span class="tocNumber">8.3&nbsp; </span>Using Gamma Correction for Accurate Color Intensity</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#diffusematerials/fixingshadowacne" class="level2"><span class="tocNumber">8.4&nbsp; </span>Fixing Shadow Acne</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#diffusematerials/truelambertianreflection" class="level2"><span class="tocNumber">8.5&nbsp; </span>True Lambertian Reflection</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#diffusematerials/analternativediffuseformulation" class="level2"><span class="tocNumber">8.6&nbsp; </span>An Alternative Diffuse Formulation</a><br>
<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#metal" class="level1"><span class="tocNumber">9&nbsp; </span>Metal</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#metal/anabstractclassformaterials" class="level2"><span class="tocNumber">9.1&nbsp; </span>An Abstract Class for Materials</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#metal/adatastructuretodescriberay-objectintersections" class="level2"><span class="tocNumber">9.2&nbsp; </span>A Data Structure to Describe Ray-Object Intersections</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#metal/modelinglightscatterandreflectance" class="level2"><span class="tocNumber">9.3&nbsp; </span>Modeling Light Scatter and Reflectance</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#metal/mirroredlightreflection" class="level2"><span class="tocNumber">9.4&nbsp; </span>Mirrored Light Reflection</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#metal/ascenewithmetalspheres" class="level2"><span class="tocNumber">9.5&nbsp; </span>A Scene with Metal Spheres</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#metal/fuzzyreflection" class="level2"><span class="tocNumber">9.6&nbsp; </span>Fuzzy Reflection</a><br>
<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#dielectrics" class="level1"><span class="tocNumber">10&nbsp; </span>Dielectrics</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#dielectrics/refraction" class="level2"><span class="tocNumber">10.1&nbsp; </span>Refraction</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#dielectrics/snell&#39;slaw" class="level2"><span class="tocNumber">10.2&nbsp; </span>Snell's Law</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#dielectrics/totalinternalreflection" class="level2"><span class="tocNumber">10.3&nbsp; </span>Total Internal Reflection</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#dielectrics/schlickapproximation" class="level2"><span class="tocNumber">10.4&nbsp; </span>Schlick Approximation</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#dielectrics/modelingahollowglasssphere" class="level2"><span class="tocNumber">10.5&nbsp; </span>Modeling a Hollow Glass Sphere</a><br>
<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#positionablecamera" class="level1"><span class="tocNumber">11&nbsp; </span>Positionable Camera</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#positionablecamera/cameraviewinggeometry" class="level2"><span class="tocNumber">11.1&nbsp; </span>Camera Viewing Geometry</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#positionablecamera/positioningandorientingthecamera" class="level2"><span class="tocNumber">11.2&nbsp; </span>Positioning and Orienting the Camera</a><br>
<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#defocusblur" class="level1"><span class="tocNumber">12&nbsp; </span>Defocus Blur</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#defocusblur/athinlensapproximation" class="level2"><span class="tocNumber">12.1&nbsp; </span>A Thin Lens Approximation</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#defocusblur/generatingsamplerays" class="level2"><span class="tocNumber">12.2&nbsp; </span>Generating Sample Rays</a><br>
<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#wherenext?" class="level1"><span class="tocNumber">13&nbsp; </span>Where Next?</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#wherenext?/afinalrender" class="level2"><span class="tocNumber">13.1&nbsp; </span>A Final Render</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#wherenext?/nextsteps" class="level2"><span class="tocNumber">13.2&nbsp; </span>Next Steps</a><br>
<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#acknowledgments" class="level1"><span class="tocNumber">14&nbsp; </span>Acknowledgments</a><br>
<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#citingthisbook" class="level1"><span class="tocNumber">15&nbsp; </span>Citing This Book</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#citingthisbook/basicdata" class="level2"><span class="tocNumber">15.1&nbsp; </span>Basic Data</a><br>
&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#citingthisbook/snippets" class="level2"><span class="tocNumber">15.2&nbsp; </span>Snippets</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#citingthisbook/snippets/markdown" class="level3"><span class="tocNumber">15.2.1&nbsp; </span>Markdown</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#citingthisbook/snippets/html" class="level3"><span class="tocNumber">15.2.2&nbsp; </span>HTML</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#citingthisbook/snippets/latexandbibtex" class="level3"><span class="tocNumber">15.2.3&nbsp; </span>LaTeX and BibTex</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#citingthisbook/snippets/biblatex" class="level3"><span class="tocNumber">15.2.4&nbsp; </span>BibLaTeX</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#citingthisbook/snippets/ieee" class="level3"><span class="tocNumber">15.2.5&nbsp; </span>IEEE</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#citingthisbook/snippets/mla:" class="level3"><span class="tocNumber">15.2.6&nbsp; </span>MLA:</a><br>
</p></div><a class="target" name="overview">&nbsp;</a><a class="target" name="overview">&nbsp;</a><a class="target" name="toc1">&nbsp;</a><h1>Overview</h1>
<p>


I’ve taught many graphics classes over the years. Often I do them in ray tracing, because you are
forced to write all the code, but you can still get cool images with no API. I decided to adapt my
course notes into a how-to, to get you to a cool program as quickly as possible. It will not be a
full-featured ray tracer, but it does have the indirect lighting which has made ray tracing a staple
in movies. Follow these steps, and the architecture of the ray tracer you produce will be good for
extending to a more extensive ray tracer if you get excited and want to pursue that.

</p><p>

When somebody says “ray tracing” it could mean many things. What I am going to describe is
technically a path tracer, and a fairly general one. While the code will be pretty simple (let the
computer do the work!) I think you’ll be very happy with the images you can make.

</p><p>

I’ll take you through writing a ray tracer in the order I do it, along with some debugging tips. By
the end, you will have a ray tracer that produces some great images. You should be able to do this
in a weekend. If you take longer, don’t worry about it. I use C++ as the driving language, but you
don’t need to. However, I suggest you do, because it’s fast, portable, and most production movie and
video game renderers are written in C++. Note that I avoid most “modern features” of C++, but
inheritance and operator overloading are too useful for ray tracers to pass on. I do not provide the
code online, but the code is real and I show all of it except for a few straightforward operators in
the <code>vec3</code> class. I am a big believer in typing in code to learn it, but when code is available I
use it, so I only practice what I preach when the code is not available. So don’t ask!

</p><p>

I have left that last part in because it is funny what a 180 I have done. Several readers ended up
with subtle errors that were helped when we compared code. So please do type in the code, but if you
want to look at mine it is at:

</p><p>

<a href="https://github.com/RayTracing/raytracing.github.io/" class="url">https://github.com/RayTracing/raytracing.github.io/</a>

</p><p>

I assume a little bit of familiarity with vectors (like dot product and vector addition). If you
don’t know that, do a little review. If you need that review, or to learn it for the first time,
check out Marschner’s and my graphics text, Foley, Van Dam, <em class="underscore">et al.</em>, or McGuire’s graphics codex.

</p><p>

If you run into trouble, or do something cool you’d like to show somebody, send me some email at
<a href="mailto:ptrshrl@gmail.com.">ptrshrl@gmail.com.</a>

</p><p>

I’ll be maintaining a site related to the book including further reading and links to resources at a
blog <a href="https://in1weekend.blogspot.com/" class="url">https://in1weekend.blogspot.com/</a> related to this book.

</p><p>

Thanks to everyone who lent a hand on this project. You can find them in the <a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#acknowledgments">acknowledgments</a> section
at the end of this book.

</p><p>

Let’s get on with it!

</p>
<a class="target" name="outputanimage">&nbsp;</a><a class="target" name="outputanimage">&nbsp;</a><a class="target" name="toc2">&nbsp;</a><h1>Output an Image</h1>

<a class="target" name="theppmimageformat">&nbsp;</a><a class="target" name="outputanimage/theppmimageformat">&nbsp;</a><a class="target" name="toc2.1">&nbsp;</a><h2>The PPM Image Format</h2>
<p>

Whenever you start a renderer, you need a way to see an image. The most straightforward way is to
write it to a file. The catch is, there are so many formats. Many of those are complex. I always
start with a plain text ppm file. Here’s a nice description from Wikipedia:

</p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/fig-1.01-ppm.jpg" target="_blank"><img class="markdeep" src="./Ray Tracing in One Weekend_files/fig-1.01-ppm.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_ppm">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;1:</b> PPM Example</span></center></div></center>

<p></p><p>

</p><div class="together">
Let’s make some C++ code to output such a thing:

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{</span>
<span class="line"></span>
<span class="line">    <span class="hljs-comment">// Image</span></span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> image_width = <span class="hljs-number">256</span>;</span>
<span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> image_height = <span class="hljs-number">256</span>;</span>
<span class="line"></span>
<span class="line">    <span class="hljs-comment">// Render</span></span>
<span class="line"></span>
<span class="line">    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"P3\n"</span> &lt;&lt; image_width &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; image_height &lt;&lt; <span class="hljs-string">"\n255\n"</span>;</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = image_height<span class="hljs-number">-1</span>; j &gt;= <span class="hljs-number">0</span>; --j) {</span>
<span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; image_width; ++i) {</span>
<span class="line">            <span class="hljs-keyword">auto</span> r = <span class="hljs-keyword">double</span>(i) / (image_width<span class="hljs-number">-1</span>);</span>
<span class="line">            <span class="hljs-keyword">auto</span> g = <span class="hljs-keyword">double</span>(j) / (image_height<span class="hljs-number">-1</span>);</span>
<span class="line">            <span class="hljs-keyword">auto</span> b = <span class="hljs-number">0.25</span>;</span>
<span class="line"></span>
<span class="line">            <span class="hljs-keyword">int</span> ir = <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">int</span>&gt;(<span class="hljs-number">255.999</span> * r);</span>
<span class="line">            <span class="hljs-keyword">int</span> ig = <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">int</span>&gt;(<span class="hljs-number">255.999</span> * g);</span>
<span class="line">            <span class="hljs-keyword">int</span> ib = <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">int</span>&gt;(<span class="hljs-number">255.999</span> * b);</span>
<span class="line"></span>
<span class="line">            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; ir &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; ig &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; ib &lt;&lt; <span class="hljs-string">'\n'</span>;</span>
<span class="line">        }</span>
<span class="line">    }</span>
<span class="line">}</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_main-initial">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;1:</b> <kbd>[main.cc]</kbd> Creating your first image</div></center>
<p>

</p></div>

<p></p><p>

There are some things to note in that code:

</p><p>

</p><ol start="1">
  <li class="number">The pixels are written out in rows with pixels left to right.

<p></p><p>

</p></li>
  <li class="number">The rows are written out from top to bottom.

<p></p><p>

</p></li>
  <li class="number">By convention, each of the red/green/blue components range from 0.0 to 1.0. We will relax that
       later when we internally use high dynamic range, but before output we will tone map to the zero
       to one range, so this code won’t change.

<p></p><p>

</p></li>
  <li class="number">Red goes from fully off (black) to fully on (bright red) from left to right, and green goes
       from black at the bottom to fully on at the top. Red and green together make yellow so we
       should expect the upper right corner to be yellow.</li></ol>

<p></p>
<a class="target" name="creatinganimagefile">&nbsp;</a><a class="target" name="outputanimage/creatinganimagefile">&nbsp;</a><a class="target" name="toc2.2">&nbsp;</a><h2>Creating an Image File</h2>
<p>

</p><div class="together">
Because the file is written to the program output, you'll need to redirect it to an image file.
Typically this is done from the command-line by using the <code>&gt;</code> redirection operator, like so:

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-selector-tag">build</span>\<span class="hljs-selector-tag">Release</span>\<span class="hljs-selector-tag">inOneWeekend</span><span class="hljs-selector-class">.exe</span> &gt; <span class="hljs-selector-tag">image</span><span class="hljs-selector-class">.ppm</span></span></code></pre><p>

This is how things would look on Windows. On Mac or Linux, it would look like this:

</p><pre class="listing tilde"><code><span class="line"><span class="hljs-selector-tag">build</span>/<span class="hljs-selector-tag">inOneWeekend</span> &gt; <span class="hljs-selector-tag">image</span><span class="hljs-selector-class">.ppm</span></span></code></pre><p>
</p></div>

<p></p><p>

</p><div class="together">
Opening the output file (in <code>ToyViewer</code> on my Mac, but try it in your favorite viewer and Google
“ppm viewer” if your viewer doesn’t support it) shows this result:

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/img-1.01-first-ppm-image.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing in One Weekend_files/img-1.01-first-ppm-image.png"></a><center><span class="imagecaption">Image 1: First PPM image</span></center></div></center>

<p></p><p>

</p></div>

<p></p><p>

</p><div class="together">
Hooray! This is the graphics “hello world”. If your image doesn’t look like that, open the output
file in a text editor and see what it looks like. It should start something like this:

<p></p><pre class="listing tilde"><code><span class="line">P3</span>
<span class="line">256 256</span>
<span class="line">255</span>
<span class="line">0 255 63</span>
<span class="line">1 255 63</span>
<span class="line">2 255 63</span>
<span class="line">3 255 63</span>
<span class="line">4 255 63</span>
<span class="line">5 255 63</span>
<span class="line">6 255 63</span>
<span class="line">7 255 63</span>
<span class="line">8 255 63</span>
<span class="line">9 255 63</span>
<span class="line">...</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_first-img">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;2:</b> First image output</div></center>
<p>

</p></div>

<p></p><p>

If it doesn’t, then you probably just have some newlines or something similar that is confusing the
image reader.

</p><p>

If you want to produce more image types than PPM, I am a fan of <code>stb_image.h</code>, a header-only image
library available on GitHub at <a href="https://github.com/nothings/stb" class="url">https://github.com/nothings/stb</a>.

</p>
<a class="target" name="addingaprogressindicator">&nbsp;</a><a class="target" name="outputanimage/addingaprogressindicator">&nbsp;</a><a class="target" name="toc2.3">&nbsp;</a><h2>Adding a Progress Indicator</h2>
<p>

Before we continue, let's add a progress indicator to our output. This is a handy way to track the
progress of a long render, and also to possibly identify a run that's stalled out due to an infinite
loop or other problem.

</p><p>

</p><div class="together">
Our program outputs the image to the standard output stream (<code>std::cout</code>), so leave that alone and
instead write to the error output stream (<code>std::cerr</code>):

<p></p><pre class="listing tilde"><code><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = image_height<span class="hljs-number">-1</span>; j &gt;= <span class="hljs-number">0</span>; --j) {</span><div class=" highlight"><span class="line">        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"\rScanlines remaining: "</span> &lt;&lt; j &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; <span class="hljs-built_in">std</span>::flush;</span></div><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; image_width; ++i) {</span>
<span class="line">            <span class="hljs-keyword">auto</span> r = <span class="hljs-keyword">double</span>(i) / (image_width<span class="hljs-number">-1</span>);</span>
<span class="line">            <span class="hljs-keyword">auto</span> g = <span class="hljs-keyword">double</span>(j) / (image_height<span class="hljs-number">-1</span>);</span>
<span class="line">            <span class="hljs-keyword">auto</span> b = <span class="hljs-number">0.25</span>;</span>
<span class="line"></span>
<span class="line">            <span class="hljs-keyword">int</span> ir = <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">int</span>&gt;(<span class="hljs-number">255.999</span> * r);</span>
<span class="line">            <span class="hljs-keyword">int</span> ig = <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">int</span>&gt;(<span class="hljs-number">255.999</span> * g);</span>
<span class="line">            <span class="hljs-keyword">int</span> ib = <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">int</span>&gt;(<span class="hljs-number">255.999</span> * b);</span>
<span class="line"></span>
<span class="line">            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; ir &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; ig &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; ib &lt;&lt; <span class="hljs-string">'\n'</span>;</span>
<span class="line">        }</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line">    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"\nDone.\n"</span>;</span></div></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_main-progress">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;3:</b> <kbd>[main.cc]</kbd> Main render loop with progress reporting</div></center>
<p>

</p></div>

<p></p>
<a class="target" name="thevec3class">&nbsp;</a><a class="target" name="thevec3class">&nbsp;</a><a class="target" name="toc3">&nbsp;</a><h1>The vec3 Class</h1>
<p>


Almost all graphics programs have some class(es) for storing geometric vectors and colors. In many
systems these vectors are 4D (3D plus a homogeneous coordinate for geometry, and RGB plus an alpha
transparency channel for colors). For our purposes, three coordinates suffices. We’ll use the same
class <code>vec3</code> for colors, locations, directions, offsets, whatever. Some people don’t like this
because it doesn’t prevent you from doing something silly, like adding a color to a location. They
have a good point, but we’re going to always take the “less code” route when not obviously wrong.
In spite of this, we do declare two aliases for <code>vec3</code>: <code>point3</code> and <code>color</code>. Since these two types
are just aliases for <code>vec3</code>, you won't get warnings if you pass a <code>color</code> to a function expecting a
<code>point3</code>, for example. We use them only to clarify intent and use.

</p>
<a class="target" name="variablesandmethods">&nbsp;</a><a class="target" name="thevec3class/variablesandmethods">&nbsp;</a><a class="target" name="toc3.1">&nbsp;</a><h2>Variables and Methods</h2>
<p>

</p><div class="together">
Here’s the top part of my <code>vec3</code> class:

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> VEC3_H</span></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> VEC3_H</span></span>
<span class="line"></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cmath&gt;</span></span></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="hljs-keyword">using</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">sqrt</span>;</span>
<span class="line"></span>
<span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">vec3</span> {</span></span>
<span class="line">    <span class="hljs-keyword">public</span>:</span>
<span class="line">        vec3() : e{<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>} {}</span>
<span class="line">        vec3(<span class="hljs-keyword">double</span> e0, <span class="hljs-keyword">double</span> e1, <span class="hljs-keyword">double</span> e2) : e{e0, e1, e2} {}</span>
<span class="line"></span>
<span class="line">        <span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">x</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{ <span class="hljs-keyword">return</span> e[<span class="hljs-number">0</span>]; }</span>
<span class="line">        <span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">y</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{ <span class="hljs-keyword">return</span> e[<span class="hljs-number">1</span>]; }</span>
<span class="line">        <span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">z</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{ <span class="hljs-keyword">return</span> e[<span class="hljs-number">2</span>]; }</span>
<span class="line"></span>
<span class="line">        vec3 <span class="hljs-keyword">operator</span>-() <span class="hljs-keyword">const</span> { <span class="hljs-keyword">return</span> vec3(-e[<span class="hljs-number">0</span>], -e[<span class="hljs-number">1</span>], -e[<span class="hljs-number">2</span>]); }</span>
<span class="line">        <span class="hljs-keyword">double</span> <span class="hljs-keyword">operator</span>[](<span class="hljs-keyword">int</span> i) <span class="hljs-keyword">const</span> { <span class="hljs-keyword">return</span> e[i]; }</span>
<span class="line">        <span class="hljs-keyword">double</span>&amp; <span class="hljs-keyword">operator</span>[](<span class="hljs-keyword">int</span> i) { <span class="hljs-keyword">return</span> e[i]; }</span>
<span class="line"></span>
<span class="line">        vec3&amp; <span class="hljs-keyword">operator</span>+=(<span class="hljs-keyword">const</span> vec3 &amp;v) {</span>
<span class="line">            e[<span class="hljs-number">0</span>] += v.e[<span class="hljs-number">0</span>];</span>
<span class="line">            e[<span class="hljs-number">1</span>] += v.e[<span class="hljs-number">1</span>];</span>
<span class="line">            e[<span class="hljs-number">2</span>] += v.e[<span class="hljs-number">2</span>];</span>
<span class="line">            <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;</span>
<span class="line">        }</span>
<span class="line"></span>
<span class="line">        vec3&amp; <span class="hljs-keyword">operator</span>*=(<span class="hljs-keyword">const</span> <span class="hljs-keyword">double</span> t) {</span>
<span class="line">            e[<span class="hljs-number">0</span>] *= t;</span>
<span class="line">            e[<span class="hljs-number">1</span>] *= t;</span>
<span class="line">            e[<span class="hljs-number">2</span>] *= t;</span>
<span class="line">            <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;</span>
<span class="line">        }</span>
<span class="line"></span>
<span class="line">        vec3&amp; <span class="hljs-keyword">operator</span>/=(<span class="hljs-keyword">const</span> <span class="hljs-keyword">double</span> t) {</span>
<span class="line">            <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span> *= <span class="hljs-number">1</span>/t;</span>
<span class="line">        }</span>
<span class="line"></span>
<span class="line">        <span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">length</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{</span>
<span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-built_in">sqrt</span>(length_squared());</span>
<span class="line">        }</span>
<span class="line"></span>
<span class="line">        <span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">length_squared</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{</span>
<span class="line">            <span class="hljs-keyword">return</span> e[<span class="hljs-number">0</span>]*e[<span class="hljs-number">0</span>] + e[<span class="hljs-number">1</span>]*e[<span class="hljs-number">1</span>] + e[<span class="hljs-number">2</span>]*e[<span class="hljs-number">2</span>];</span>
<span class="line">        }</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">public</span>:</span>
<span class="line">        <span class="hljs-keyword">double</span> e[<span class="hljs-number">3</span>];</span>
<span class="line">};</span>
<span class="line"></span>
<span class="line"><span class="hljs-comment">// Type aliases for vec3</span></span>
<span class="line"><span class="hljs-keyword">using</span> point3 = vec3;   <span class="hljs-comment">// 3D point</span></span>
<span class="line"><span class="hljs-keyword">using</span> color = vec3;    <span class="hljs-comment">// RGB color</span></span>
<span class="line"></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span></span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_vec3-class">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;4:</b> <kbd>[vec3.h]</kbd> vec3 class</div></center>
<p>

</p></div>

<p></p><p>

We use <code>double</code> here, but some ray tracers use <code>float</code>. Either one is fine — follow your own
tastes.

</p>
<a class="target" name="vec3utilityfunctions">&nbsp;</a><a class="target" name="thevec3class/vec3utilityfunctions">&nbsp;</a><a class="target" name="toc3.2">&nbsp;</a><h2>vec3 Utility Functions</h2>
<p>

The second part of the header file contains vector utility functions:

</p><pre class="listing tilde"><code><span class="line"><span class="hljs-comment">// vec3 Utility Functions</span></span>
<span class="line"></span>
<span class="line"><span class="hljs-keyword">inline</span> <span class="hljs-built_in">std</span>::ostream&amp; <span class="hljs-keyword">operator</span>&lt;&lt;(<span class="hljs-built_in">std</span>::ostream &amp;out, <span class="hljs-keyword">const</span> vec3 &amp;v) {</span>
<span class="line">    <span class="hljs-keyword">return</span> out &lt;&lt; v.e[<span class="hljs-number">0</span>] &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; v.e[<span class="hljs-number">1</span>] &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; v.e[<span class="hljs-number">2</span>];</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"><span class="hljs-keyword">inline</span> vec3 <span class="hljs-keyword">operator</span>+(<span class="hljs-keyword">const</span> vec3 &amp;u, <span class="hljs-keyword">const</span> vec3 &amp;v) {</span>
<span class="line">    <span class="hljs-keyword">return</span> vec3(u.e[<span class="hljs-number">0</span>] + v.e[<span class="hljs-number">0</span>], u.e[<span class="hljs-number">1</span>] + v.e[<span class="hljs-number">1</span>], u.e[<span class="hljs-number">2</span>] + v.e[<span class="hljs-number">2</span>]);</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"><span class="hljs-keyword">inline</span> vec3 <span class="hljs-keyword">operator</span>-(<span class="hljs-keyword">const</span> vec3 &amp;u, <span class="hljs-keyword">const</span> vec3 &amp;v) {</span>
<span class="line">    <span class="hljs-keyword">return</span> vec3(u.e[<span class="hljs-number">0</span>] - v.e[<span class="hljs-number">0</span>], u.e[<span class="hljs-number">1</span>] - v.e[<span class="hljs-number">1</span>], u.e[<span class="hljs-number">2</span>] - v.e[<span class="hljs-number">2</span>]);</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"><span class="hljs-keyword">inline</span> vec3 <span class="hljs-keyword">operator</span>*(<span class="hljs-keyword">const</span> vec3 &amp;u, <span class="hljs-keyword">const</span> vec3 &amp;v) {</span>
<span class="line">    <span class="hljs-keyword">return</span> vec3(u.e[<span class="hljs-number">0</span>] * v.e[<span class="hljs-number">0</span>], u.e[<span class="hljs-number">1</span>] * v.e[<span class="hljs-number">1</span>], u.e[<span class="hljs-number">2</span>] * v.e[<span class="hljs-number">2</span>]);</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"><span class="hljs-keyword">inline</span> vec3 <span class="hljs-keyword">operator</span>*(<span class="hljs-keyword">double</span> t, <span class="hljs-keyword">const</span> vec3 &amp;v) {</span>
<span class="line">    <span class="hljs-keyword">return</span> vec3(t*v.e[<span class="hljs-number">0</span>], t*v.e[<span class="hljs-number">1</span>], t*v.e[<span class="hljs-number">2</span>]);</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"><span class="hljs-keyword">inline</span> vec3 <span class="hljs-keyword">operator</span>*(<span class="hljs-keyword">const</span> vec3 &amp;v, <span class="hljs-keyword">double</span> t) {</span>
<span class="line">    <span class="hljs-keyword">return</span> t * v;</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"><span class="hljs-keyword">inline</span> vec3 <span class="hljs-keyword">operator</span>/(vec3 v, <span class="hljs-keyword">double</span> t) {</span>
<span class="line">    <span class="hljs-keyword">return</span> (<span class="hljs-number">1</span>/t) * v;</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">double</span> <span class="hljs-title">dot</span><span class="hljs-params">(<span class="hljs-keyword">const</span> vec3 &amp;u, <span class="hljs-keyword">const</span> vec3 &amp;v)</span> </span>{</span>
<span class="line">    <span class="hljs-keyword">return</span> u.e[<span class="hljs-number">0</span>] * v.e[<span class="hljs-number">0</span>]</span>
<span class="line">         + u.e[<span class="hljs-number">1</span>] * v.e[<span class="hljs-number">1</span>]</span>
<span class="line">         + u.e[<span class="hljs-number">2</span>] * v.e[<span class="hljs-number">2</span>];</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"><span class="hljs-function"><span class="hljs-keyword">inline</span> vec3 <span class="hljs-title">cross</span><span class="hljs-params">(<span class="hljs-keyword">const</span> vec3 &amp;u, <span class="hljs-keyword">const</span> vec3 &amp;v)</span> </span>{</span>
<span class="line">    <span class="hljs-keyword">return</span> vec3(u.e[<span class="hljs-number">1</span>] * v.e[<span class="hljs-number">2</span>] - u.e[<span class="hljs-number">2</span>] * v.e[<span class="hljs-number">1</span>],</span>
<span class="line">                u.e[<span class="hljs-number">2</span>] * v.e[<span class="hljs-number">0</span>] - u.e[<span class="hljs-number">0</span>] * v.e[<span class="hljs-number">2</span>],</span>
<span class="line">                u.e[<span class="hljs-number">0</span>] * v.e[<span class="hljs-number">1</span>] - u.e[<span class="hljs-number">1</span>] * v.e[<span class="hljs-number">0</span>]);</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"><span class="hljs-function"><span class="hljs-keyword">inline</span> vec3 <span class="hljs-title">unit_vector</span><span class="hljs-params">(vec3 v)</span> </span>{</span>
<span class="line">    <span class="hljs-keyword">return</span> v / v.length();</span>
<span class="line">}</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_vec3-utility">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;5:</b> <kbd>[vec3.h]</kbd> vec3 utility functions</div></center>

<a class="target" name="colorutilityfunctions">&nbsp;</a><a class="target" name="thevec3class/colorutilityfunctions">&nbsp;</a><a class="target" name="toc3.3">&nbsp;</a><h2>Color Utility Functions</h2>
<p>

Using our new <code>vec3</code> class, we'll create a utility function to write a single pixel's color out to
the standard output stream.

</p><pre class="listing tilde"><code><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> COLOR_H</span></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> COLOR_H</span></span>
<span class="line"></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"vec3.h"</span></span></span>
<span class="line"></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">write_color</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::ostream &amp;out, color pixel_color)</span> </span>{</span>
<span class="line">    <span class="hljs-comment">// Write the translated [0,255] value of each color component.</span></span>
<span class="line">    out &lt;&lt; <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">int</span>&gt;(<span class="hljs-number">255.999</span> * pixel_color.x()) &lt;&lt; <span class="hljs-string">' '</span></span>
<span class="line">        &lt;&lt; <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">int</span>&gt;(<span class="hljs-number">255.999</span> * pixel_color.y()) &lt;&lt; <span class="hljs-string">' '</span></span>
<span class="line">        &lt;&lt; <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">int</span>&gt;(<span class="hljs-number">255.999</span> * pixel_color.z()) &lt;&lt; <span class="hljs-string">'\n'</span>;</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span></span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_color">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;6:</b> <kbd>[color.h]</kbd> color utility functions</div></center>
<p>




</p><div class="together">
Now we can change our main to use this:

<p></p><pre class="listing tilde"><code><div class=" highlight"><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"color.h"</span></span></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"vec3.h"</span></span></span></div><span class="line"></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{</span>
<span class="line"></span>
<span class="line">    <span class="hljs-comment">// Image</span></span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> image_width = <span class="hljs-number">256</span>;</span>
<span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> image_height = <span class="hljs-number">256</span>;</span>
<span class="line"></span>
<span class="line">    <span class="hljs-comment">// Render</span></span>
<span class="line"></span>
<span class="line">    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"P3\n"</span> &lt;&lt; image_width &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; image_height &lt;&lt; <span class="hljs-string">"\n255\n"</span>;</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = image_height<span class="hljs-number">-1</span>; j &gt;= <span class="hljs-number">0</span>; --j) {</span>
<span class="line">        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"\rScanlines remaining: "</span> &lt;&lt; j &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; <span class="hljs-built_in">std</span>::flush;</span>
<span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; image_width; ++i) {</span><div class=" highlight"><span class="line">            <span class="hljs-function">color <span class="hljs-title">pixel_color</span><span class="hljs-params">(<span class="hljs-keyword">double</span>(i)/(image_width<span class="hljs-number">-1</span>), <span class="hljs-keyword">double</span>(j)/(image_height<span class="hljs-number">-1</span>), <span class="hljs-number">0.25</span>)</span></span>;</span>
<span class="line">            write_color(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span>, pixel_color);</span></div><span class="line">        }</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"\nDone.\n"</span>;</span>
<span class="line">}</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_ppm-2">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;7:</b> <kbd>[main.cc]</kbd> Final code for the first PPM image</div></center>
<p>

</p></div>

<p></p>
<a class="target" name="rays,asimplecamera,andbackground">&nbsp;</a><a class="target" name="rays,asimplecamera,andbackground">&nbsp;</a><a class="target" name="toc4">&nbsp;</a><h1>Rays, a Simple Camera, and Background</h1>

<a class="target" name="therayclass">&nbsp;</a><a class="target" name="rays,asimplecamera,andbackground/therayclass">&nbsp;</a><a class="target" name="toc4.1">&nbsp;</a><h2>The ray Class</h2>
<p>

</p><div class="together">
The one thing that all ray tracers have is a ray class and a computation of what color is seen along
a ray. Let’s think of a ray as a function <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-2-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;A&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-3" style="width: 7.953em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.353em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.403em, 1006.3em, 2.702em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-4"><span class="texatom" id="MathJax-Span-5"><span class="mrow" id="MathJax-Span-6"><span class="mi" id="MathJax-Span-7" style="font-family: MathJax_Main-bold;">P</span></span></span><span class="mo" id="MathJax-Span-8" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-9" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-10" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-11" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="texatom" id="MathJax-Span-12" style="padding-left: 0.302em;"><span class="mrow" id="MathJax-Span-13"><span class="mi" id="MathJax-Span-14" style="font-family: MathJax_Main-bold;">A</span></span></span><span class="mo" id="MathJax-Span-15" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-16" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">t</span><span class="texatom" id="MathJax-Span-17"><span class="mrow" id="MathJax-Span-18"><span class="mi" id="MathJax-Span-19" style="font-family: MathJax_Main-bold;">b</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo><mo>=</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">A</mi></mrow><mo>+</mo><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-2">\mathbf{P}(t) = \mathbf{A} + t \mathbf{b}</script>. Here
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-3-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-20" style="width: 1.002em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1000.75em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-21"><span class="texatom" id="MathJax-Span-22"><span class="mrow" id="MathJax-Span-23"><span class="mi" id="MathJax-Span-24" style="font-family: MathJax_Main-bold;">P</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-3">\mathbf{P}</script> is a 3D position along a line in 3D. <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-4-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;A&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-25" style="width: 1.103em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.853em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1000.8em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-26"><span class="texatom" id="MathJax-Span-27"><span class="mrow" id="MathJax-Span-28"><span class="mi" id="MathJax-Span-29" style="font-family: MathJax_Main-bold;">A</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">A</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-4">\mathbf{A}</script> is the ray origin and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-5-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-30" style="width: 0.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.653em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1000.6em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-31"><span class="texatom" id="MathJax-Span-32"><span class="mrow" id="MathJax-Span-33"><span class="mi" id="MathJax-Span-34" style="font-family: MathJax_Main-bold;">b</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-5">\mathbf{b}</script> is
the ray direction. The ray parameter <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-6-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-35" style="width: 0.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.352em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.103em, 1000.3em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-36"><span class="mi" id="MathJax-Span-37" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-6">t</script> is a real number (<code>double</code> in the code). Plug in a
different <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-7-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-38" style="width: 0.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.352em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.103em, 1000.3em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-39"><span class="mi" id="MathJax-Span-40" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-7">t</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-8-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-41" style="width: 2.452em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.952em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1001.85em, 2.603em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-42"><span class="texatom" id="MathJax-Span-43"><span class="mrow" id="MathJax-Span-44"><span class="mi" id="MathJax-Span-45" style="font-family: MathJax_Main-bold;">P</span></span></span><span class="mo" id="MathJax-Span-46" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-47" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-48" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-8">\mathbf{P}(t)</script> moves the point along the ray. Add in negative <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-9-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-49" style="width: 0.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.352em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.103em, 1000.3em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-50"><span class="mi" id="MathJax-Span-51" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-9">t</script> values and you
can go anywhere on the 3D line. For positive <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-10-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-52" style="width: 0.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.352em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.103em, 1000.3em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-53"><span class="mi" id="MathJax-Span-54" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-10">t</script>, you get only the parts in front of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-11-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;A&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-55" style="width: 1.103em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.853em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1000.8em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-56"><span class="texatom" id="MathJax-Span-57"><span class="mrow" id="MathJax-Span-58"><span class="mi" id="MathJax-Span-59" style="font-family: MathJax_Main-bold;">A</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">A</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-11">\mathbf{A}</script>,
and this is what is often called a half-line or ray.

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/fig-1.02-lerp.jpg" target="_blank"><img class="markdeep" src="./Ray Tracing in One Weekend_files/fig-1.02-lerp.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_lerp">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;2:</b> Linear interpolation</span></center></div></center>

<p></p><p>

</p></div>

<p></p><p>

</p><div class="together">
The function <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-12-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-60" style="width: 2.452em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.952em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1001.85em, 2.603em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-61"><span class="texatom" id="MathJax-Span-62"><span class="mrow" id="MathJax-Span-63"><span class="mi" id="MathJax-Span-64" style="font-family: MathJax_Main-bold;">P</span></span></span><span class="mo" id="MathJax-Span-65" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-66" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-67" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-12">\mathbf{P}(t)</script> in more verbose code form I call <code>ray::at(t)</code>:

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> RAY_H</span></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RAY_H</span></span>
<span class="line"></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"vec3.h"</span></span></span>
<span class="line"></span>
<span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ray</span> {</span></span>
<span class="line">    <span class="hljs-keyword">public</span>:</span>
<span class="line">        ray() {}</span>
<span class="line">        ray(<span class="hljs-keyword">const</span> point3&amp; origin, <span class="hljs-keyword">const</span> vec3&amp; direction)</span>
<span class="line">            : orig(origin), dir(direction)</span>
<span class="line">        {}</span>
<span class="line"></span>
<span class="line">        <span class="hljs-function">point3 <span class="hljs-title">origin</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span>  </span>{ <span class="hljs-keyword">return</span> orig; }</span>
<span class="line">        <span class="hljs-function">vec3 <span class="hljs-title">direction</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{ <span class="hljs-keyword">return</span> dir; }</span>
<span class="line"></span>
<span class="line">        <span class="hljs-function">point3 <span class="hljs-title">at</span><span class="hljs-params">(<span class="hljs-keyword">double</span> t)</span> <span class="hljs-keyword">const</span> </span>{</span>
<span class="line">            <span class="hljs-keyword">return</span> orig + t*dir;</span>
<span class="line">        }</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">public</span>:</span>
<span class="line">        point3 orig;</span>
<span class="line">        vec3 dir;</span>
<span class="line">};</span>
<span class="line"></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span></span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_ray-initial">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;8:</b> <kbd>[ray.h]</kbd> The ray class</div></center>
<p>

</p></div>

<p></p>
<a class="target" name="sendingraysintothescene">&nbsp;</a><a class="target" name="rays,asimplecamera,andbackground/sendingraysintothescene">&nbsp;</a><a class="target" name="toc4.2">&nbsp;</a><h2>Sending Rays Into the Scene</h2>
<p>

Now we are ready to turn the corner and make a ray tracer. At the core, the ray tracer sends rays
through pixels and computes the color seen in the direction of those rays. The involved steps are
(1) calculate the ray from the eye to the pixel, (2) determine which objects the ray intersects, and
(3) compute a color for that intersection point. When first developing a ray tracer, I always do a
simple camera for getting the code up and running. I also make a simple <code>ray_color(ray)</code> function
that returns the color of the background (a simple gradient).

</p><p>

I’ve often gotten into trouble using square images for debugging because I transpose <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-13-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-68" style="width: 0.703em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.552em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1000.5em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-69"><span class="mi" id="MathJax-Span-70" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-13">x</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-14-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-71" style="width: 0.653em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.503em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1000.5em, 2.252em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-72"><span class="mi" id="MathJax-Span-73" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-14">y</script> too
often, so I’ll use a non-square image. For now we'll use a 16:9 aspect ratio, since that's so
common.

</p><p>

In addition to setting up the pixel dimensions for the rendered image, we also need to set up a
virtual viewport through which to pass our scene rays. For the standard square pixel spacing, the
viewport's aspect ratio should be the same as our rendered image. We'll just pick a viewport two
units in height. We'll also set the distance between the projection plane and the projection point
to be one unit. This is referred to as the “focal length”, not to be confused with “focus distance”,
which we'll present later.

</p><p>

I’ll put the “eye” (or camera center if you think of a camera) at <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-15-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-74" style="width: 3.952em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.152em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1003.05em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-75"><span class="mo" id="MathJax-Span-76" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-77" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-78" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-79" style="font-family: MathJax_Main; padding-left: 0.152em;">0</span><span class="mo" id="MathJax-Span-80" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-81" style="font-family: MathJax_Main; padding-left: 0.152em;">0</span><span class="mo" id="MathJax-Span-82" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mn>0</mn><mo>,</mo><mn>0</mn><mo>,</mo><mn>0</mn><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-15">(0,0,0)</script>. I will have the y-axis
go up, and the x-axis to the right. In order to respect the convention of a right handed coordinate
system, into the screen is the negative z-axis. I will traverse the screen from the upper left hand
corner, and use two offset vectors along the screen sides to move the ray endpoint across the
screen. Note that I do not make the ray direction a unit length vector because I think not doing
that makes for simpler and slightly faster code.

</p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/fig-1.03-cam-geom.jpg" target="_blank"><img class="markdeep" src="./Ray Tracing in One Weekend_files/fig-1.03-cam-geom.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_cam-geom">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;3:</b> Camera geometry</span></center></div></center>

<p></p><p>

</p><div class="together">
Below in code, the ray <code>r</code> goes to approximately the pixel centers (I won’t worry about exactness
for now because we’ll add antialiasing later):

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"color.h"</span></span></span><div class=" highlight"><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"ray.h"</span></span></span></div><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"vec3.h"</span></span></span>
<span class="line"></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"><span class="hljs-function">color <span class="hljs-title">ray_color</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ray&amp; r)</span> </span>{</span>
<span class="line">    vec3 unit_direction = unit_vector(r.direction());</span>
<span class="line">    <span class="hljs-keyword">auto</span> t = <span class="hljs-number">0.5</span>*(unit_direction.y() + <span class="hljs-number">1.0</span>);</span>
<span class="line">    <span class="hljs-keyword">return</span> (<span class="hljs-number">1.0</span>-t)*color(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>) + t*color(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.7</span>, <span class="hljs-number">1.0</span>);</span>
<span class="line">}</span></div><span class="line"></span>
<span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{</span>
<span class="line"></span>
<span class="line">    <span class="hljs-comment">// Image</span></span>
<span class="line"></span><div class=" highlight"><span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> aspect_ratio = <span class="hljs-number">16.0</span> / <span class="hljs-number">9.0</span>;</span>
<span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> image_width = <span class="hljs-number">400</span>;</span>
<span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> image_height = <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">int</span>&gt;(image_width / aspect_ratio);</span>
<span class="line"></span>
<span class="line">    <span class="hljs-comment">// Camera</span></span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">auto</span> viewport_height = <span class="hljs-number">2.0</span>;</span>
<span class="line">    <span class="hljs-keyword">auto</span> viewport_width = aspect_ratio * viewport_height;</span>
<span class="line">    <span class="hljs-keyword">auto</span> focal_length = <span class="hljs-number">1.0</span>;</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">auto</span> origin = point3(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);</span>
<span class="line">    <span class="hljs-keyword">auto</span> horizontal = vec3(viewport_width, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);</span>
<span class="line">    <span class="hljs-keyword">auto</span> vertical = vec3(<span class="hljs-number">0</span>, viewport_height, <span class="hljs-number">0</span>);</span>
<span class="line">    <span class="hljs-keyword">auto</span> lower_left_corner = origin - horizontal/<span class="hljs-number">2</span> - vertical/<span class="hljs-number">2</span> - vec3(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, focal_length);</span></div><span class="line"></span>
<span class="line">    <span class="hljs-comment">// Render</span></span>
<span class="line"></span>
<span class="line">    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"P3\n"</span> &lt;&lt; image_width &lt;&lt; <span class="hljs-string">" "</span> &lt;&lt; image_height &lt;&lt; <span class="hljs-string">"\n255\n"</span>;</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = image_height<span class="hljs-number">-1</span>; j &gt;= <span class="hljs-number">0</span>; --j) {</span>
<span class="line">        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"\rScanlines remaining: "</span> &lt;&lt; j &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; <span class="hljs-built_in">std</span>::flush;</span>
<span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; image_width; ++i) {</span><div class=" highlight"><span class="line">            <span class="hljs-keyword">auto</span> u = <span class="hljs-keyword">double</span>(i) / (image_width<span class="hljs-number">-1</span>);</span>
<span class="line">            <span class="hljs-keyword">auto</span> v = <span class="hljs-keyword">double</span>(j) / (image_height<span class="hljs-number">-1</span>);</span>
<span class="line">            <span class="hljs-function">ray <span class="hljs-title">r</span><span class="hljs-params">(origin, lower_left_corner + u*horizontal + v*vertical - origin)</span></span>;</span>
<span class="line">            color pixel_color = ray_color(r);</span></div><span class="line">            write_color(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span>, pixel_color);</span>
<span class="line">        }</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"\nDone.\n"</span>;</span>
<span class="line">}</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_main-blue-white-blend">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;9:</b> <kbd>[main.cc]</kbd> Rendering a blue-to-white gradient</div></center>
<p>

</p></div>

<p></p><p>

</p><div class="together">
The <code>ray_color(ray)</code> function linearly blends white and blue depending on the height of the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-16-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-83" style="width: 0.653em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.503em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1000.5em, 2.252em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-84"><span class="mi" id="MathJax-Span-85" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-16">y</script>
coordinate <em class="underscore">after</em> scaling the ray direction to unit length (so <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-17-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1.0&lt;/mn&gt;&lt;mo&gt;&amp;lt;&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;&amp;lt;&lt;/mo&gt;&lt;mn&gt;1.0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-86" style="width: 8.253em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.603em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1006.55em, 2.502em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-87"><span class="mo" id="MathJax-Span-88" style="font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-89" style="font-family: MathJax_Main;">1.0</span><span class="mo" id="MathJax-Span-90" style="font-family: MathJax_Main; padding-left: 0.302em;">&lt;</span><span class="mi" id="MathJax-Span-91" style="font-family: MathJax_Math-italic; padding-left: 0.302em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-92" style="font-family: MathJax_Main; padding-left: 0.302em;">&lt;</span><span class="mn" id="MathJax-Span-93" style="font-family: MathJax_Main; padding-left: 0.302em;">1.0</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>−</mo><mn>1.0</mn><mo>&lt;</mo><mi>y</mi><mo>&lt;</mo><mn>1.0</mn></math></span></span><script type="math/tex" id="MathJax-Element-17">-1.0 < y < 1.0</script>). Because we're
looking at the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-18-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-94" style="width: 0.653em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.503em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1000.5em, 2.252em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-95"><span class="mi" id="MathJax-Span-96" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-18">y</script> height after normalizing the vector, you'll notice a horizontal gradient to the
color in addition to the vertical gradient.

<p></p><p>

I then did a standard graphics trick of scaling that to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-19-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;0.0&lt;/mn&gt;&lt;mo&gt;&amp;#x2264;&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;&amp;#x2264;&lt;/mo&gt;&lt;mn&gt;1.0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-97" style="width: 7.153em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.702em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1005.65em, 2.452em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-98"><span class="mn" id="MathJax-Span-99" style="font-family: MathJax_Main;">0.0</span><span class="mo" id="MathJax-Span-100" style="font-family: MathJax_Main; padding-left: 0.302em;">≤</span><span class="mi" id="MathJax-Span-101" style="font-family: MathJax_Math-italic; padding-left: 0.302em;">t</span><span class="mo" id="MathJax-Span-102" style="font-family: MathJax_Main; padding-left: 0.302em;">≤</span><span class="mn" id="MathJax-Span-103" style="font-family: MathJax_Main; padding-left: 0.302em;">1.0</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0.0</mn><mo>≤</mo><mi>t</mi><mo>≤</mo><mn>1.0</mn></math></span></span><script type="math/tex" id="MathJax-Element-19">0.0 ≤ t ≤ 1.0</script>. When <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-20-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1.0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-104" style="width: 3.752em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.002em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1002.95em, 2.302em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-105"><span class="mi" id="MathJax-Span-106" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-107" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mn" id="MathJax-Span-108" style="font-family: MathJax_Main; padding-left: 0.302em;">1.0</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi><mo>=</mo><mn>1.0</mn></math></span></span><script type="math/tex" id="MathJax-Element-20">t = 1.0</script> I want blue.
When <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-21-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0.0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-109" style="width: 3.752em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.002em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1002.95em, 2.302em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-110"><span class="mi" id="MathJax-Span-111" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-112" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mn" id="MathJax-Span-113" style="font-family: MathJax_Main; padding-left: 0.302em;">0.0</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi><mo>=</mo><mn>0.0</mn></math></span></span><script type="math/tex" id="MathJax-Element-21">t = 0.0</script> I want white. In between, I want a blend. This forms a “linear blend”, or “linear
interpolation”, or “lerp” for short, between two things. A lerp is always of the form

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-22-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtext&gt;blendedValue&lt;/mtext&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mtext&gt;startValue&lt;/mtext&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mtext&gt;endValue&lt;/mtext&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-114" style="width: 27.502em; display: inline-block;"><span style="display: inline-block; position: relative; width: 22.003em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1021.95em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-115"><span class="mtext" id="MathJax-Span-116" style="font-family: MathJax_Main;">blendedValue</span><span class="mo" id="MathJax-Span-117" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mo" id="MathJax-Span-118" style="font-family: MathJax_Main; padding-left: 0.302em;">(</span><span class="mn" id="MathJax-Span-119" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-120" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="mi" id="MathJax-Span-121" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">t</span><span class="mo" id="MathJax-Span-122" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-123" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mtext" id="MathJax-Span-124" style="font-family: MathJax_Main; padding-left: 0.202em;">startValue</span><span class="mo" id="MathJax-Span-125" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-126" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">t</span><span class="mo" id="MathJax-Span-127" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mtext" id="MathJax-Span-128" style="font-family: MathJax_Main; padding-left: 0.202em;">endValue</span><span class="mo" id="MathJax-Span-129" style="font-family: MathJax_Main;">,</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtext>blendedValue</mtext><mo>=</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>t</mi><mo stretchy="false">)</mo><mo>⋅</mo><mtext>startValue</mtext><mo>+</mo><mi>t</mi><mo>⋅</mo><mtext>endValue</mtext><mo>,</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-22"> \text{blendedValue} = (1-t)\cdot\text{startValue} + t\cdot\text{endValue}, </script>

</p><p>

with <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-23-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-130" style="width: 0.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.352em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.103em, 1000.3em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-131"><span class="mi" id="MathJax-Span-132" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-23">t</script> going from zero to one. In our case this produces:

</p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/img-1.02-blue-to-white.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing in One Weekend_files/img-1.02-blue-to-white.png"></a><center><span class="imagecaption">Image 2: A blue-to-white gradient depending on ray Y coordinate
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="addingasphere">&nbsp;</a><a class="target" name="addingasphere">&nbsp;</a><a class="target" name="toc5">&nbsp;</a><h1>Adding a Sphere</h1>
<p>


Let’s add a single object to our ray tracer. People often use spheres in ray tracers because
calculating whether a ray hits a sphere is pretty straightforward.

</p>
<a class="target" name="ray-sphereintersection">&nbsp;</a><a class="target" name="addingasphere/ray-sphereintersection">&nbsp;</a><a class="target" name="toc5.1">&nbsp;</a><h2>Ray-Sphere Intersection</h2>
<p>

</p><div class="together">
Recall that the equation for a sphere centered at the origin of radius <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-24-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-133" style="width: 0.953em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.753em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.052em, 1000.75em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-134"><span class="mi" id="MathJax-Span-135" style="font-family: MathJax_Math-italic;">R</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>R</mi></math></span></span><script type="math/tex" id="MathJax-Element-24">R</script> is <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-25-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-136" style="width: 9.902em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.903em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1007.9em, 2.652em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-137"><span class="msubsup" id="MathJax-Span-138"><span style="display: inline-block; position: relative; width: 1.002em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-139" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.348em; left: 0.552em;"><span class="mn" id="MathJax-Span-140" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-141" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="msubsup" id="MathJax-Span-142" style="padding-left: 0.202em;"><span style="display: inline-block; position: relative; width: 1.002em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.353em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-143" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.348em; left: 0.552em;"><span class="mn" id="MathJax-Span-144" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-145" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="msubsup" id="MathJax-Span-146" style="padding-left: 0.202em;"><span style="display: inline-block; position: relative; width: 0.953em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.45em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-147" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.348em; left: 0.503em;"><span class="mn" id="MathJax-Span-148" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-149" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="msubsup" id="MathJax-Span-150" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 1.203em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.75em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-151" style="font-family: MathJax_Math-italic;">R</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.348em; left: 0.753em;"><span class="mn" id="MathJax-Span-152" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.441em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><msup><mi>y</mi><mn>2</mn></msup><mo>+</mo><msup><mi>z</mi><mn>2</mn></msup><mo>=</mo><msup><mi>R</mi><mn>2</mn></msup></math></span></span><script type="math/tex" id="MathJax-Element-25">x^2 + y^2 + z^2 =
R^2</script>. Put another way, if a given point <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-26-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-153" style="width: 3.952em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.152em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1003.05em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-154"><span class="mo" id="MathJax-Span-155" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-156" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-157" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-158" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-159" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-160" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-161" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>z</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-26">(x,y,z)</script> is on the sphere, then <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-27-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-162" style="width: 9.902em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.903em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1007.9em, 2.652em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-163"><span class="msubsup" id="MathJax-Span-164"><span style="display: inline-block; position: relative; width: 1.002em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-165" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.348em; left: 0.552em;"><span class="mn" id="MathJax-Span-166" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-167" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="msubsup" id="MathJax-Span-168" style="padding-left: 0.202em;"><span style="display: inline-block; position: relative; width: 1.002em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.353em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-169" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.348em; left: 0.552em;"><span class="mn" id="MathJax-Span-170" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-171" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="msubsup" id="MathJax-Span-172" style="padding-left: 0.202em;"><span style="display: inline-block; position: relative; width: 0.953em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.45em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-173" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.348em; left: 0.503em;"><span class="mn" id="MathJax-Span-174" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-175" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="msubsup" id="MathJax-Span-176" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 1.203em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.75em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-177" style="font-family: MathJax_Math-italic;">R</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.348em; left: 0.753em;"><span class="mn" id="MathJax-Span-178" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.441em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><msup><mi>y</mi><mn>2</mn></msup><mo>+</mo><msup><mi>z</mi><mn>2</mn></msup><mo>=</mo><msup><mi>R</mi><mn>2</mn></msup></math></span></span><script type="math/tex" id="MathJax-Element-27">x^2 + y^2 + z^2 = R^2</script>. If
the given point <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-28-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-179" style="width: 3.952em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.152em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1003.05em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-180"><span class="mo" id="MathJax-Span-181" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-182" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-183" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-184" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-185" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-186" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-187" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>z</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-28">(x,y,z)</script> is <em class="underscore">inside</em> the sphere, then <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-29-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;&amp;lt;&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-188" style="width: 9.902em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.903em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1007.9em, 2.652em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-189"><span class="msubsup" id="MathJax-Span-190"><span style="display: inline-block; position: relative; width: 1.002em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-191" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.348em; left: 0.552em;"><span class="mn" id="MathJax-Span-192" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-193" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="msubsup" id="MathJax-Span-194" style="padding-left: 0.202em;"><span style="display: inline-block; position: relative; width: 1.002em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.353em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-195" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.348em; left: 0.552em;"><span class="mn" id="MathJax-Span-196" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-197" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="msubsup" id="MathJax-Span-198" style="padding-left: 0.202em;"><span style="display: inline-block; position: relative; width: 0.953em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.45em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-199" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.348em; left: 0.503em;"><span class="mn" id="MathJax-Span-200" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-201" style="font-family: MathJax_Main; padding-left: 0.302em;">&lt;</span><span class="msubsup" id="MathJax-Span-202" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 1.203em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.75em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-203" style="font-family: MathJax_Math-italic;">R</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.348em; left: 0.753em;"><span class="mn" id="MathJax-Span-204" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.441em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><msup><mi>y</mi><mn>2</mn></msup><mo>+</mo><msup><mi>z</mi><mn>2</mn></msup><mo>&lt;</mo><msup><mi>R</mi><mn>2</mn></msup></math></span></span><script type="math/tex" id="MathJax-Element-29">x^2 + y^2 + z^2 < R^2</script>, and if a given point
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-30-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-205" style="width: 3.952em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.152em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1003.05em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-206"><span class="mo" id="MathJax-Span-207" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-208" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-209" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-210" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-211" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-212" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-213" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>z</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-30">(x,y,z)</script> is <em class="underscore">outside</em> the sphere, then <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-31-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;&amp;gt;&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-214" style="width: 9.902em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.903em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1007.9em, 2.652em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-215"><span class="msubsup" id="MathJax-Span-216"><span style="display: inline-block; position: relative; width: 1.002em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-217" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.348em; left: 0.552em;"><span class="mn" id="MathJax-Span-218" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-219" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="msubsup" id="MathJax-Span-220" style="padding-left: 0.202em;"><span style="display: inline-block; position: relative; width: 1.002em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.353em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-221" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.348em; left: 0.552em;"><span class="mn" id="MathJax-Span-222" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-223" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="msubsup" id="MathJax-Span-224" style="padding-left: 0.202em;"><span style="display: inline-block; position: relative; width: 0.953em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.45em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-225" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.348em; left: 0.503em;"><span class="mn" id="MathJax-Span-226" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-227" style="font-family: MathJax_Main; padding-left: 0.302em;">&gt;</span><span class="msubsup" id="MathJax-Span-228" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 1.203em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.75em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-229" style="font-family: MathJax_Math-italic;">R</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.348em; left: 0.753em;"><span class="mn" id="MathJax-Span-230" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.441em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><msup><mi>y</mi><mn>2</mn></msup><mo>+</mo><msup><mi>z</mi><mn>2</mn></msup><mo>&gt;</mo><msup><mi>R</mi><mn>2</mn></msup></math></span></span><script type="math/tex" id="MathJax-Element-31">x^2 + y^2 + z^2 > R^2</script>.

<p></p><p>

It gets uglier if the sphere center is at <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-32-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-231" style="width: 6.403em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.103em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.403em, 1005em, 2.752em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-232"><span class="mo" id="MathJax-Span-233" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-234"><span style="display: inline-block; position: relative; width: 1.203em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.75em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-235" style="font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.053em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.703em;"><span class="mi" id="MathJax-Span-236" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-237" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-238" style="padding-left: 0.152em;"><span style="display: inline-block; position: relative; width: 1.153em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.75em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-239" style="font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.053em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.703em;"><span class="mi" id="MathJax-Span-240" style="font-size: 70.7%; font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-241" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-242" style="padding-left: 0.152em;"><span style="display: inline-block; position: relative; width: 1.103em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.75em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-243" style="font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.053em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.703em;"><span class="mi" id="MathJax-Span-244" style="font-size: 70.7%; font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-245" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.441em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><msub><mi>C</mi><mi>x</mi></msub><mo>,</mo><msub><mi>C</mi><mi>y</mi></msub><mo>,</mo><msub><mi>C</mi><mi>z</mi></msub><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-32">(C_x, C_y, C_z)</script>:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-33-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/msub&gt;&lt;msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/msub&gt;&lt;msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-246" style="width: 20.953em; display: inline-block;"><span style="display: inline-block; position: relative; width: 16.753em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1016.75em, 2.752em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-247"><span class="mo" id="MathJax-Span-248" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-249" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-250" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="msubsup" id="MathJax-Span-251" style="padding-left: 0.202em;"><span style="display: inline-block; position: relative; width: 1.203em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.75em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-252" style="font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.053em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.703em;"><span class="mi" id="MathJax-Span-253" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-254"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px;"><span style="position: absolute; clip: rect(3.103em, 1000.3em, 4.402em, -999.998em); top: -3.998em; left: 0em;"><span class="mo" id="MathJax-Span-255" style="font-family: MathJax_Main;">)</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.397em; left: 0.403em;"><span class="mn" id="MathJax-Span-256" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-257" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mo" id="MathJax-Span-258" style="font-family: MathJax_Main; padding-left: 0.202em;">(</span><span class="mi" id="MathJax-Span-259" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-260" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="msubsup" id="MathJax-Span-261" style="padding-left: 0.202em;"><span style="display: inline-block; position: relative; width: 1.153em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.75em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-262" style="font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.053em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.703em;"><span class="mi" id="MathJax-Span-263" style="font-size: 70.7%; font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-264"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px;"><span style="position: absolute; clip: rect(3.103em, 1000.3em, 4.402em, -999.998em); top: -3.998em; left: 0em;"><span class="mo" id="MathJax-Span-265" style="font-family: MathJax_Main;">)</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.397em; left: 0.403em;"><span class="mn" id="MathJax-Span-266" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-267" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mo" id="MathJax-Span-268" style="font-family: MathJax_Main; padding-left: 0.202em;">(</span><span class="mi" id="MathJax-Span-269" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-270" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="msubsup" id="MathJax-Span-271" style="padding-left: 0.202em;"><span style="display: inline-block; position: relative; width: 1.103em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.75em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-272" style="font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.053em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.703em;"><span class="mi" id="MathJax-Span-273" style="font-size: 70.7%; font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-274"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px;"><span style="position: absolute; clip: rect(3.103em, 1000.3em, 4.402em, -999.998em); top: -3.998em; left: 0em;"><span class="mo" id="MathJax-Span-275" style="font-family: MathJax_Main;">)</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.397em; left: 0.403em;"><span class="mn" id="MathJax-Span-276" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-277" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="msubsup" id="MathJax-Span-278" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 0.903em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.45em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-279" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.397em; left: 0.453em;"><span class="mn" id="MathJax-Span-280" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.628em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><msub><mi>C</mi><mi>x</mi></msub><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>+</mo><mo stretchy="false">(</mo><mi>y</mi><mo>−</mo><msub><mi>C</mi><mi>y</mi></msub><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>+</mo><mo stretchy="false">(</mo><mi>z</mi><mo>−</mo><msub><mi>C</mi><mi>z</mi></msub><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>=</mo><msup><mi>r</mi><mn>2</mn></msup></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-33"> (x - C_x)^2 + (y - C_y)^2 + (z - C_z)^2 = r^2 </script>
</p></div>

<p></p><p>

</p><div class="together">
In graphics, you almost always want your formulas to be in terms of vectors so all the x/y/z stuff
is under the hood in the <code>vec3</code> class. You might note that the vector from center
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-34-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-281" style="width: 9.152em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.303em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.403em, 1007.2em, 2.752em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-282"><span class="texatom" id="MathJax-Span-283"><span class="mrow" id="MathJax-Span-284"><span class="mi" id="MathJax-Span-285" style="font-family: MathJax_Main-bold;">C</span></span></span><span class="mo" id="MathJax-Span-286" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mo" id="MathJax-Span-287" style="font-family: MathJax_Main; padding-left: 0.302em;">(</span><span class="msubsup" id="MathJax-Span-288"><span style="display: inline-block; position: relative; width: 1.203em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.75em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-289" style="font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.053em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.703em;"><span class="mi" id="MathJax-Span-290" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-291" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-292" style="padding-left: 0.152em;"><span style="display: inline-block; position: relative; width: 1.153em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.75em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-293" style="font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.053em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.703em;"><span class="mi" id="MathJax-Span-294" style="font-size: 70.7%; font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-295" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-296" style="padding-left: 0.152em;"><span style="display: inline-block; position: relative; width: 1.103em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.75em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-297" style="font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.053em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.703em;"><span class="mi" id="MathJax-Span-298" style="font-size: 70.7%; font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-299" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.441em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">C</mi></mrow><mo>=</mo><mo stretchy="false">(</mo><msub><mi>C</mi><mi>x</mi></msub><mo>,</mo><msub><mi>C</mi><mi>y</mi></msub><mo>,</mo><msub><mi>C</mi><mi>z</mi></msub><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-34">\mathbf{C} = (C_x,C_y,C_z)</script> to point <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-35-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-300" style="width: 6.703em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.353em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1005.25em, 2.603em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-301"><span class="texatom" id="MathJax-Span-302"><span class="mrow" id="MathJax-Span-303"><span class="mi" id="MathJax-Span-304" style="font-family: MathJax_Main-bold;">P</span></span></span><span class="mo" id="MathJax-Span-305" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mo" id="MathJax-Span-306" style="font-family: MathJax_Main; padding-left: 0.302em;">(</span><span class="mi" id="MathJax-Span-307" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-308" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-309" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-310" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-311" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-312" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo>=</mo><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>z</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-35">\mathbf{P} = (x,y,z)</script> is <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-36-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-313" style="width: 4.502em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.603em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.403em, 1003.5em, 2.702em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-314"><span class="mo" id="MathJax-Span-315" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-316"><span class="mrow" id="MathJax-Span-317"><span class="mi" id="MathJax-Span-318" style="font-family: MathJax_Main-bold;">P</span></span></span><span class="mo" id="MathJax-Span-319" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="texatom" id="MathJax-Span-320" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-321"><span class="mi" id="MathJax-Span-322" style="font-family: MathJax_Main-bold;">C</span></span></span><span class="mo" id="MathJax-Span-323" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">C</mi></mrow><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-36">(\mathbf{P} - \mathbf{C})</script>, and
therefore

<p></p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-37-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/msub&gt;&lt;msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/msub&gt;&lt;msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-324" style="width: 29.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 23.703em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1023.7em, 2.752em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-325"><span class="mo" id="MathJax-Span-326" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-327"><span class="mrow" id="MathJax-Span-328"><span class="mi" id="MathJax-Span-329" style="font-family: MathJax_Main-bold;">P</span></span></span><span class="mo" id="MathJax-Span-330" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="texatom" id="MathJax-Span-331" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-332"><span class="mi" id="MathJax-Span-333" style="font-family: MathJax_Main-bold;">C</span></span></span><span class="mo" id="MathJax-Span-334" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-335" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mo" id="MathJax-Span-336" style="font-family: MathJax_Main; padding-left: 0.202em;">(</span><span class="texatom" id="MathJax-Span-337"><span class="mrow" id="MathJax-Span-338"><span class="mi" id="MathJax-Span-339" style="font-family: MathJax_Main-bold;">P</span></span></span><span class="mo" id="MathJax-Span-340" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="texatom" id="MathJax-Span-341" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-342"><span class="mi" id="MathJax-Span-343" style="font-family: MathJax_Main-bold;">C</span></span></span><span class="mo" id="MathJax-Span-344" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-345" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mo" id="MathJax-Span-346" style="font-family: MathJax_Main; padding-left: 0.302em;">(</span><span class="mi" id="MathJax-Span-347" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-348" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="msubsup" id="MathJax-Span-349" style="padding-left: 0.202em;"><span style="display: inline-block; position: relative; width: 1.203em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.75em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-350" style="font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.053em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.703em;"><span class="mi" id="MathJax-Span-351" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-352"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px;"><span style="position: absolute; clip: rect(3.103em, 1000.3em, 4.402em, -999.998em); top: -3.998em; left: 0em;"><span class="mo" id="MathJax-Span-353" style="font-family: MathJax_Main;">)</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.397em; left: 0.403em;"><span class="mn" id="MathJax-Span-354" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-355" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mo" id="MathJax-Span-356" style="font-family: MathJax_Main; padding-left: 0.202em;">(</span><span class="mi" id="MathJax-Span-357" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-358" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="msubsup" id="MathJax-Span-359" style="padding-left: 0.202em;"><span style="display: inline-block; position: relative; width: 1.153em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.75em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-360" style="font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.053em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.703em;"><span class="mi" id="MathJax-Span-361" style="font-size: 70.7%; font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-362"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px;"><span style="position: absolute; clip: rect(3.103em, 1000.3em, 4.402em, -999.998em); top: -3.998em; left: 0em;"><span class="mo" id="MathJax-Span-363" style="font-family: MathJax_Main;">)</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.397em; left: 0.403em;"><span class="mn" id="MathJax-Span-364" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-365" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mo" id="MathJax-Span-366" style="font-family: MathJax_Main; padding-left: 0.202em;">(</span><span class="mi" id="MathJax-Span-367" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-368" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="msubsup" id="MathJax-Span-369" style="padding-left: 0.202em;"><span style="display: inline-block; position: relative; width: 1.103em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.75em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-370" style="font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.053em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.703em;"><span class="mi" id="MathJax-Span-371" style="font-size: 70.7%; font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-372"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px;"><span style="position: absolute; clip: rect(3.103em, 1000.3em, 4.402em, -999.998em); top: -3.998em; left: 0em;"><span class="mo" id="MathJax-Span-373" style="font-family: MathJax_Main;">)</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.397em; left: 0.403em;"><span class="mn" id="MathJax-Span-374" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.628em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">C</mi></mrow><mo stretchy="false">)</mo><mo>⋅</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">C</mi></mrow><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><msub><mi>C</mi><mi>x</mi></msub><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>+</mo><mo stretchy="false">(</mo><mi>y</mi><mo>−</mo><msub><mi>C</mi><mi>y</mi></msub><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>+</mo><mo stretchy="false">(</mo><mi>z</mi><mo>−</mo><msub><mi>C</mi><mi>z</mi></msub><msup><mo stretchy="false">)</mo><mn>2</mn></msup></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-37"> (\mathbf{P} - \mathbf{C}) \cdot (\mathbf{P} - \mathbf{C})
     = (x - C_x)^2 + (y - C_y)^2 + (z - C_z)^2
  </script>
</p></div>

<p></p><p>

</p><div class="together">
So the equation of the sphere in vector form is:

<p></p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-38-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-375" style="width: 12.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.103em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1010.1em, 2.702em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-376"><span class="mo" id="MathJax-Span-377" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-378"><span class="mrow" id="MathJax-Span-379"><span class="mi" id="MathJax-Span-380" style="font-family: MathJax_Main-bold;">P</span></span></span><span class="mo" id="MathJax-Span-381" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="texatom" id="MathJax-Span-382" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-383"><span class="mi" id="MathJax-Span-384" style="font-family: MathJax_Main-bold;">C</span></span></span><span class="mo" id="MathJax-Span-385" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-386" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mo" id="MathJax-Span-387" style="font-family: MathJax_Main; padding-left: 0.202em;">(</span><span class="texatom" id="MathJax-Span-388"><span class="mrow" id="MathJax-Span-389"><span class="mi" id="MathJax-Span-390" style="font-family: MathJax_Main-bold;">P</span></span></span><span class="mo" id="MathJax-Span-391" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="texatom" id="MathJax-Span-392" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-393"><span class="mi" id="MathJax-Span-394" style="font-family: MathJax_Main-bold;">C</span></span></span><span class="mo" id="MathJax-Span-395" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-396" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="msubsup" id="MathJax-Span-397" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 0.903em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.45em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-398" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.397em; left: 0.453em;"><span class="mn" id="MathJax-Span-399" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.566em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">C</mi></mrow><mo stretchy="false">)</mo><mo>⋅</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">C</mi></mrow><mo stretchy="false">)</mo><mo>=</mo><msup><mi>r</mi><mn>2</mn></msup></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-38"> (\mathbf{P} - \mathbf{C}) \cdot (\mathbf{P} - \mathbf{C}) = r^2 </script>
</p></div>

<p></p><p>

</p><div class="together">
We can read this as “any point <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-39-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-400" style="width: 1.002em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1000.75em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-401"><span class="texatom" id="MathJax-Span-402"><span class="mrow" id="MathJax-Span-403"><span class="mi" id="MathJax-Span-404" style="font-family: MathJax_Main-bold;">P</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-39">\mathbf{P}</script> that satisfies this equation is on the sphere”. We want
to know if our ray <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-40-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;A&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-405" style="width: 7.953em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.353em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.403em, 1006.3em, 2.702em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-406"><span class="texatom" id="MathJax-Span-407"><span class="mrow" id="MathJax-Span-408"><span class="mi" id="MathJax-Span-409" style="font-family: MathJax_Main-bold;">P</span></span></span><span class="mo" id="MathJax-Span-410" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-411" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-412" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-413" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="texatom" id="MathJax-Span-414" style="padding-left: 0.302em;"><span class="mrow" id="MathJax-Span-415"><span class="mi" id="MathJax-Span-416" style="font-family: MathJax_Main-bold;">A</span></span></span><span class="mo" id="MathJax-Span-417" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-418" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">t</span><span class="texatom" id="MathJax-Span-419"><span class="mrow" id="MathJax-Span-420"><span class="mi" id="MathJax-Span-421" style="font-family: MathJax_Main-bold;">b</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo><mo>=</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">A</mi></mrow><mo>+</mo><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-40">\mathbf{P}(t) = \mathbf{A} + t\mathbf{b}</script> ever hits the sphere anywhere. If it
does hit the sphere, there is some <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-41-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-422" style="width: 0.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.352em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.103em, 1000.3em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-423"><span class="mi" id="MathJax-Span-424" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-41">t</script> for which <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-42-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-425" style="width: 2.452em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.952em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1001.85em, 2.603em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-426"><span class="texatom" id="MathJax-Span-427"><span class="mrow" id="MathJax-Span-428"><span class="mi" id="MathJax-Span-429" style="font-family: MathJax_Main-bold;">P</span></span></span><span class="mo" id="MathJax-Span-430" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-431" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-432" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-42">\mathbf{P}(t)</script> satisfies the sphere equation. So
we are looking for any <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-43-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-433" style="width: 0.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.352em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.103em, 1000.3em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-434"><span class="mi" id="MathJax-Span-435" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-43">t</script> where this is true:

<p></p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-44-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-436" style="width: 15.503em; display: inline-block;"><span style="display: inline-block; position: relative; width: 12.402em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1012.4em, 2.702em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-437"><span class="mo" id="MathJax-Span-438" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-439"><span class="mrow" id="MathJax-Span-440"><span class="mi" id="MathJax-Span-441" style="font-family: MathJax_Main-bold;">P</span></span></span><span class="mo" id="MathJax-Span-442" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-443" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-444" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-445" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="texatom" id="MathJax-Span-446" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-447"><span class="mi" id="MathJax-Span-448" style="font-family: MathJax_Main-bold;">C</span></span></span><span class="mo" id="MathJax-Span-449" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-450" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mo" id="MathJax-Span-451" style="font-family: MathJax_Main; padding-left: 0.202em;">(</span><span class="texatom" id="MathJax-Span-452"><span class="mrow" id="MathJax-Span-453"><span class="mi" id="MathJax-Span-454" style="font-family: MathJax_Main-bold;">P</span></span></span><span class="mo" id="MathJax-Span-455" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-456" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-457" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-458" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="texatom" id="MathJax-Span-459" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-460"><span class="mi" id="MathJax-Span-461" style="font-family: MathJax_Main-bold;">C</span></span></span><span class="mo" id="MathJax-Span-462" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-463" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="msubsup" id="MathJax-Span-464" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 0.903em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.45em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-465" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.397em; left: 0.453em;"><span class="mn" id="MathJax-Span-466" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.566em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">C</mi></mrow><mo stretchy="false">)</mo><mo>⋅</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">C</mi></mrow><mo stretchy="false">)</mo><mo>=</mo><msup><mi>r</mi><mn>2</mn></msup></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-44"> (\mathbf{P}(t) - \mathbf{C}) \cdot (\mathbf{P}(t) - \mathbf{C}) = r^2 </script>

</p><p>

or expanding the full form of the ray <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-45-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-467" style="width: 2.452em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.952em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1001.85em, 2.603em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-468"><span class="texatom" id="MathJax-Span-469"><span class="mrow" id="MathJax-Span-470"><span class="mi" id="MathJax-Span-471" style="font-family: MathJax_Main-bold;">P</span></span></span><span class="mo" id="MathJax-Span-472" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-473" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-474" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-45">\mathbf{P}(t)</script>:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-46-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;A&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;A&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-475" style="width: 18.352em; display: inline-block;"><span style="display: inline-block; position: relative; width: 14.652em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1014.65em, 2.702em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-476"><span class="mo" id="MathJax-Span-477" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-478"><span class="mrow" id="MathJax-Span-479"><span class="mi" id="MathJax-Span-480" style="font-family: MathJax_Main-bold;">A</span></span></span><span class="mo" id="MathJax-Span-481" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-482" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">t</span><span class="texatom" id="MathJax-Span-483"><span class="mrow" id="MathJax-Span-484"><span class="mi" id="MathJax-Span-485" style="font-family: MathJax_Main-bold;">b</span></span></span><span class="mo" id="MathJax-Span-486" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="texatom" id="MathJax-Span-487" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-488"><span class="mi" id="MathJax-Span-489" style="font-family: MathJax_Main-bold;">C</span></span></span><span class="mo" id="MathJax-Span-490" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-491" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mo" id="MathJax-Span-492" style="font-family: MathJax_Main; padding-left: 0.202em;">(</span><span class="texatom" id="MathJax-Span-493"><span class="mrow" id="MathJax-Span-494"><span class="mi" id="MathJax-Span-495" style="font-family: MathJax_Main-bold;">A</span></span></span><span class="mo" id="MathJax-Span-496" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-497" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">t</span><span class="texatom" id="MathJax-Span-498"><span class="mrow" id="MathJax-Span-499"><span class="mi" id="MathJax-Span-500" style="font-family: MathJax_Main-bold;">b</span></span></span><span class="mo" id="MathJax-Span-501" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="texatom" id="MathJax-Span-502" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-503"><span class="mi" id="MathJax-Span-504" style="font-family: MathJax_Main-bold;">C</span></span></span><span class="mo" id="MathJax-Span-505" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-506" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="msubsup" id="MathJax-Span-507" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 0.903em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.45em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-508" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.397em; left: 0.453em;"><span class="mn" id="MathJax-Span-509" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.566em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">A</mi></mrow><mo>+</mo><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">C</mi></mrow><mo stretchy="false">)</mo><mo>⋅</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">A</mi></mrow><mo>+</mo><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">C</mi></mrow><mo stretchy="false">)</mo><mo>=</mo><msup><mi>r</mi><mn>2</mn></msup></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-46"> (\mathbf{A} + t \mathbf{b} - \mathbf{C})
      \cdot (\mathbf{A} + t \mathbf{b} - \mathbf{C}) = r^2 </script>
</p></div>

<p></p><p>

</p><div class="together">
The rules of vector algebra are all that we would want here. If we expand that equation and move all
the terms to the left hand side we get:

<p></p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-47-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msup&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;A&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;A&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;A&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;C&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-510" style="width: 28.702em; display: inline-block;"><span style="display: inline-block; position: relative; width: 22.953em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1022.9em, 2.702em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-511"><span class="msubsup" id="MathJax-Span-512"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px;"><span style="position: absolute; clip: rect(3.202em, 1000.35em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-513" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.397em; left: 0.352em;"><span class="mn" id="MathJax-Span-514" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="texatom" id="MathJax-Span-515"><span class="mrow" id="MathJax-Span-516"><span class="mi" id="MathJax-Span-517" style="font-family: MathJax_Main-bold;">b</span></span></span><span class="mo" id="MathJax-Span-518" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="texatom" id="MathJax-Span-519" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-520"><span class="mi" id="MathJax-Span-521" style="font-family: MathJax_Main-bold;">b</span></span></span><span class="mo" id="MathJax-Span-522" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mn" id="MathJax-Span-523" style="font-family: MathJax_Main; padding-left: 0.202em;">2</span><span class="mi" id="MathJax-Span-524" style="font-family: MathJax_Math-italic;">t</span><span class="texatom" id="MathJax-Span-525"><span class="mrow" id="MathJax-Span-526"><span class="mi" id="MathJax-Span-527" style="font-family: MathJax_Main-bold;">b</span></span></span><span class="mo" id="MathJax-Span-528" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mo" id="MathJax-Span-529" style="font-family: MathJax_Main; padding-left: 0.202em;">(</span><span class="texatom" id="MathJax-Span-530"><span class="mrow" id="MathJax-Span-531"><span class="mi" id="MathJax-Span-532" style="font-family: MathJax_Main-bold;">A</span></span></span><span class="mo" id="MathJax-Span-533" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="texatom" id="MathJax-Span-534" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-535"><span class="mi" id="MathJax-Span-536" style="font-family: MathJax_Main-bold;">C</span></span></span><span class="mo" id="MathJax-Span-537" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-538" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mo" id="MathJax-Span-539" style="font-family: MathJax_Main; padding-left: 0.202em;">(</span><span class="texatom" id="MathJax-Span-540"><span class="mrow" id="MathJax-Span-541"><span class="mi" id="MathJax-Span-542" style="font-family: MathJax_Main-bold;">A</span></span></span><span class="mo" id="MathJax-Span-543" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="texatom" id="MathJax-Span-544" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-545"><span class="mi" id="MathJax-Span-546" style="font-family: MathJax_Main-bold;">C</span></span></span><span class="mo" id="MathJax-Span-547" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-548" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mo" id="MathJax-Span-549" style="font-family: MathJax_Main; padding-left: 0.202em;">(</span><span class="texatom" id="MathJax-Span-550"><span class="mrow" id="MathJax-Span-551"><span class="mi" id="MathJax-Span-552" style="font-family: MathJax_Main-bold;">A</span></span></span><span class="mo" id="MathJax-Span-553" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="texatom" id="MathJax-Span-554" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-555"><span class="mi" id="MathJax-Span-556" style="font-family: MathJax_Main-bold;">C</span></span></span><span class="mo" id="MathJax-Span-557" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-558" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="msubsup" id="MathJax-Span-559" style="padding-left: 0.202em;"><span style="display: inline-block; position: relative; width: 0.903em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.45em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-560" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.397em; left: 0.453em;"><span class="mn" id="MathJax-Span-561" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-562" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mn" id="MathJax-Span-563" style="font-family: MathJax_Main; padding-left: 0.302em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.566em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msup><mi>t</mi><mn>2</mn></msup><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow><mo>⋅</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow><mo>+</mo><mn>2</mn><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow><mo>⋅</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">A</mi></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">C</mi></mrow><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">A</mi></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">C</mi></mrow><mo stretchy="false">)</mo><mo>⋅</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">A</mi></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">C</mi></mrow><mo stretchy="false">)</mo><mo>−</mo><msup><mi>r</mi><mn>2</mn></msup><mo>=</mo><mn>0</mn></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-47"> t^2 \mathbf{b} \cdot \mathbf{b}
     + 2t \mathbf{b} \cdot (\mathbf{A}-\mathbf{C})
     + (\mathbf{A}-\mathbf{C}) \cdot (\mathbf{A}-\mathbf{C}) - r^2 = 0
  </script>
</p></div>

<p></p><p>

</p><div class="together">
The vectors and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-48-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-564" style="width: 0.603em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.453em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1000.45em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-565"><span class="mi" id="MathJax-Span-566" style="font-family: MathJax_Math-italic;">r</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>r</mi></math></span></span><script type="math/tex" id="MathJax-Element-48">r</script> in that equation are all constant and known. The unknown is <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-49-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-567" style="width: 0.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.352em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.103em, 1000.3em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-568"><span class="mi" id="MathJax-Span-569" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-49">t</script>, and the
equation is a quadratic, like you probably saw in your high school math class. You can solve for <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-50-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-570" style="width: 0.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.352em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.103em, 1000.3em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-571"><span class="mi" id="MathJax-Span-572" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-50">t</script>
and there is a square root part that is either positive (meaning two real solutions), negative
(meaning no real solutions), or zero (meaning one real solution). In graphics, the algebra almost
always relates very directly to the geometry. What we have is:

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/fig-1.04-ray-sphere.jpg" target="_blank"><img class="markdeep" src="./Ray Tracing in One Weekend_files/fig-1.04-ray-sphere.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_ray-sphere">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;4:</b> Ray-sphere intersection results</span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="creatingourfirstraytracedimage">&nbsp;</a><a class="target" name="addingasphere/creatingourfirstraytracedimage">&nbsp;</a><a class="target" name="toc5.2">&nbsp;</a><h2>Creating Our First Raytraced Image</h2>
<p>

</p><div class="together">
If we take that math and hard-code it into our program, we can test it by coloring red any pixel
that hits a small sphere we place at −1 on the z-axis:

<p></p><pre class="listing tilde"><code><div class=" highlight"><span class="line"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">hit_sphere</span><span class="hljs-params">(<span class="hljs-keyword">const</span> point3&amp; center, <span class="hljs-keyword">double</span> radius, <span class="hljs-keyword">const</span> ray&amp; r)</span> </span>{</span>
<span class="line">    vec3 oc = r.origin() - center;</span>
<span class="line">    <span class="hljs-keyword">auto</span> a = dot(r.direction(), r.direction());</span>
<span class="line">    <span class="hljs-keyword">auto</span> b = <span class="hljs-number">2.0</span> * dot(oc, r.direction());</span>
<span class="line">    <span class="hljs-keyword">auto</span> c = dot(oc, oc) - radius*radius;</span>
<span class="line">    <span class="hljs-keyword">auto</span> discriminant = b*b - <span class="hljs-number">4</span>*a*c;</span>
<span class="line">    <span class="hljs-keyword">return</span> (discriminant &gt; <span class="hljs-number">0</span>);</span>
<span class="line">}</span></div><span class="line"></span>
<span class="line"></span><span class="line"><span class="hljs-function">color <span class="hljs-title">ray_color</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ray&amp; r)</span> </span>{</span><div class=" highlight"><span class="line">    <span class="hljs-keyword">if</span> (hit_sphere(point3(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">-1</span>), <span class="hljs-number">0.5</span>, r))</span>
<span class="line">        <span class="hljs-keyword">return</span> color(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);</span></div><span class="line">    vec3 unit_direction = unit_vector(r.direction());</span>
<span class="line">    <span class="hljs-keyword">auto</span> t = <span class="hljs-number">0.5</span>*(unit_direction.y() + <span class="hljs-number">1.0</span>);</span>
<span class="line">    <span class="hljs-keyword">return</span> (<span class="hljs-number">1.0</span>-t)*color(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>) + t*color(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.7</span>, <span class="hljs-number">1.0</span>);</span>
<span class="line">}</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_main-red-sphere">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;10:</b> <kbd>[main.cc]</kbd> Rendering a red sphere</div></center>
<p>

</p></div>

<p></p><p>

</p><div class="together">
What we get is this:

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/img-1.03-red-sphere.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing in One Weekend_files/img-1.03-red-sphere.png"></a><center><span class="imagecaption">Image 3: A simple red sphere</span></center></div></center>

<p></p><p>

</p></div>

<p></p><p>

Now this lacks all sorts of things — like shading and reflection rays and more than one object —
but we are closer to halfway done than we are to our start! One thing to be aware of is that we
tested whether the ray hits the sphere at all, but <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-51-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;&amp;lt;&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-573" style="width: 2.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.252em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1002.2em, 2.353em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-574"><span class="mi" id="MathJax-Span-575" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-576" style="font-family: MathJax_Main; padding-left: 0.302em;">&lt;</span><span class="mn" id="MathJax-Span-577" style="font-family: MathJax_Main; padding-left: 0.302em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.122em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi><mo>&lt;</mo><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-51">t < 0</script> solutions work fine. If you change your
sphere center to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-52-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-578" style="width: 3.952em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.152em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1003.1em, 2.402em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-579"><span class="mi" id="MathJax-Span-580" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-581" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mo" id="MathJax-Span-582" style="font-family: MathJax_Main; padding-left: 0.302em;">+</span><span class="mn" id="MathJax-Span-583" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.184em; border-left: 0px solid; width: 0px; height: 1.066em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>z</mi><mo>=</mo><mo>+</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-52">z = +1</script> you will get exactly the same picture because you see the things behind
you. This is not a feature! We’ll fix those issues next.

</p>
<a class="target" name="surfacenormalsandmultipleobjects">&nbsp;</a><a class="target" name="surfacenormalsandmultipleobjects">&nbsp;</a><a class="target" name="toc6">&nbsp;</a><h1>Surface Normals and Multiple Objects</h1>

<a class="target" name="shadingwithsurfacenormals">&nbsp;</a><a class="target" name="surfacenormalsandmultipleobjects/shadingwithsurfacenormals">&nbsp;</a><a class="target" name="toc6.1">&nbsp;</a><h2>Shading with Surface Normals</h2>
<p>

First, let’s get ourselves a surface normal so we can shade. This is a vector that is perpendicular
to the surface at the point of intersection. There are two design decisions to make for normals.
The first is whether these normals are unit length. That is convenient for shading so I will say
yes, but I won’t enforce that in the code. This could allow subtle bugs, so be aware this is
personal preference as are most design decisions like that. For a sphere, the outward normal is in
the direction of the hit point minus the center:

</p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/fig-1.05-sphere-normal.jpg" target="_blank"><img class="markdeep" src="./Ray Tracing in One Weekend_files/fig-1.05-sphere-normal.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_sphere-normal">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;5:</b> Sphere surface-normal geometry</span></center></div></center>

<p></p><p>

</p><div class="together">
On the earth, this implies that the vector from the earth’s center to you points straight up. Let’s
throw that into the code now, and shade it. We don’t have any lights or anything yet, so let’s just
visualize the normals with a color map. A common trick used for visualizing normals (because it’s
easy and somewhat intuitive to assume <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-53-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-584" style="width: 0.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.653em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.602em, 1000.65em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-585"><span class="texatom" id="MathJax-Span-586"><span class="mrow" id="MathJax-Span-587"><span class="mi" id="MathJax-Span-588" style="font-family: MathJax_Main-bold;">n</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-53">\mathbf{n}</script> is a unit length vector — so each
component is between −1 and 1) is to map each component to the interval from 0 to 1, and then map
x/y/z to r/g/b. For the normal, we need the hit point, not just whether we hit or not. We only have
one sphere in the scene, and it's directly in front of the camera, so we won't worry about negative
values of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-54-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-589" style="width: 0.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.352em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.103em, 1000.3em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-590"><span class="mi" id="MathJax-Span-591" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-54">t</script> yet. We'll just assume the closest hit point (smallest <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-55-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-592" style="width: 0.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.352em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.103em, 1000.3em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-593"><span class="mi" id="MathJax-Span-594" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-55">t</script>). These changes in the code
let us compute and visualize <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-56-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-595" style="width: 0.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.653em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.602em, 1000.65em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-596"><span class="texatom" id="MathJax-Span-597"><span class="mrow" id="MathJax-Span-598"><span class="mi" id="MathJax-Span-599" style="font-family: MathJax_Main-bold;">n</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-56">\mathbf{n}</script>:

<p></p><pre class="listing tilde"><code><div class=" highlight"><span class="line"><span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">hit_sphere</span><span class="hljs-params">(<span class="hljs-keyword">const</span> point3&amp; center, <span class="hljs-keyword">double</span> radius, <span class="hljs-keyword">const</span> ray&amp; r)</span> </span>{</span></div><span class="line">    vec3 oc = r.origin() - center;</span>
<span class="line">    <span class="hljs-keyword">auto</span> a = dot(r.direction(), r.direction());</span>
<span class="line">    <span class="hljs-keyword">auto</span> b = <span class="hljs-number">2.0</span> * dot(oc, r.direction());</span>
<span class="line">    <span class="hljs-keyword">auto</span> c = dot(oc, oc) - radius*radius;</span>
<span class="line">    <span class="hljs-keyword">auto</span> discriminant = b*b - <span class="hljs-number">4</span>*a*c;</span>
<span class="line"></span><div class=" highlight"><span class="line">    <span class="hljs-keyword">if</span> (discriminant &lt; <span class="hljs-number">0</span>) {</span>
<span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-number">-1.0</span>;</span>
<span class="line">    } <span class="hljs-keyword">else</span> {</span>
<span class="line">        <span class="hljs-keyword">return</span> (-b - <span class="hljs-built_in">sqrt</span>(discriminant) ) / (<span class="hljs-number">2.0</span>*a);</span>
<span class="line">    }</span></div><span class="line">}</span>
<span class="line"></span>
<span class="line"><span class="hljs-function">color <span class="hljs-title">ray_color</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ray&amp; r)</span> </span>{</span><div class=" highlight"><span class="line">    <span class="hljs-keyword">auto</span> t = hit_sphere(point3(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">-1</span>), <span class="hljs-number">0.5</span>, r);</span>
<span class="line">    <span class="hljs-keyword">if</span> (t &gt; <span class="hljs-number">0.0</span>) {</span>
<span class="line">        vec3 N = unit_vector(r.at(t) - vec3(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">-1</span>));</span>
<span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-number">0.5</span>*color(N.x()+<span class="hljs-number">1</span>, N.y()+<span class="hljs-number">1</span>, N.z()+<span class="hljs-number">1</span>);</span>
<span class="line">    }</span></div><span class="line">    vec3 unit_direction = unit_vector(r.direction());</span><div class=" highlight"><span class="line">    t = <span class="hljs-number">0.5</span>*(unit_direction.y() + <span class="hljs-number">1.0</span>);</span></div><span class="line">    <span class="hljs-keyword">return</span> (<span class="hljs-number">1.0</span>-t)*color(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>) + t*color(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.7</span>, <span class="hljs-number">1.0</span>);</span>
<span class="line">}</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_render-surface-normal">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;11:</b> <kbd>[main.cc]</kbd> Rendering surface normals on a sphere</div></center>
<p>

</p></div>

<p></p><p>

</p><div class="together">
And that yields this picture:

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/img-1.04-normals-sphere.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing in One Weekend_files/img-1.04-normals-sphere.png"></a><center><span class="imagecaption">Image 4: A sphere colored according to its normal vectors
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="simplifyingtheray-sphereintersectioncode">&nbsp;</a><a class="target" name="surfacenormalsandmultipleobjects/simplifyingtheray-sphereintersectioncode">&nbsp;</a><a class="target" name="toc6.2">&nbsp;</a><h2>Simplifying the Ray-Sphere Intersection Code</h2>
<p>

Let’s revisit the ray-sphere equation:

</p><pre class="listing tilde"><code><span class="line"><span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">hit_sphere</span><span class="hljs-params">(<span class="hljs-keyword">const</span> point3&amp; center, <span class="hljs-keyword">double</span> radius, <span class="hljs-keyword">const</span> ray&amp; r)</span> </span>{</span>
<span class="line">    vec3 oc = r.origin() - center;</span>
<span class="line">    <span class="hljs-keyword">auto</span> a = dot(r.direction(), r.direction());</span>
<span class="line">    <span class="hljs-keyword">auto</span> b = <span class="hljs-number">2.0</span> * dot(oc, r.direction());</span>
<span class="line">    <span class="hljs-keyword">auto</span> c = dot(oc, oc) - radius*radius;</span>
<span class="line">    <span class="hljs-keyword">auto</span> discriminant = b*b - <span class="hljs-number">4</span>*a*c;</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">if</span> (discriminant &lt; <span class="hljs-number">0</span>) {</span>
<span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-number">-1.0</span>;</span>
<span class="line">    } <span class="hljs-keyword">else</span> {</span>
<span class="line">        <span class="hljs-keyword">return</span> (-b - <span class="hljs-built_in">sqrt</span>(discriminant) ) / (<span class="hljs-number">2.0</span>*a);</span>
<span class="line">    }</span>
<span class="line">}</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_ray-sphere-before">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;12:</b> <kbd>[main.cc]</kbd> Ray-sphere intersection code (before)</div></center>
<p>


First, recall that a vector dotted with itself is equal to the squared length of that vector.

</p><p>

Second, notice how the equation for <code>b</code> has a factor of two in it. Consider what happens to the
quadratic equation if <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-57-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-600" style="width: 3.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.902em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1002.9em, 2.302em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-601"><span class="mi" id="MathJax-Span-602" style="font-family: MathJax_Math-italic;">b</span><span class="mo" id="MathJax-Span-603" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mn" id="MathJax-Span-604" style="font-family: MathJax_Main; padding-left: 0.302em;">2</span><span class="mi" id="MathJax-Span-605" style="font-family: MathJax_Math-italic;">h</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>b</mi><mo>=</mo><mn>2</mn><mi>h</mi></math></span></span><script type="math/tex" id="MathJax-Element-57">b = 2h</script>:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-58-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mo&gt;&amp;#x00B1;&lt;/mo&gt;&lt;msqrt&gt;&lt;msup&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;4&lt;/mn&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;/msqrt&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-606" style="width: 8.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.053em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(-0.698em, 1007.05em, 1.852em, -999.998em); top: -0.997em; left: 0em;"><span class="mrow" id="MathJax-Span-607"><span class="mfrac" id="MathJax-Span-608"><span style="display: inline-block; position: relative; width: 6.853em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.002em, 1006.7em, 4.303em, -999.998em); top: -4.697em; left: 50%; margin-left: -3.348em;"><span class="mrow" id="MathJax-Span-609"><span class="mo" id="MathJax-Span-610" style="font-family: MathJax_Main;">−</span><span class="mi" id="MathJax-Span-611" style="font-family: MathJax_Math-italic;">b</span><span class="mo" id="MathJax-Span-612" style="font-family: MathJax_Main; padding-left: 0.202em;">±</span><span class="msqrt" id="MathJax-Span-613" style="padding-left: 0.202em;"><span style="display: inline-block; position: relative; width: 4.353em; height: 0px;"><span style="position: absolute; clip: rect(3.103em, 1003.5em, 4.252em, -999.998em); top: -3.998em; left: 0.853em;"><span class="mrow" id="MathJax-Span-614"><span class="msubsup" id="MathJax-Span-615"><span style="display: inline-block; position: relative; width: 0.853em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.4em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-616" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.298em; left: 0.453em;"><span class="mn" id="MathJax-Span-617" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-618" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="mn" id="MathJax-Span-619" style="font-family: MathJax_Main; padding-left: 0.202em;">4</span><span class="mi" id="MathJax-Span-620" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-621" style="font-family: MathJax_Math-italic;">c</span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.603em, 1003.45em, 3.902em, -999.998em); top: -4.548em; left: 0.853em;"><span style="display: inline-block; position: relative; width: 3.452em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.998em; left: -0.098em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.998em; left: 2.752em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 0.403em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 0.853em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 1.353em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 1.852em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 2.353em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.052em, 1000.85em, 4.353em, -999.998em); top: -4.048em; left: 0em;"><span style="font-family: MathJax_Main;">√</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.202em, 1001em, 4.152em, -999.998em); top: -3.298em; left: 50%; margin-left: -0.497em;"><span class="mrow" id="MathJax-Span-622"><span class="mn" id="MathJax-Span-623" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-624" style="font-family: MathJax_Math-italic;">a</span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(0.853em, 1006.85em, 1.203em, -999.998em); top: -1.248em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 6.853em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.052em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.002em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.934em; border-left: 0px solid; width: 0px; height: 2.878em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mfrac><mrow><mo>−</mo><mi>b</mi><mo>±</mo><msqrt><msup><mi>b</mi><mn>2</mn></msup><mo>−</mo><mn>4</mn><mi>a</mi><mi>c</mi></msqrt></mrow><mrow><mn>2</mn><mi>a</mi></mrow></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-58"> \frac{-b \pm \sqrt{b^2 - 4ac}}{2a} </script>

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-59-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;mo&gt;&amp;#x00B1;&lt;/mo&gt;&lt;msqrt&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;4&lt;/mn&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;/msqrt&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-625" style="width: 13.003em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.402em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.503em, 1010.4em, 3.152em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-626"><span class="mo" id="MathJax-Span-627" style="font-family: MathJax_Main;">=</span><span class="mfrac" id="MathJax-Span-628" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 9.103em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.002em, 1008.95em, 4.502em, -999.998em); top: -4.798em; left: 50%; margin-left: -4.498em;"><span class="mrow" id="MathJax-Span-629"><span class="mo" id="MathJax-Span-630" style="font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-631" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-632" style="font-family: MathJax_Math-italic;">h</span><span class="mo" id="MathJax-Span-633" style="font-family: MathJax_Main; padding-left: 0.202em;">±</span><span class="msqrt" id="MathJax-Span-634" style="padding-left: 0.202em;"><span style="display: inline-block; position: relative; width: 5.952em; height: 0px;"><span style="position: absolute; clip: rect(3.103em, 1004.9em, 4.402em, -999.998em); top: -3.998em; left: 1.002em;"><span class="mrow" id="MathJax-Span-635"><span class="mo" id="MathJax-Span-636" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-637" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-638" style="font-family: MathJax_Math-italic;">h</span><span class="msubsup" id="MathJax-Span-639"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px;"><span style="position: absolute; clip: rect(3.103em, 1000.3em, 4.402em, -999.998em); top: -3.998em; left: 0em;"><span class="mo" id="MathJax-Span-640" style="font-family: MathJax_Main;">)</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.298em; left: 0.403em;"><span class="mn" id="MathJax-Span-641" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-642" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="mn" id="MathJax-Span-643" style="font-family: MathJax_Main; padding-left: 0.202em;">4</span><span class="mi" id="MathJax-Span-644" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-645" style="font-family: MathJax_Math-italic;">c</span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.603em, 1004.85em, 3.902em, -999.998em); top: -4.598em; left: 1.002em;"><span style="display: inline-block; position: relative; width: 4.853em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.998em; left: -0.098em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.998em; left: 4.152em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 0.453em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 1.002em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 1.552em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 2.052em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 2.603em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 3.152em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 3.702em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.002em, 1001em, 4.502em, -999.998em); top: -3.998em; left: 0em;"><span style="font-family: MathJax_Size1;">√</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.202em, 1001em, 4.152em, -999.998em); top: -3.298em; left: 50%; margin-left: -0.497em;"><span class="mrow" id="MathJax-Span-646"><span class="mn" id="MathJax-Span-647" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-648" style="font-family: MathJax_Math-italic;">a</span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(0.853em, 1009.1em, 1.203em, -999.998em); top: -1.248em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 9.103em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.052em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.934em; border-left: 0px solid; width: 0px; height: 3.066em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo>=</mo><mfrac><mrow><mo>−</mo><mn>2</mn><mi>h</mi><mo>±</mo><msqrt><mo stretchy="false">(</mo><mn>2</mn><mi>h</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>−</mo><mn>4</mn><mi>a</mi><mi>c</mi></msqrt></mrow><mrow><mn>2</mn><mi>a</mi></mrow></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-59"> = \frac{-2h \pm \sqrt{(2h)^2 - 4ac}}{2a} </script>

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-60-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;mo&gt;&amp;#x00B1;&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;msqrt&gt;&lt;msup&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;/msqrt&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-649" style="width: 11.203em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.953em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.603em, 1008.95em, 3.152em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-650"><span class="mo" id="MathJax-Span-651" style="font-family: MathJax_Main;">=</span><span class="mfrac" id="MathJax-Span-652" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 7.653em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.002em, 1007.5em, 4.303em, -999.998em); top: -4.697em; left: 50%; margin-left: -3.748em;"><span class="mrow" id="MathJax-Span-653"><span class="mo" id="MathJax-Span-654" style="font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-655" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-656" style="font-family: MathJax_Math-italic;">h</span><span class="mo" id="MathJax-Span-657" style="font-family: MathJax_Main; padding-left: 0.202em;">±</span><span class="mn" id="MathJax-Span-658" style="font-family: MathJax_Main; padding-left: 0.202em;">2</span><span class="msqrt" id="MathJax-Span-659"><span style="display: inline-block; position: relative; width: 4.002em; height: 0px;"><span style="position: absolute; clip: rect(3.103em, 1003.15em, 4.252em, -999.998em); top: -3.998em; left: 0.853em;"><span class="mrow" id="MathJax-Span-660"><span class="msubsup" id="MathJax-Span-661"><span style="display: inline-block; position: relative; width: 1.002em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.55em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-662" style="font-family: MathJax_Math-italic;">h</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.298em; left: 0.603em;"><span class="mn" id="MathJax-Span-663" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-664" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="mi" id="MathJax-Span-665" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">a</span><span class="mi" id="MathJax-Span-666" style="font-family: MathJax_Math-italic;">c</span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.603em, 1003.1em, 3.902em, -999.998em); top: -4.548em; left: 0.853em;"><span style="display: inline-block; position: relative; width: 3.103em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.998em; left: -0.098em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.998em; left: 2.402em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 0.403em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 0.953em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 1.453em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 1.952em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.052em, 1000.85em, 4.353em, -999.998em); top: -4.048em; left: 0em;"><span style="font-family: MathJax_Main;">√</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.202em, 1001em, 4.152em, -999.998em); top: -3.298em; left: 50%; margin-left: -0.497em;"><span class="mrow" id="MathJax-Span-667"><span class="mn" id="MathJax-Span-668" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-669" style="font-family: MathJax_Math-italic;">a</span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(0.853em, 1007.65em, 1.203em, -999.998em); top: -1.248em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 7.653em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.052em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.934em; border-left: 0px solid; width: 0px; height: 2.878em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo>=</mo><mfrac><mrow><mo>−</mo><mn>2</mn><mi>h</mi><mo>±</mo><mn>2</mn><msqrt><msup><mi>h</mi><mn>2</mn></msup><mo>−</mo><mi>a</mi><mi>c</mi></msqrt></mrow><mrow><mn>2</mn><mi>a</mi></mrow></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-60"> = \frac{-2h \pm 2\sqrt{h^2 - ac}}{2a} </script>

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-61-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;mo&gt;&amp;#x00B1;&lt;/mo&gt;&lt;msqrt&gt;&lt;msup&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;/msqrt&gt;&lt;/mrow&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-670" style="width: 9.953em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.953em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.603em, 1007.95em, 3.152em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-671"><span class="mo" id="MathJax-Span-672" style="font-family: MathJax_Main;">=</span><span class="mfrac" id="MathJax-Span-673" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 6.653em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.002em, 1006.5em, 4.303em, -999.998em); top: -4.697em; left: 50%; margin-left: -3.248em;"><span class="mrow" id="MathJax-Span-674"><span class="mo" id="MathJax-Span-675" style="font-family: MathJax_Main;">−</span><span class="mi" id="MathJax-Span-676" style="font-family: MathJax_Math-italic;">h</span><span class="mo" id="MathJax-Span-677" style="font-family: MathJax_Main; padding-left: 0.202em;">±</span><span class="msqrt" id="MathJax-Span-678" style="padding-left: 0.202em;"><span style="display: inline-block; position: relative; width: 4.002em; height: 0px;"><span style="position: absolute; clip: rect(3.103em, 1003.15em, 4.252em, -999.998em); top: -3.998em; left: 0.853em;"><span class="mrow" id="MathJax-Span-679"><span class="msubsup" id="MathJax-Span-680"><span style="display: inline-block; position: relative; width: 1.002em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.55em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-681" style="font-family: MathJax_Math-italic;">h</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.298em; left: 0.603em;"><span class="mn" id="MathJax-Span-682" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-683" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="mi" id="MathJax-Span-684" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">a</span><span class="mi" id="MathJax-Span-685" style="font-family: MathJax_Math-italic;">c</span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.603em, 1003.1em, 3.902em, -999.998em); top: -4.548em; left: 0.853em;"><span style="display: inline-block; position: relative; width: 3.103em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.998em; left: -0.098em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.998em; left: 2.402em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 0.403em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 0.953em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 1.453em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 1.952em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.052em, 1000.85em, 4.353em, -999.998em); top: -4.048em; left: 0em;"><span style="font-family: MathJax_Main;">√</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.152em, -999.998em); top: -3.298em; left: 50%; margin-left: -0.247em;"><span class="mi" id="MathJax-Span-686" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(0.853em, 1006.65em, 1.203em, -999.998em); top: -1.248em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 6.653em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.052em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.934em; border-left: 0px solid; width: 0px; height: 2.878em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo>=</mo><mfrac><mrow><mo>−</mo><mi>h</mi><mo>±</mo><msqrt><msup><mi>h</mi><mn>2</mn></msup><mo>−</mo><mi>a</mi><mi>c</mi></msqrt></mrow><mi>a</mi></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-61"> = \frac{-h \pm \sqrt{h^2 - ac}}{a} </script>

</p><p>

Using these observations, we can now simplify the sphere-intersection code to this:

</p><pre class="listing tilde"><code><span class="line"><span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">hit_sphere</span><span class="hljs-params">(<span class="hljs-keyword">const</span> point3&amp; center, <span class="hljs-keyword">double</span> radius, <span class="hljs-keyword">const</span> ray&amp; r)</span> </span>{</span>
<span class="line">    vec3 oc = r.origin() - center;</span><div class=" highlight"><span class="line">    <span class="hljs-keyword">auto</span> a = r.direction().length_squared();</span>
<span class="line">    <span class="hljs-keyword">auto</span> half_b = dot(oc, r.direction());</span>
<span class="line">    <span class="hljs-keyword">auto</span> c = oc.length_squared() - radius*radius;</span>
<span class="line">    <span class="hljs-keyword">auto</span> discriminant = half_b*half_b - a*c;</span></div><span class="line"></span>
<span class="line">    <span class="hljs-keyword">if</span> (discriminant &lt; <span class="hljs-number">0</span>) {</span>
<span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-number">-1.0</span>;</span>
<span class="line">    } <span class="hljs-keyword">else</span> {</span><div class=" highlight"><span class="line">        <span class="hljs-keyword">return</span> (-half_b - <span class="hljs-built_in">sqrt</span>(discriminant) ) / a;</span></div><span class="line">    }</span>
<span class="line">}</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_ray-sphere-after">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;13:</b> <kbd>[main.cc]</kbd> Ray-sphere intersection code (after)</div></center>

<a class="target" name="anabstractionforhittableobjects">&nbsp;</a><a class="target" name="surfacenormalsandmultipleobjects/anabstractionforhittableobjects">&nbsp;</a><a class="target" name="toc6.3">&nbsp;</a><h2>An Abstraction for Hittable Objects</h2>
<p>

Now, how about several spheres? While it is tempting to have an array of spheres, a very clean
solution is the make an “abstract class” for anything a ray might hit, and make both a sphere and a
list of spheres just something you can hit. What that class should be called is something of a
quandary — calling it an “object” would be good if not for “object oriented” programming. “Surface”
is often used, with the weakness being maybe we will want volumes. “hittable” emphasizes the member
function that unites them. I don’t love any of these, but I will go with “hittable”.

</p><p>

</p><div class="together">
This <code>hittable</code> abstract class will have a hit function that takes in a ray. Most ray tracers have
found it convenient to add a valid interval for hits <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-62-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-687" style="width: 2.202em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.752em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.202em, 1001.75em, 1.302em, -999.998em); top: -0.997em; left: 0em;"><span class="mrow" id="MathJax-Span-688"><span class="msubsup" id="MathJax-Span-689"><span style="display: inline-block; position: relative; width: 1.752em; height: 0px;"><span style="position: absolute; clip: rect(3.202em, 1000.35em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-690" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.352em;"><span class="texatom" id="MathJax-Span-691"><span class="mrow" id="MathJax-Span-692"><span class="mi" id="MathJax-Span-693" style="font-size: 70.7%; font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-694" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-695" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.002em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-62">t_{min}</script> to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-63-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-696" style="width: 2.353em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.852em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.202em, 1001.85em, 1.302em, -999.998em); top: -0.997em; left: 0em;"><span class="mrow" id="MathJax-Span-697"><span class="msubsup" id="MathJax-Span-698"><span style="display: inline-block; position: relative; width: 1.852em; height: 0px;"><span style="position: absolute; clip: rect(3.202em, 1000.35em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-699" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.352em;"><span class="texatom" id="MathJax-Span-700"><span class="mrow" id="MathJax-Span-701"><span class="mi" id="MathJax-Span-702" style="font-size: 70.7%; font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-703" style="font-size: 70.7%; font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-704" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.002em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-63">t_{max}</script>, so the hit only
“counts” if <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-64-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;&amp;lt;&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;&amp;lt;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-705" style="width: 8.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.753em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.502em, 1006.75em, 2.603em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-706"><span class="msubsup" id="MathJax-Span-707"><span style="display: inline-block; position: relative; width: 1.752em; height: 0px;"><span style="position: absolute; clip: rect(3.202em, 1000.35em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-708" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.352em;"><span class="texatom" id="MathJax-Span-709"><span class="mrow" id="MathJax-Span-710"><span class="mi" id="MathJax-Span-711" style="font-size: 70.7%; font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-712" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-713" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-714" style="font-family: MathJax_Main; padding-left: 0.302em;">&lt;</span><span class="mi" id="MathJax-Span-715" style="font-family: MathJax_Math-italic; padding-left: 0.302em;">t</span><span class="mo" id="MathJax-Span-716" style="font-family: MathJax_Main; padding-left: 0.302em;">&lt;</span><span class="msubsup" id="MathJax-Span-717" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 1.852em; height: 0px;"><span style="position: absolute; clip: rect(3.202em, 1000.35em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-718" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.352em;"><span class="texatom" id="MathJax-Span-719"><span class="mrow" id="MathJax-Span-720"><span class="mi" id="MathJax-Span-721" style="font-size: 70.7%; font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-722" style="font-size: 70.7%; font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-723" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub><mo>&lt;</mo><mi>t</mi><mo>&lt;</mo><msub><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-64">t_{min} < t < t_{max}</script>. For the initial rays this is positive <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-65-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-724" style="width: 0.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.352em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.103em, 1000.3em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-725"><span class="mi" id="MathJax-Span-726" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-65">t</script>, but as we will see,
it can help some details in the code to have an interval <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-66-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-727" style="width: 2.202em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.752em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.202em, 1001.75em, 1.302em, -999.998em); top: -0.997em; left: 0em;"><span class="mrow" id="MathJax-Span-728"><span class="msubsup" id="MathJax-Span-729"><span style="display: inline-block; position: relative; width: 1.752em; height: 0px;"><span style="position: absolute; clip: rect(3.202em, 1000.35em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-730" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.352em;"><span class="texatom" id="MathJax-Span-731"><span class="mrow" id="MathJax-Span-732"><span class="mi" id="MathJax-Span-733" style="font-size: 70.7%; font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-734" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-735" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.002em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-66">t_{min}</script> to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-67-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-736" style="width: 2.353em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.852em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.202em, 1001.85em, 1.302em, -999.998em); top: -0.997em; left: 0em;"><span class="mrow" id="MathJax-Span-737"><span class="msubsup" id="MathJax-Span-738"><span style="display: inline-block; position: relative; width: 1.852em; height: 0px;"><span style="position: absolute; clip: rect(3.202em, 1000.35em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-739" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 0.352em;"><span class="texatom" id="MathJax-Span-740"><span class="mrow" id="MathJax-Span-741"><span class="mi" id="MathJax-Span-742" style="font-size: 70.7%; font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-743" style="font-size: 70.7%; font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-744" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.002em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-67">t_{max}</script>. One design question
is whether to do things like compute the normal if we hit something. We might end up hitting
something closer as we do our search, and we will only need the normal of the closest thing. I will
go with the simple solution and compute a bundle of stuff I will store in some structure. Here’s
the abstract class:

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> HITTABLE_H</span></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> HITTABLE_H</span></span>
<span class="line"></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"ray.h"</span></span></span>
<span class="line"></span>
<span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">hit_record</span> {</span></span>
<span class="line">    point3 p;</span>
<span class="line">    vec3 normal;</span>
<span class="line">    <span class="hljs-keyword">double</span> t;</span>
<span class="line">};</span>
<span class="line"></span>
<span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">hittable</span> {</span></span>
<span class="line">    <span class="hljs-keyword">public</span>:</span>
<span class="line">        <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">hit</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ray&amp; r, <span class="hljs-keyword">double</span> t_min, <span class="hljs-keyword">double</span> t_max, hit_record&amp; rec)</span> <span class="hljs-keyword">const</span> </span>= <span class="hljs-number">0</span>;</span>
<span class="line">};</span>
<span class="line"></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span></span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_hittable-initial">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;14:</b> <kbd>[hittable.h]</kbd> The hittable class</div></center>
<p>

</p></div>

<p></p><p>

</p><div class="together">
And here’s the sphere:

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> SPHERE_H</span></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SPHERE_H</span></span>
<span class="line"></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"hittable.h"</span></span></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"vec3.h"</span></span></span>
<span class="line"></span>
<span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">sphere</span> :</span> <span class="hljs-keyword">public</span> hittable {</span>
<span class="line">    <span class="hljs-keyword">public</span>:</span>
<span class="line">        sphere() {}</span>
<span class="line">        sphere(point3 cen, <span class="hljs-keyword">double</span> r) : center(cen), radius(r) {};</span>
<span class="line"></span>
<span class="line">        <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">hit</span><span class="hljs-params">(</span>
<span class="line">            <span class="hljs-keyword">const</span> ray&amp; r, <span class="hljs-keyword">double</span> t_min, <span class="hljs-keyword">double</span> t_max, hit_record&amp; rec)</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span></span>;</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">public</span>:</span>
<span class="line">        point3 center;</span>
<span class="line">        <span class="hljs-keyword">double</span> radius;</span>
<span class="line">};</span>
<span class="line"></span>
<span class="line"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">sphere::hit</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ray&amp; r, <span class="hljs-keyword">double</span> t_min, <span class="hljs-keyword">double</span> t_max, hit_record&amp; rec)</span> <span class="hljs-keyword">const</span> </span>{</span>
<span class="line">    vec3 oc = r.origin() - center;</span>
<span class="line">    <span class="hljs-keyword">auto</span> a = r.direction().length_squared();</span>
<span class="line">    <span class="hljs-keyword">auto</span> half_b = dot(oc, r.direction());</span>
<span class="line">    <span class="hljs-keyword">auto</span> c = oc.length_squared() - radius*radius;</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">auto</span> discriminant = half_b*half_b - a*c;</span>
<span class="line">    <span class="hljs-keyword">if</span> (discriminant &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</span>
<span class="line">    <span class="hljs-keyword">auto</span> sqrtd = <span class="hljs-built_in">sqrt</span>(discriminant);</span>
<span class="line"></span>
<span class="line">    <span class="hljs-comment">// Find the nearest root that lies in the acceptable range.</span></span>
<span class="line">    <span class="hljs-keyword">auto</span> root = (-half_b - sqrtd) / a;</span>
<span class="line">    <span class="hljs-keyword">if</span> (root &lt; t_min || t_max &lt; root) {</span>
<span class="line">        root = (-half_b + sqrtd) / a;</span>
<span class="line">        <span class="hljs-keyword">if</span> (root &lt; t_min || t_max &lt; root)</span>
<span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    rec.t = root;</span>
<span class="line">    rec.p = r.at(rec.t);</span>
<span class="line">    rec.normal = (rec.p - center) / radius;</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span></span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_sphere-initial">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;15:</b> <kbd>[sphere.h]</kbd> The sphere class</div></center>
<p>


</p></div>

<p></p>
<a class="target" name="frontfacesversusbackfaces">&nbsp;</a><a class="target" name="surfacenormalsandmultipleobjects/frontfacesversusbackfaces">&nbsp;</a><a class="target" name="toc6.4">&nbsp;</a><h2>Front Faces Versus Back Faces</h2>
<p>

</p><div class="together">
The second design decision for normals is whether they should always point out. At present, the
normal found will always be in the direction of the center to the intersection point (the normal
points out). If the ray intersects the sphere from the outside, the normal points against the ray.
If the ray intersects the sphere from the inside, the normal (which always points out) points with
the ray. Alternatively, we can have the normal always point against the ray. If the ray is outside
the sphere, the normal will point outward, but if the ray is inside the sphere, the normal will
point inward.

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/fig-1.06-normal-sides.jpg" target="_blank"><img class="markdeep" src="./Ray Tracing in One Weekend_files/fig-1.06-normal-sides.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_normal-sides">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;6:</b> Possible directions for sphere surface-normal geometry
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p><p>

We need to choose one of these possibilities because we will eventually want to determine which
side of the surface that the ray is coming from. This is important for objects that are rendered
differently on each side, like the text on a two-sided sheet of paper, or for objects that have an
inside and an outside, like glass balls.

</p><p>

If we decide to have the normals always point out, then we will need to determine which side the
ray is on when we color it. We can figure this out by comparing the ray with the normal. If the ray
and the normal face in the same direction, the ray is inside the object, if the ray and the normal
face in the opposite direction, then the ray is outside the object. This can be determined by
taking the dot product of the two vectors, where if their dot is positive, the ray is inside the
sphere.

</p><pre class="listing tilde"><code><span class="line"><span class="hljs-keyword">if</span> (dot(ray_direction, outward_normal) &gt; <span class="hljs-number">0.0</span>) {</span>
<span class="line">    <span class="hljs-comment">// ray is inside the sphere</span></span>
<span class="line">    ...</span>
<span class="line">} <span class="hljs-keyword">else</span> {</span>
<span class="line">    <span class="hljs-comment">// ray is outside the sphere</span></span>
<span class="line">    ...</span>
<span class="line">}</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_ray-normal-comparison">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;16:</b> Comparing the ray and the normal</div></center>
<p>



If we decide to have the normals always point against the ray, we won't be able to use the dot
product to determine which side of the surface the ray is on. Instead, we would need to store that
information:

</p><pre class="listing tilde"><code><span class="line"><span class="hljs-keyword">bool</span> front_face;</span>
<span class="line"><span class="hljs-keyword">if</span> (dot(ray_direction, outward_normal) &gt; <span class="hljs-number">0.0</span>) {</span>
<span class="line">    <span class="hljs-comment">// ray is inside the sphere</span></span>
<span class="line">    normal = -outward_normal;</span>
<span class="line">    front_face = <span class="hljs-literal">false</span>;</span>
<span class="line">} <span class="hljs-keyword">else</span> {</span>
<span class="line">    <span class="hljs-comment">// ray is outside the sphere</span></span>
<span class="line">    normal = outward_normal;</span>
<span class="line">    front_face = <span class="hljs-literal">true</span>;</span>
<span class="line">}</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_normals-point-against">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;17:</b> Remembering the side of the surface</div></center>
<p>


We can set things up so that normals always point “outward” from the surface, or always point
against the incident ray. This decision is determined by whether you want to determine the side of
the surface at the time of geometry intersection or at the time of coloring. In this book we have
more material types than we have geometry types, so we'll go for less work and put the determination
at geometry time. This is simply a matter of preference, and you'll see both implementations in the
literature.

</p><p>

We add the <code>front_face</code> bool to the <code>hit_record</code> struct. We'll also add a function to solve this
calculation for us.

</p><pre class="listing tilde"><code><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">hit_record</span> {</span></span>
<span class="line">    point3 p;</span>
<span class="line">    vec3 normal;</span>
<span class="line">    <span class="hljs-keyword">double</span> t;</span><div class=" highlight"><span class="line">    <span class="hljs-keyword">bool</span> front_face;</span>
<span class="line"></span>
<span class="line">    <span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">set_face_normal</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ray&amp; r, <span class="hljs-keyword">const</span> vec3&amp; outward_normal)</span> </span>{</span>
<span class="line">        front_face = dot(r.direction(), outward_normal) &lt; <span class="hljs-number">0</span>;</span>
<span class="line">        normal = front_face ? outward_normal :-outward_normal;</span>
<span class="line">    }</span></div><span class="line">};</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_front-face-tracking">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;18:</b> <kbd>[hittable.h]</kbd>
        Adding front-face tracking to hit_record</div></center>
<p>


</p><div class="together">
And then we add the surface side determination to the class:

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">sphere::hit</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ray&amp; r, <span class="hljs-keyword">double</span> t_min, <span class="hljs-keyword">double</span> t_max, hit_record&amp; rec)</span> <span class="hljs-keyword">const</span> </span>{</span>
<span class="line">    ...</span>
<span class="line"></span>
<span class="line">    rec.t = root;</span>
<span class="line">    rec.p = r.at(rec.t);</span><div class=" highlight"><span class="line">    vec3 outward_normal = (rec.p - center) / radius;</span>
<span class="line">    rec.set_face_normal(r, outward_normal);</span></div><span class="line"></span>
<span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</span>
<span class="line">}</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_sphere-final">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;19:</b> <kbd>[sphere.h]</kbd> The sphere class with normal determination</div></center>
<p>


</p></div>

<p></p>
<a class="target" name="alistofhittableobjects">&nbsp;</a><a class="target" name="surfacenormalsandmultipleobjects/alistofhittableobjects">&nbsp;</a><a class="target" name="toc6.5">&nbsp;</a><h2>A List of Hittable Objects</h2>
<p>

</p><div class="together">
We have a generic object called a <code>hittable</code> that the ray can intersect with. We now add a class
that stores a list of <code>hittable</code>s:

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> HITTABLE_LIST_H</span></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> HITTABLE_LIST_H</span></span>
<span class="line"></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"hittable.h"</span></span></span>
<span class="line"></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;memory&gt;</span></span></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;vector&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="hljs-keyword">using</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>;</span>
<span class="line"><span class="hljs-keyword">using</span> <span class="hljs-built_in">std</span>::make_shared;</span>
<span class="line"></span>
<span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">hittable_list</span> :</span> <span class="hljs-keyword">public</span> hittable {</span>
<span class="line">    <span class="hljs-keyword">public</span>:</span>
<span class="line">        hittable_list() {}</span>
<span class="line">        hittable_list(<span class="hljs-built_in">shared_ptr</span>&lt;hittable&gt; object) { add(object); }</span>
<span class="line"></span>
<span class="line">        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">clear</span><span class="hljs-params">()</span> </span>{ objects.clear(); }</span>
<span class="line">        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-built_in">shared_ptr</span>&lt;hittable&gt; object)</span> </span>{ objects.push_back(object); }</span>
<span class="line"></span>
<span class="line">        <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">hit</span><span class="hljs-params">(</span>
<span class="line">            <span class="hljs-keyword">const</span> ray&amp; r, <span class="hljs-keyword">double</span> t_min, <span class="hljs-keyword">double</span> t_max, hit_record&amp; rec)</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span></span>;</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">public</span>:</span>
<span class="line">        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">shared_ptr</span>&lt;hittable&gt;&gt; objects;</span>
<span class="line">};</span>
<span class="line"></span>
<span class="line"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">hittable_list::hit</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ray&amp; r, <span class="hljs-keyword">double</span> t_min, <span class="hljs-keyword">double</span> t_max, hit_record&amp; rec)</span> <span class="hljs-keyword">const</span> </span>{</span>
<span class="line">    hit_record temp_rec;</span>
<span class="line">    <span class="hljs-keyword">bool</span> hit_anything = <span class="hljs-literal">false</span>;</span>
<span class="line">    <span class="hljs-keyword">auto</span> closest_so_far = t_max;</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span>&amp; object : objects) {</span>
<span class="line">        <span class="hljs-keyword">if</span> (object-&gt;hit(r, t_min, closest_so_far, temp_rec)) {</span>
<span class="line">            hit_anything = <span class="hljs-literal">true</span>;</span>
<span class="line">            closest_so_far = temp_rec.t;</span>
<span class="line">            rec = temp_rec;</span>
<span class="line">        }</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">return</span> hit_anything;</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span></span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_hittable-list-initial">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;20:</b> <kbd>[hittable_list.h]</kbd> The hittable_list class</div></center>
<p>

</p></div>

<p></p>
<a class="target" name="somenewc++features">&nbsp;</a><a class="target" name="surfacenormalsandmultipleobjects/somenewc++features">&nbsp;</a><a class="target" name="toc6.6">&nbsp;</a><h2>Some New C++ Features</h2>
<p>

The <code>hittable_list</code> class code uses two C++ features that may trip you up if you're not normally a
C++ programmer: <code>vector</code> and <code>shared_ptr</code>.

</p><p>

<code>shared_ptr&lt;type&gt;</code> is a pointer to some allocated type, with reference-counting semantics.
Every time you assign its value to another shared pointer (usually with a simple assignment), the
reference count is incremented. As shared pointers go out of scope (like at the end of a block or
function), the reference count is decremented. Once the count goes to zero, the object is deleted.

</p><p>

</p><div class="together">
Typically, a shared pointer is first initialized with a newly-allocated object, something like this:

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-built_in">shared_ptr</span>&lt;<span class="hljs-keyword">double</span>&gt; double_ptr = make_shared&lt;<span class="hljs-keyword">double</span>&gt;(<span class="hljs-number">0.37</span>);</span>
<span class="line"><span class="hljs-built_in">shared_ptr</span>&lt;vec3&gt;   vec3_ptr   = make_shared&lt;vec3&gt;(<span class="hljs-number">1.414214</span>, <span class="hljs-number">2.718281</span>, <span class="hljs-number">1.618034</span>);</span>
<span class="line"><span class="hljs-built_in">shared_ptr</span>&lt;sphere&gt; sphere_ptr = make_shared&lt;sphere&gt;(point3(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-number">1.0</span>);</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_shared-ptr">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;21:</b> An example allocation using shared_ptr</div></center>
<p>


<code>make_shared&lt;thing&gt;(thing_constructor_params ...)</code> allocates a new instance of type <code>thing</code>, using
the constructor parameters. It returns a <code>shared_ptr&lt;thing&gt;</code>.

</p><p>

Since the type can be automatically deduced by the return type of <code>make_shared&lt;type&gt;(...)</code>, the
above lines can be more simply expressed using C++'s <code>auto</code> type specifier:

</p><pre class="listing tilde"><code><span class="line"><span class="hljs-keyword">auto</span> double_ptr = make_shared&lt;<span class="hljs-keyword">double</span>&gt;(<span class="hljs-number">0.37</span>);</span>
<span class="line"><span class="hljs-keyword">auto</span> vec3_ptr   = make_shared&lt;vec3&gt;(<span class="hljs-number">1.414214</span>, <span class="hljs-number">2.718281</span>, <span class="hljs-number">1.618034</span>);</span>
<span class="line"><span class="hljs-keyword">auto</span> sphere_ptr = make_shared&lt;sphere&gt;(point3(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-number">1.0</span>);</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_shared-ptr-auto">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;22:</b> An example allocation using shared_ptr with auto type</div></center>
<p>


</p></div>

<p></p><p>

We'll use shared pointers in our code, because it allows multiple geometries to share a common
instance (for example, a bunch of spheres that all use the same texture map material), and because
it makes memory management automatic and easier to reason about.

</p><p>

<code>std::shared_ptr</code> is included with the <code>&lt;memory&gt;</code> header.

</p><p>

The second C++ feature you may be unfamiliar with is <code>std::vector</code>. This is a generic array-like
collection of an arbitrary type. Above, we use a collection of pointers to <code>hittable</code>. <code>std::vector</code>
automatically grows as more values are added: <code>objects.push_back(object)</code> adds a value to the end of
the <code>std::vector</code> member variable <code>objects</code>.

</p><p>

<code>std::vector</code> is included with the <code>&lt;vector&gt;</code> header.

</p><p>

Finally, the <code>using</code> statements in <a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html#listing_hittable-list-initial">listing&nbsp;20</a> tell the compiler that we'll be
getting <code>shared_ptr</code> and <code>make_shared</code> from the <code>std</code> library, so we don't need to prefex these with
<code>std::</code> every time we reference them.

</p>
<a class="target" name="commonconstantsandutilityfunctions">&nbsp;</a><a class="target" name="surfacenormalsandmultipleobjects/commonconstantsandutilityfunctions">&nbsp;</a><a class="target" name="toc6.7">&nbsp;</a><h2>Common Constants and Utility Functions</h2>
<p>

</p><div class="together">
We need some math constants that we conveniently define in their own header file. For now we only
need infinity, but we will also throw our own definition of pi in there, which we will need later.
There is no standard portable definition of pi, so we just define our own constant for it. We'll
throw common useful constants and future utility functions in <code>rtweekend.h</code>, our general main header
file.

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> RTWEEKEND_H</span></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RTWEEKEND_H</span></span>
<span class="line"></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cmath&gt;</span></span></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;limits&gt;</span></span></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;memory&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="hljs-comment">// Usings</span></span>
<span class="line"></span>
<span class="line"><span class="hljs-keyword">using</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>;</span>
<span class="line"><span class="hljs-keyword">using</span> <span class="hljs-built_in">std</span>::make_shared;</span>
<span class="line"><span class="hljs-keyword">using</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">sqrt</span>;</span>
<span class="line"></span>
<span class="line"><span class="hljs-comment">// Constants</span></span>
<span class="line"></span>
<span class="line"><span class="hljs-keyword">const</span> <span class="hljs-keyword">double</span> infinity = <span class="hljs-built_in">std</span>::numeric_limits&lt;<span class="hljs-keyword">double</span>&gt;::infinity();</span>
<span class="line"><span class="hljs-keyword">const</span> <span class="hljs-keyword">double</span> pi = <span class="hljs-number">3.1415926535897932385</span>;</span>
<span class="line"></span>
<span class="line"><span class="hljs-comment">// Utility Functions</span></span>
<span class="line"></span>
<span class="line"><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">double</span> <span class="hljs-title">degrees_to_radians</span><span class="hljs-params">(<span class="hljs-keyword">double</span> degrees)</span> </span>{</span>
<span class="line">    <span class="hljs-keyword">return</span> degrees * pi / <span class="hljs-number">180.0</span>;</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"><span class="hljs-comment">// Common Headers</span></span>
<span class="line"></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"ray.h"</span></span></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"vec3.h"</span></span></span>
<span class="line"></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span></span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_rtweekend-initial">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;23:</b> <kbd>[rtweekend.h]</kbd> The rtweekend.h common header</div></center>
<p>

</p></div>

<p></p><p>

</p><div class="together">
And the new main:

<p></p><pre class="listing tilde"><code><div class=" highlight"><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"rtweekend.h"</span></span></span>
<span class="line"></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"color.h"</span></span></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"hittable_list.h"</span></span></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"sphere.h"</span></span></span></div><span class="line"></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span></span>
<span class="line"></span><div class=" highlight"><span class="line"><span class="hljs-function">color <span class="hljs-title">ray_color</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ray&amp; r, <span class="hljs-keyword">const</span> hittable&amp; world)</span> </span>{</span>
<span class="line">    hit_record rec;</span>
<span class="line">    <span class="hljs-keyword">if</span> (world.hit(r, <span class="hljs-number">0</span>, infinity, rec)) {</span>
<span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-number">0.5</span> * (rec.normal + color(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>));</span>
<span class="line">    }</span>
<span class="line"></span></div><span class="line">    vec3 unit_direction = unit_vector(r.direction());</span><div class=" highlight"><span class="line">    <span class="hljs-keyword">auto</span> t = <span class="hljs-number">0.5</span>*(unit_direction.y() + <span class="hljs-number">1.0</span>);</span></div><span class="line">    <span class="hljs-keyword">return</span> (<span class="hljs-number">1.0</span>-t)*color(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>) + t*color(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.7</span>, <span class="hljs-number">1.0</span>);</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{</span>
<span class="line"></span>
<span class="line">    <span class="hljs-comment">// Image</span></span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> aspect_ratio = <span class="hljs-number">16.0</span> / <span class="hljs-number">9.0</span>;</span>
<span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> image_width = <span class="hljs-number">400</span>;</span>
<span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> image_height = <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">int</span>&gt;(image_width / aspect_ratio);</span>
<span class="line"></span>
<span class="line">    <span class="hljs-comment">// World</span></span>
<span class="line"></span><div class=" highlight"><span class="line">    hittable_list world;</span>
<span class="line">    world.add(make_shared&lt;sphere&gt;(point3(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">-1</span>), <span class="hljs-number">0.5</span>));</span>
<span class="line">    world.add(make_shared&lt;sphere&gt;(point3(<span class="hljs-number">0</span>,<span class="hljs-number">-100.5</span>,<span class="hljs-number">-1</span>), <span class="hljs-number">100</span>));</span></div><span class="line"></span>
<span class="line">    <span class="hljs-comment">// Camera</span></span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">auto</span> viewport_height = <span class="hljs-number">2.0</span>;</span>
<span class="line">    <span class="hljs-keyword">auto</span> viewport_width = aspect_ratio * viewport_height;</span>
<span class="line">    <span class="hljs-keyword">auto</span> focal_length = <span class="hljs-number">1.0</span>;</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">auto</span> origin = point3(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);</span>
<span class="line">    <span class="hljs-keyword">auto</span> horizontal = vec3(viewport_width, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);</span>
<span class="line">    <span class="hljs-keyword">auto</span> vertical = vec3(<span class="hljs-number">0</span>, viewport_height, <span class="hljs-number">0</span>);</span>
<span class="line">    <span class="hljs-keyword">auto</span> lower_left_corner = origin - horizontal/<span class="hljs-number">2</span> - vertical/<span class="hljs-number">2</span> - vec3(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, focal_length);</span>
<span class="line"></span>
<span class="line">    <span class="hljs-comment">// Render</span></span>
<span class="line"></span>
<span class="line">    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"P3\n"</span> &lt;&lt; image_width &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; image_height &lt;&lt; <span class="hljs-string">"\n255\n"</span>;</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = image_height<span class="hljs-number">-1</span>; j &gt;= <span class="hljs-number">0</span>; --j) {</span>
<span class="line">        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"\rScanlines remaining: "</span> &lt;&lt; j &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; <span class="hljs-built_in">std</span>::flush;</span>
<span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; image_width; ++i) {</span>
<span class="line">            <span class="hljs-keyword">auto</span> u = <span class="hljs-keyword">double</span>(i) / (image_width<span class="hljs-number">-1</span>);</span>
<span class="line">            <span class="hljs-keyword">auto</span> v = <span class="hljs-keyword">double</span>(j) / (image_height<span class="hljs-number">-1</span>);</span>
<span class="line">            <span class="hljs-function">ray <span class="hljs-title">r</span><span class="hljs-params">(origin, lower_left_corner + u*horizontal + v*vertical)</span></span>;</span><div class=" highlight"><span class="line">            color pixel_color = ray_color(r, world);</span></div><span class="line">            write_color(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span>, pixel_color);</span>
<span class="line">        }</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"\nDone.\n"</span>;</span>
<span class="line">}</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_main-with-rtweekend-h">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;24:</b> <kbd>[main.cc]</kbd> The new main with hittables</div></center>
<p>

</p></div>

<p></p><p>

</p><div class="together">
This yields a picture that is really just a visualization of where the spheres are along with their
surface normal. This is often a great way to look at your model for flaws and characteristics.

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/img-1.05-normals-sphere-ground.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing in One Weekend_files/img-1.05-normals-sphere-ground.png"></a><center><span class="imagecaption">Image 5: Resulting render of normals-colored sphere with ground
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="antialiasing">&nbsp;</a><a class="target" name="antialiasing">&nbsp;</a><a class="target" name="toc7">&nbsp;</a><h1>Antialiasing</h1>
<p>


When a real camera takes a picture, there are usually no jaggies along edges because the edge pixels
are a blend of some foreground and some background. We can get the same effect by averaging a bunch
of samples inside each pixel. We will not bother with stratification. This is controversial, but is
usual for my programs. For some ray tracers it is critical, but the kind of general one we are
writing doesn’t benefit very much from it and it makes the code uglier. We abstract the camera class
a bit so we can make a cooler camera later.

</p>
<a class="target" name="somerandomnumberutilities">&nbsp;</a><a class="target" name="antialiasing/somerandomnumberutilities">&nbsp;</a><a class="target" name="toc7.1">&nbsp;</a><h2>Some Random Number Utilities</h2>
<p>

One thing we need is a random number generator that returns real random numbers. We need a function
that returns a canonical random number which by convention returns a random real in the range
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-68-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;&amp;#x2264;&lt;/mo&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mo&gt;&amp;lt;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-745" style="width: 5.252em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.202em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1004.15em, 2.452em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-746"><span class="mn" id="MathJax-Span-747" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-748" style="font-family: MathJax_Main; padding-left: 0.302em;">≤</span><span class="mi" id="MathJax-Span-749" style="font-family: MathJax_Math-italic; padding-left: 0.302em;">r</span><span class="mo" id="MathJax-Span-750" style="font-family: MathJax_Main; padding-left: 0.302em;">&lt;</span><span class="mn" id="MathJax-Span-751" style="font-family: MathJax_Main; padding-left: 0.302em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn><mo>≤</mo><mi>r</mi><mo>&lt;</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-68">0 ≤ r < 1</script>. The “less than” before the 1 is important as we will sometimes take advantage of that.

</p><p>

</p><div class="together">
A simple approach to this is to use the <code>rand()</code> function that can be found in <code>&lt;cstdlib&gt;</code>. This
function returns a random integer in the range 0 and <code>RAND_MAX</code>. Hence we can get a real random
number as desired with the following code snippet, added to <code>rtweekend.h</code>:

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstdlib&gt;</span></span></span>
<span class="line">...</span>
<span class="line"></span>
<span class="line"><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">double</span> <span class="hljs-title">random_double</span><span class="hljs-params">()</span> </span>{</span>
<span class="line">    <span class="hljs-comment">// Returns a random real in [0,1).</span></span>
<span class="line">    <span class="hljs-keyword">return</span> rand() / (RAND_MAX + <span class="hljs-number">1.0</span>);</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">double</span> <span class="hljs-title">random_double</span><span class="hljs-params">(<span class="hljs-keyword">double</span> min, <span class="hljs-keyword">double</span> max)</span> </span>{</span>
<span class="line">    <span class="hljs-comment">// Returns a random real in [min,max).</span></span>
<span class="line">    <span class="hljs-keyword">return</span> min + (max-min)*random_double();</span>
<span class="line">}</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_random-double">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;25:</b> <kbd>[rtweekend.h]</kbd> random_double() functions</div></center>
<p>

</p></div>

<p></p><p>

</p><div class="together">
C++ did not traditionally have a standard random number generator, but newer versions of C++ have
addressed this issue with the <code>&lt;random&gt;</code> header (if imperfectly according to some experts).
If you want to use this, you can obtain a random number with the conditions we need as follows:

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;random&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">double</span> <span class="hljs-title">random_double</span><span class="hljs-params">()</span> </span>{</span>
<span class="line">    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-built_in">std</span>::uniform_real_distribution&lt;<span class="hljs-keyword">double</span>&gt; <span class="hljs-title">distribution</span><span class="hljs-params">(<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>)</span></span>;</span>
<span class="line">    <span class="hljs-keyword">static</span> <span class="hljs-built_in">std</span>::mt19937 generator;</span>
<span class="line">    <span class="hljs-keyword">return</span> distribution(generator);</span>
<span class="line">}</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_random-double-alt">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;26:</b> <kbd>[rtweekend.h]</kbd> random_double(), alternate implemenation</div></center>
<p>

</p></div>

<p></p>
<a class="target" name="generatingpixelswithmultiplesamples">&nbsp;</a><a class="target" name="antialiasing/generatingpixelswithmultiplesamples">&nbsp;</a><a class="target" name="toc7.2">&nbsp;</a><h2>Generating Pixels with Multiple Samples</h2>
<p>

</p><div class="together">
For a given pixel we have several samples within that pixel and send rays through each of the
samples. The colors of these rays are then averaged:

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/fig-1.07-pixel-samples.jpg" target="_blank"><img class="markdeep" src="./Ray Tracing in One Weekend_files/fig-1.07-pixel-samples.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_pixel-samples">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;7:</b> Pixel samples</span></center></div></center>

<p></p><p>

</p></div>

<p></p><p>

</p><div class="together">
Now's a good time to create a <code>camera</code> class to manage our virtual camera and the related tasks of
scene scampling. The following class implements a simple camera using the axis-aligned camera from
before:

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> CAMERA_H</span></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CAMERA_H</span></span>
<span class="line"></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"rtweekend.h"</span></span></span>
<span class="line"></span>
<span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">camera</span> {</span></span>
<span class="line">    <span class="hljs-keyword">public</span>:</span>
<span class="line">        camera() {</span>
<span class="line">            <span class="hljs-keyword">auto</span> aspect_ratio = <span class="hljs-number">16.0</span> / <span class="hljs-number">9.0</span>;</span>
<span class="line">            <span class="hljs-keyword">auto</span> viewport_height = <span class="hljs-number">2.0</span>;</span>
<span class="line">            <span class="hljs-keyword">auto</span> viewport_width = aspect_ratio * viewport_height;</span>
<span class="line">            <span class="hljs-keyword">auto</span> focal_length = <span class="hljs-number">1.0</span>;</span>
<span class="line"></span>
<span class="line">            origin = point3(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);</span>
<span class="line">            horizontal = vec3(viewport_width, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>);</span>
<span class="line">            vertical = vec3(<span class="hljs-number">0.0</span>, viewport_height, <span class="hljs-number">0.0</span>);</span>
<span class="line">            lower_left_corner = origin - horizontal/<span class="hljs-number">2</span> - vertical/<span class="hljs-number">2</span> - vec3(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, focal_length);</span>
<span class="line">        }</span>
<span class="line"></span>
<span class="line">        <span class="hljs-function">ray <span class="hljs-title">get_ray</span><span class="hljs-params">(<span class="hljs-keyword">double</span> u, <span class="hljs-keyword">double</span> v)</span> <span class="hljs-keyword">const</span> </span>{</span>
<span class="line">            <span class="hljs-keyword">return</span> ray(origin, lower_left_corner + u*horizontal + v*vertical - origin);</span>
<span class="line">        }</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">private</span>:</span>
<span class="line">        point3 origin;</span>
<span class="line">        point3 lower_left_corner;</span>
<span class="line">        vec3 horizontal;</span>
<span class="line">        vec3 vertical;</span>
<span class="line">};</span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span></span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_camera-initial">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;27:</b> <kbd>[camera.h]</kbd> The camera class</div></center>
<p>

</p></div>

<p></p><p>

To handle the multi-sampled color computation, we'll update the <code>write_color()</code> function. Rather
than adding in a fractional contribution each time we accumulate more light to the color, just add
the full color each iteration, and then perform a single divide at the end (by the number of
samples) when writing out the color. In addition, we'll add a handy utility function to the
<code>rtweekend.h</code> utility header: <code>clamp(x,min,max)</code>, which clamps the value <code>x</code> to the range [min,max]:

</p><pre class="listing tilde"><code><span class="line"><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">double</span> <span class="hljs-title">clamp</span><span class="hljs-params">(<span class="hljs-keyword">double</span> x, <span class="hljs-keyword">double</span> min, <span class="hljs-keyword">double</span> max)</span> </span>{</span>
<span class="line">    <span class="hljs-keyword">if</span> (x &lt; min) <span class="hljs-keyword">return</span> min;</span>
<span class="line">    <span class="hljs-keyword">if</span> (x &gt; max) <span class="hljs-keyword">return</span> max;</span>
<span class="line">    <span class="hljs-keyword">return</span> x;</span>
<span class="line">}</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_clamp">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;28:</b> <kbd>[rtweekend.h]</kbd> The clamp() utility function</div></center>
<pre class="listing tilde"><code><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">write_color</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::ostream &amp;out, color pixel_color, <span class="hljs-keyword">int</span> samples_per_pixel)</span> </span>{</span>
<span class="line">    <span class="hljs-keyword">auto</span> r = pixel_color.x();</span>
<span class="line">    <span class="hljs-keyword">auto</span> g = pixel_color.y();</span>
<span class="line">    <span class="hljs-keyword">auto</span> b = pixel_color.z();</span>
<span class="line"></span>
<span class="line">    <span class="hljs-comment">// Divide the color by the number of samples.</span></span>
<span class="line">    <span class="hljs-keyword">auto</span> scale = <span class="hljs-number">1.0</span> / samples_per_pixel;</span>
<span class="line">    r *= scale;</span>
<span class="line">    g *= scale;</span>
<span class="line">    b *= scale;</span>
<span class="line"></span>
<span class="line">    <span class="hljs-comment">// Write the translated [0,255] value of each color component.</span></span>
<span class="line">    out &lt;&lt; <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">int</span>&gt;(<span class="hljs-number">256</span> * clamp(r, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.999</span>)) &lt;&lt; <span class="hljs-string">' '</span></span>
<span class="line">        &lt;&lt; <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">int</span>&gt;(<span class="hljs-number">256</span> * clamp(g, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.999</span>)) &lt;&lt; <span class="hljs-string">' '</span></span>
<span class="line">        &lt;&lt; <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">int</span>&gt;(<span class="hljs-number">256</span> * clamp(b, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.999</span>)) &lt;&lt; <span class="hljs-string">'\n'</span>;</span>
<span class="line">}</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_write-color-clamped">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;29:</b> <kbd>[color.h]</kbd> The multi-sample write_color() function</div></center>
<p>


</p><div class="together">
Main is also changed:

<p></p><pre class="listing tilde"><code><div class=" highlight"><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"camera.h"</span></span></span></div><span class="line"></span>
<span class="line">...</span>
<span class="line"></span>
<span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{</span>
<span class="line"></span>
<span class="line">    <span class="hljs-comment">// Image</span></span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> aspect_ratio = <span class="hljs-number">16.0</span> / <span class="hljs-number">9.0</span>;</span>
<span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> image_width = <span class="hljs-number">400</span>;</span>
<span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> image_height = <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">int</span>&gt;(image_width / aspect_ratio);</span><div class=" highlight"><span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> samples_per_pixel = <span class="hljs-number">100</span>;</span></div><span class="line"></span>
<span class="line">    <span class="hljs-comment">// World</span></span>
<span class="line"></span>
<span class="line">    hittable_list world;</span>
<span class="line">    world.add(make_shared&lt;sphere&gt;(point3(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">-1</span>), <span class="hljs-number">0.5</span>));</span>
<span class="line">    world.add(make_shared&lt;sphere&gt;(point3(<span class="hljs-number">0</span>,<span class="hljs-number">-100.5</span>,<span class="hljs-number">-1</span>), <span class="hljs-number">100</span>));</span>
<span class="line"></span>
<span class="line">    <span class="hljs-comment">// Camera</span></span>
<span class="line"></span><div class=" highlight"><span class="line">    camera cam;</span></div><span class="line"></span>
<span class="line">    <span class="hljs-comment">// Render</span></span>
<span class="line"></span>
<span class="line">    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"P3\n"</span> &lt;&lt; image_width &lt;&lt; <span class="hljs-string">" "</span> &lt;&lt; image_height &lt;&lt; <span class="hljs-string">"\n255\n"</span>;</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = image_height<span class="hljs-number">-1</span>; j &gt;= <span class="hljs-number">0</span>; --j) {</span>
<span class="line">        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"\rScanlines remaining: "</span> &lt;&lt; j &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; <span class="hljs-built_in">std</span>::flush;</span>
<span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; image_width; ++i) {</span><div class=" highlight"><span class="line">            <span class="hljs-function">color <span class="hljs-title">pixel_color</span><span class="hljs-params">(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)</span></span>;</span>
<span class="line">            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> s = <span class="hljs-number">0</span>; s &lt; samples_per_pixel; ++s) {</span>
<span class="line">                <span class="hljs-keyword">auto</span> u = (i + random_double()) / (image_width<span class="hljs-number">-1</span>);</span>
<span class="line">                <span class="hljs-keyword">auto</span> v = (j + random_double()) / (image_height<span class="hljs-number">-1</span>);</span>
<span class="line">                ray r = cam.get_ray(u, v);</span>
<span class="line">                pixel_color += ray_color(r, world);</span>
<span class="line">            }</span>
<span class="line">            write_color(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span>, pixel_color, samples_per_pixel);</span></div><span class="line">        }</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"\nDone.\n"</span>;</span>
<span class="line">}</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_main-multi-sample">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;30:</b> <kbd>[main.cc]</kbd> Rendering with multi-sampled pixels</div></center>
<p>

</p></div>

<p></p><p>

Zooming into the image that is produced, we can see the difference in edge pixels.

</p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/img-1.06-antialias-before-after.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing in One Weekend_files/img-1.06-antialias-before-after.png"></a><center><span class="imagecaption">Image 6: Before and after antialiasing
  </span></center></div></center>

<p></p>
<a class="target" name="diffusematerials">&nbsp;</a><a class="target" name="diffusematerials">&nbsp;</a><a class="target" name="toc8">&nbsp;</a><h1>Diffuse Materials</h1>
<p>


Now that we have objects and multiple rays per pixel, we can make some realistic looking materials.
We’ll start with diffuse (matte) materials. One question is whether we mix and match geometry and
materials (so we can assign a material to multiple spheres, or vice versa) or if geometry and
material are tightly bound (that could be useful for procedural objects where the geometry and
material are linked). We’ll go with separate — which is usual in most renderers — but do be aware
of the limitation.

</p>
<a class="target" name="asimplediffusematerial">&nbsp;</a><a class="target" name="diffusematerials/asimplediffusematerial">&nbsp;</a><a class="target" name="toc8.1">&nbsp;</a><h2>A Simple Diffuse Material</h2>
<p>

</p><div class="together">
Diffuse objects that don’t emit light merely take on the color of their surroundings, but they
modulate that with their own intrinsic color. Light that reflects off a diffuse surface has its
direction randomized. So, if we send three rays into a crack between two diffuse surfaces they will
each have different random behavior:

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/fig-1.08-light-bounce.jpg" target="_blank"><img class="markdeep" src="./Ray Tracing in One Weekend_files/fig-1.08-light-bounce.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_light-bounce">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;8:</b> Light ray bounces</span></center></div></center>

<p></p><p>

</p></div>

<p></p><p>

They also might be absorbed rather than reflected. The darker the surface, the more likely
absorption is. (That’s why it is dark!) Really any algorithm that randomizes direction will produce
surfaces that look matte. One of the simplest ways to do this turns out to be exactly correct for
ideal diffuse surfaces. (I used to do it as a lazy hack that approximates mathematically ideal
Lambertian.)

</p><p>

(Reader Vassillen Chizhov proved that the lazy hack is indeed just a lazy hack and is inaccurate.
The correct representation of ideal Lambertian isn't much more work, and is presented at the end of
the chapter.)

</p><p>

</p><div class="together">
There are two unit radius spheres tangent to the hit point <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-69-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-752" style="width: 0.653em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.503em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1000.5em, 2.252em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-753"><span class="mi" id="MathJax-Span-754" style="font-family: MathJax_Math-italic;">p</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math></span></span><script type="math/tex" id="MathJax-Element-69">p</script> of a surface. These two spheres have
a center of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-70-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-755" style="width: 4.252em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.402em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.403em, 1003.3em, 2.702em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-756"><span class="mo" id="MathJax-Span-757" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-758"><span class="mrow" id="MathJax-Span-759"><span class="mi" id="MathJax-Span-760" style="font-family: MathJax_Main-bold;">P</span></span></span><span class="mo" id="MathJax-Span-761" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="texatom" id="MathJax-Span-762" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-763"><span class="mi" id="MathJax-Span-764" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-765" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo>+</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-70">(\mathbf{P} + \mathbf{n})</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-71-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-766" style="width: 4.252em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.402em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.403em, 1003.3em, 2.702em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-767"><span class="mo" id="MathJax-Span-768" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-769"><span class="mrow" id="MathJax-Span-770"><span class="mi" id="MathJax-Span-771" style="font-family: MathJax_Main-bold;">P</span></span></span><span class="mo" id="MathJax-Span-772" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="texatom" id="MathJax-Span-773" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-774"><span class="mi" id="MathJax-Span-775" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-776" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-71">(\mathbf{P} - \mathbf{n})</script>, where <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-72-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-777" style="width: 0.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.653em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.602em, 1000.65em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-778"><span class="texatom" id="MathJax-Span-779"><span class="mrow" id="MathJax-Span-780"><span class="mi" id="MathJax-Span-781" style="font-family: MathJax_Main-bold;">n</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-72">\mathbf{n}</script> is the
normal of the surface. The sphere with a center at <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-73-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-782" style="width: 4.252em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.402em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.403em, 1003.3em, 2.702em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-783"><span class="mo" id="MathJax-Span-784" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-785"><span class="mrow" id="MathJax-Span-786"><span class="mi" id="MathJax-Span-787" style="font-family: MathJax_Main-bold;">P</span></span></span><span class="mo" id="MathJax-Span-788" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="texatom" id="MathJax-Span-789" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-790"><span class="mi" id="MathJax-Span-791" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-792" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-73">(\mathbf{P} - \mathbf{n})</script> is considered
<em class="underscore">inside</em> the surface, whereas the sphere with center <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-74-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-793" style="width: 4.252em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.402em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.403em, 1003.3em, 2.702em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-794"><span class="mo" id="MathJax-Span-795" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-796"><span class="mrow" id="MathJax-Span-797"><span class="mi" id="MathJax-Span-798" style="font-family: MathJax_Main-bold;">P</span></span></span><span class="mo" id="MathJax-Span-799" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="texatom" id="MathJax-Span-800" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-801"><span class="mi" id="MathJax-Span-802" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-803" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo>+</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-74">(\mathbf{P} + \mathbf{n})</script> is considered
<em class="underscore">outside</em> the surface. Select the tangent unit radius sphere that is on the same side of the surface
as the ray origin. Pick a random point <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-75-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;S&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-804" style="width: 0.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.653em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1000.6em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-805"><span class="texatom" id="MathJax-Span-806"><span class="mrow" id="MathJax-Span-807"><span class="mi" id="MathJax-Span-808" style="font-family: MathJax_Main-bold;">S</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">S</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-75">\mathbf{S}</script> inside this unit radius sphere and send a ray
from the hit point <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-76-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-809" style="width: 1.002em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1000.75em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-810"><span class="texatom" id="MathJax-Span-811"><span class="mrow" id="MathJax-Span-812"><span class="mi" id="MathJax-Span-813" style="font-family: MathJax_Main-bold;">P</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-76">\mathbf{P}</script> to the random point <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-77-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;S&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-814" style="width: 0.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.653em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1000.6em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-815"><span class="texatom" id="MathJax-Span-816"><span class="mrow" id="MathJax-Span-817"><span class="mi" id="MathJax-Span-818" style="font-family: MathJax_Main-bold;">S</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">S</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-77">\mathbf{S}</script> (this is the vector
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-78-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;S&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-819" style="width: 4.252em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.402em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.403em, 1003.3em, 2.702em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-820"><span class="mo" id="MathJax-Span-821" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-822"><span class="mrow" id="MathJax-Span-823"><span class="mi" id="MathJax-Span-824" style="font-family: MathJax_Main-bold;">S</span></span></span><span class="mo" id="MathJax-Span-825" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="texatom" id="MathJax-Span-826" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-827"><span class="mi" id="MathJax-Span-828" style="font-family: MathJax_Main-bold;">P</span></span></span><span class="mo" id="MathJax-Span-829" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">S</mi></mrow><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">P</mi></mrow><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-78">(\mathbf{S}-\mathbf{P})</script>):

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/fig-1.09-rand-vec.jpg" target="_blank"><img class="markdeep" src="./Ray Tracing in One Weekend_files/fig-1.09-rand-vec.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_rand-vec">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;9:</b> Generating a random diffuse bounce ray</span></center></div></center>

<p></p><p>

</p></div>

<p></p><p>

</p><div class="together">
We need a way to pick a random point in a unit radius sphere. We’ll use what is usually the easiest
algorithm: a rejection method. First, pick a random point in the unit cube where x, y, and z all
range from −1 to +1. Reject this point and try again if the point is outside the sphere.

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">vec3</span> {</span></span>
<span class="line">  <span class="hljs-keyword">public</span>:</span>
<span class="line">    ...</span>
<span class="line">    <span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">static</span> vec3 <span class="hljs-title">random</span><span class="hljs-params">()</span> </span>{</span>
<span class="line">        <span class="hljs-keyword">return</span> vec3(random_double(), random_double(), random_double());</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    <span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">static</span> vec3 <span class="hljs-title">random</span><span class="hljs-params">(<span class="hljs-keyword">double</span> min, <span class="hljs-keyword">double</span> max)</span> </span>{</span>
<span class="line">        <span class="hljs-keyword">return</span> vec3(random_double(min,max), random_double(min,max), random_double(min,max));</span>
<span class="line">    }</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_vec-rand-util">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;31:</b> <kbd>[vec3.h]</kbd> vec3 random utility functions</div></center>
<pre class="listing tilde"><code><span class="line"><span class="hljs-function">vec3 <span class="hljs-title">random_in_unit_sphere</span><span class="hljs-params">()</span> </span>{</span>
<span class="line">    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {</span>
<span class="line">        <span class="hljs-keyword">auto</span> p = vec3::random(<span class="hljs-number">-1</span>,<span class="hljs-number">1</span>);</span>
<span class="line">        <span class="hljs-keyword">if</span> (p.length_squared() &gt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">continue</span>;</span>
<span class="line">        <span class="hljs-keyword">return</span> p;</span>
<span class="line">    }</span>
<span class="line">}</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_random-in-unit-sphere">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;32:</b> <kbd>[vec3.h]</kbd> The random_in_unit_sphere() function</div></center>
<p>

</p></div>

<p></p><p>

</p><div class="together">
Then update the <code>ray_color()</code> function to use the new random direction generator:

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-function">color <span class="hljs-title">ray_color</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ray&amp; r, <span class="hljs-keyword">const</span> hittable&amp; world)</span> </span>{</span>
<span class="line">    hit_record rec;</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">if</span> (world.hit(r, <span class="hljs-number">0</span>, infinity, rec)) {</span><div class=" highlight"><span class="line">        point3 target = rec.p + rec.normal + random_in_unit_sphere();</span>
<span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-number">0.5</span> * ray_color(ray(rec.p, target - rec.p), world);</span></div><span class="line">    }</span>
<span class="line"></span>
<span class="line">    vec3 unit_direction = unit_vector(r.direction());</span>
<span class="line">    <span class="hljs-keyword">auto</span> t = <span class="hljs-number">0.5</span>*(unit_direction.y() + <span class="hljs-number">1.0</span>);</span>
<span class="line">    <span class="hljs-keyword">return</span> (<span class="hljs-number">1.0</span>-t)*color(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>) + t*color(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.7</span>, <span class="hljs-number">1.0</span>);</span>
<span class="line">}</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_ray-color-random-unit">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;33:</b> <kbd>[main.cc]</kbd> ray_color() using a random ray direction</div></center>
<p>

</p></div>

<p></p>
<a class="target" name="limitingthenumberofchildrays">&nbsp;</a><a class="target" name="diffusematerials/limitingthenumberofchildrays">&nbsp;</a><a class="target" name="toc8.2">&nbsp;</a><h2>Limiting the Number of Child Rays</h2>
<p>

</p><div class="together">
There's one potential problem lurking here. Notice that the <code>ray_color</code> function is recursive. When
will it stop recursing? When it fails to hit anything. In some cases, however, that may be a long
time — long enough to blow the stack. To guard against that, let's limit the maximum recursion
depth, returning no light contribution at the maximum depth:

<p></p><pre class="listing tilde"><code><div class=" highlight"><span class="line"><span class="hljs-function">color <span class="hljs-title">ray_color</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ray&amp; r, <span class="hljs-keyword">const</span> hittable&amp; world, <span class="hljs-keyword">int</span> depth)</span> </span>{</span></div><span class="line">    hit_record rec;</span>
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line">    <span class="hljs-comment">// If we've exceeded the ray bounce limit, no more light is gathered.</span></span>
<span class="line">    <span class="hljs-keyword">if</span> (depth &lt;= <span class="hljs-number">0</span>)</span>
<span class="line">        <span class="hljs-keyword">return</span> color(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);</span></div><span class="line"></span>
<span class="line">    <span class="hljs-keyword">if</span> (world.hit(r, <span class="hljs-number">0</span>, infinity, rec)) {</span>
<span class="line">        point3 target = rec.p + rec.normal + random_in_unit_sphere();</span><div class=" highlight"><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-number">0.5</span> * ray_color(ray(rec.p, target - rec.p), world, depth<span class="hljs-number">-1</span>);</span></div><span class="line">    }</span>
<span class="line"></span>
<span class="line">    vec3 unit_direction = unit_vector(r.direction());</span>
<span class="line">    <span class="hljs-keyword">auto</span> t = <span class="hljs-number">0.5</span>*(unit_direction.y() + <span class="hljs-number">1.0</span>);</span>
<span class="line">    <span class="hljs-keyword">return</span> (<span class="hljs-number">1.0</span>-t)*color(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>) + t*color(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.7</span>, <span class="hljs-number">1.0</span>);</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">...</span>
<span class="line"></span>
<span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{</span>
<span class="line"></span>
<span class="line">    <span class="hljs-comment">// Image</span></span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> aspect_ratio = <span class="hljs-number">16.0</span> / <span class="hljs-number">9.0</span>;</span>
<span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> image_width = <span class="hljs-number">400</span>;</span>
<span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> image_height = <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">int</span>&gt;(image_width / aspect_ratio);</span>
<span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> samples_per_pixel = <span class="hljs-number">100</span>;</span><div class=" highlight"><span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> max_depth = <span class="hljs-number">50</span>;</span></div><span class="line">    ...</span>
<span class="line"></span>
<span class="line">    <span class="hljs-comment">// Render</span></span>
<span class="line"></span>
<span class="line">    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"P3\n"</span> &lt;&lt; image_width &lt;&lt; <span class="hljs-string">" "</span> &lt;&lt; image_height &lt;&lt; <span class="hljs-string">"\n255\n"</span>;</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = image_height<span class="hljs-number">-1</span>; j &gt;= <span class="hljs-number">0</span>; --j) {</span>
<span class="line">        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"\rScanlines remaining: "</span> &lt;&lt; j &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; <span class="hljs-built_in">std</span>::flush;</span>
<span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; image_width; ++i) {</span>
<span class="line">            <span class="hljs-function">color <span class="hljs-title">pixel_color</span><span class="hljs-params">(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)</span></span>;</span>
<span class="line">            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> s = <span class="hljs-number">0</span>; s &lt; samples_per_pixel; ++s) {</span>
<span class="line">                <span class="hljs-keyword">auto</span> u = (i + random_double()) / (image_width<span class="hljs-number">-1</span>);</span>
<span class="line">                <span class="hljs-keyword">auto</span> v = (j + random_double()) / (image_height<span class="hljs-number">-1</span>);</span>
<span class="line">                ray r = cam.get_ray(u, v);</span><div class=" highlight"><span class="line">                pixel_color += ray_color(r, world, max_depth);</span></div><span class="line">            }</span>
<span class="line">            write_color(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span>, pixel_color, samples_per_pixel);</span>
<span class="line">        }</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"\nDone.\n"</span>;</span>
<span class="line">}</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_ray-color-depth">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;34:</b> <kbd>[main.cc]</kbd> ray_color() with depth limiting</div></center>
<p>

</p></div>

<p></p><p>

</p><div class="together">
This gives us:

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/img-1.07-first-diffuse.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing in One Weekend_files/img-1.07-first-diffuse.png"></a><center><span class="imagecaption">Image 7: First render of a diffuse sphere</span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="usinggammacorrectionforaccuratecolorintensity">&nbsp;</a><a class="target" name="diffusematerials/usinggammacorrectionforaccuratecolorintensity">&nbsp;</a><a class="target" name="toc8.3">&nbsp;</a><h2>Using Gamma Correction for Accurate Color Intensity</h2>
<p>

</p><div class="together">
Note the shadowing under the sphere. This picture is very dark, but our spheres only absorb half the
energy on each bounce, so they are 50% reflectors. If you can’t see the shadow, don’t worry, we will
fix that now. These spheres should look pretty light (in real life, a light grey). The reason for
this is that almost all image viewers assume that the image is “gamma corrected”, meaning the 0 to 1
values have some transform before being stored as a byte. There are many good reasons for that, but
for our purposes we just need to be aware of it. To a first approximation, we can use “gamma 2”
which means raising the color to the power <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-79-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;/&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-830" style="width: 5.402em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.303em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1004.3em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-831"><span class="mn" id="MathJax-Span-832" style="font-family: MathJax_Main;">1</span><span class="texatom" id="MathJax-Span-833"><span class="mrow" id="MathJax-Span-834"><span class="mo" id="MathJax-Span-835" style="font-family: MathJax_Main;">/</span></span></span><span class="mi" id="MathJax-Span-836" style="font-family: MathJax_Math-italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-837" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-838" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-839" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-840" style="font-family: MathJax_Math-italic;">a</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mi>g</mi><mi>a</mi><mi>m</mi><mi>m</mi><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-79">1/gamma</script>, or in our simple case ½, which is just
square-root:

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">write_color</span><span class="hljs-params">(<span class="hljs-built_in">std</span>::ostream &amp;out, color pixel_color, <span class="hljs-keyword">int</span> samples_per_pixel)</span> </span>{</span>
<span class="line">    <span class="hljs-keyword">auto</span> r = pixel_color.x();</span>
<span class="line">    <span class="hljs-keyword">auto</span> g = pixel_color.y();</span>
<span class="line">    <span class="hljs-keyword">auto</span> b = pixel_color.z();</span>
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line">    <span class="hljs-comment">// Divide the color by the number of samples and gamma-correct for gamma=2.0.</span></span>
<span class="line">    <span class="hljs-keyword">auto</span> scale = <span class="hljs-number">1.0</span> / samples_per_pixel;</span>
<span class="line">    r = <span class="hljs-built_in">sqrt</span>(scale * r);</span>
<span class="line">    g = <span class="hljs-built_in">sqrt</span>(scale * g);</span>
<span class="line">    b = <span class="hljs-built_in">sqrt</span>(scale * b);</span></div><span class="line"></span>
<span class="line">    <span class="hljs-comment">// Write the translated [0,255] value of each color component.</span></span>
<span class="line">    out &lt;&lt; <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">int</span>&gt;(<span class="hljs-number">256</span> * clamp(r, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.999</span>)) &lt;&lt; <span class="hljs-string">' '</span></span>
<span class="line">        &lt;&lt; <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">int</span>&gt;(<span class="hljs-number">256</span> * clamp(g, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.999</span>)) &lt;&lt; <span class="hljs-string">' '</span></span>
<span class="line">        &lt;&lt; <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">int</span>&gt;(<span class="hljs-number">256</span> * clamp(b, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.999</span>)) &lt;&lt; <span class="hljs-string">'\n'</span>;</span>
<span class="line">}</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_write-color-gamma">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;35:</b> <kbd>[color.h]</kbd> write_color(), with gamma correction</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
That yields light grey, as we desire:

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/img-1.08-gamma-correct.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing in One Weekend_files/img-1.08-gamma-correct.png"></a><center><span class="imagecaption">Image 8: Diffuse sphere, with gamma correction
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="fixingshadowacne">&nbsp;</a><a class="target" name="diffusematerials/fixingshadowacne">&nbsp;</a><a class="target" name="toc8.4">&nbsp;</a><h2>Fixing Shadow Acne</h2>
<p>

</p><div class="together">
There’s also a subtle bug in there. Some of the reflected rays hit the object they are reflecting
off of not at exactly <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-80-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-841" style="width: 2.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.252em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1002.2em, 2.302em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-842"><span class="mi" id="MathJax-Span-843" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-844" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mn" id="MathJax-Span-845" style="font-family: MathJax_Main; padding-left: 0.302em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi><mo>=</mo><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-80">t=0</script>, but instead at <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-81-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;0.0000001&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-846" style="width: 8.503em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.803em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1006.75em, 2.402em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-847"><span class="mi" id="MathJax-Span-848" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-849" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mo" id="MathJax-Span-850" style="font-family: MathJax_Main; padding-left: 0.302em;">−</span><span class="mn" id="MathJax-Span-851" style="font-family: MathJax_Main;">0.0000001</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.184em; border-left: 0px solid; width: 0px; height: 1.066em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi><mo>=</mo><mo>−</mo><mn>0.0000001</mn></math></span></span><script type="math/tex" id="MathJax-Element-81">t=-0.0000001</script> or <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-82-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0.00000001&lt;/mn&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-852" style="width: 8.152em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.503em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1006.45em, 2.302em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-853"><span class="mi" id="MathJax-Span-854" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-855" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mn" id="MathJax-Span-856" style="font-family: MathJax_Main; padding-left: 0.302em;">0.00000001</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi><mo>=</mo><mn>0.00000001</mn></math></span></span><script type="math/tex" id="MathJax-Element-82">t=0.00000001</script> or whatever floating
point approximation the sphere intersector gives us. So we need to ignore hits very near zero:

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-keyword">if</span> (world.hit(r, <span class="hljs-number">0.001</span>, infinity, rec)) {</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_reflect-tolerance">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;36:</b> <kbd>[main.cc]</kbd> Calculating reflected ray origins with tolerance</div></center>
<p>


This gets rid of the shadow acne problem. Yes it is really called that.
</p></div>

<p></p>
<a class="target" name="truelambertianreflection">&nbsp;</a><a class="target" name="diffusematerials/truelambertianreflection">&nbsp;</a><a class="target" name="toc8.5">&nbsp;</a><h2>True Lambertian Reflection</h2>
<p>

</p><div class="together">
The rejection method presented here produces random points in the unit ball offset along the surface
normal. This corresponds to picking directions on the hemisphere with high probability close to the
normal, and a lower probability of scattering rays at grazing angles. This distribution scales by
the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-83-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-857" style="width: 3.952em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.152em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.153em, 1003.05em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-858"><span class="msubsup" id="MathJax-Span-859"><span style="display: inline-block; position: relative; width: 1.752em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1001.3em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-860" style="font-family: MathJax_Main;">cos</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.348em; left: 1.353em;"><span class="mn" id="MathJax-Span-861" style="font-size: 70.7%; font-family: MathJax_Main;">3</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-862"></span><span class="mo" id="MathJax-Span-863" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-864" style="font-family: MathJax_Math-italic;">ϕ</span><span class="mo" id="MathJax-Span-865" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.503em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>cos</mi><mn>3</mn></msup><mo>⁡</mo><mo stretchy="false">(</mo><mi>ϕ</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-83">\cos^3 (\phi)</script> where <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-84-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-866" style="width: 0.753em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.603em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.052em, 1000.6em, 2.252em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-867"><span class="mi" id="MathJax-Span-868" style="font-family: MathJax_Math-italic;">ϕ</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>ϕ</mi></math></span></span><script type="math/tex" id="MathJax-Element-84">\phi</script> is the angle from the normal. This is useful since light arriving
at shallow angles spreads over a larger area, and thus has a lower contribution to the final color.

<p></p><p>

However, we are interested in a Lambertian distribution, which has a distribution of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-85-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-869" style="width: 3.402em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.702em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1002.6em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-870"><span class="mi" id="MathJax-Span-871" style="font-family: MathJax_Main;">cos</span><span class="mo" id="MathJax-Span-872"></span><span class="mo" id="MathJax-Span-873" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-874" style="font-family: MathJax_Math-italic;">ϕ</span><span class="mo" id="MathJax-Span-875" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>ϕ</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-85">\cos (\phi)</script>.
True Lambertian has the probability higher for ray scattering close to the normal, but the
distribution is more uniform. This is achieved by picking random points on the surface of the unit
sphere, offset along the surface normal. Picking random points on the unit sphere can be achieved by
picking random points <em class="underscore">in</em> the unit sphere, and then normalizing those.

</p><pre class="listing tilde"><code><span class="line"><span class="hljs-function"><span class="hljs-keyword">inline</span> vec3 <span class="hljs-title">random_in_unit_sphere</span><span class="hljs-params">()</span> </span>{</span>
<span class="line">    ...</span>
<span class="line">}</span>
<span class="line"></span><div class=" highlight"><span class="line"><span class="hljs-function">vec3 <span class="hljs-title">random_unit_vector</span><span class="hljs-params">()</span> </span>{</span>
<span class="line">    <span class="hljs-keyword">return</span> unit_vector(random_in_unit_sphere());</span>
<span class="line">}</span></div></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_random-unit-vector">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;37:</b> <kbd>[vec3.h]</kbd> The random_unit_vector() function</div></center>
<p>


  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/fig-1.10-rand-unitvec.png" target="_blank"><img class="markdeep" src="./Ray Tracing in One Weekend_files/fig-1.10-rand-unitvec.png"></a><center><span class="imagecaption"><a class="target" name="figure_rand-unitvec">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;10:</b> Generating a random unit vector</span></center></div></center>

<p></p><p>

</p></div>

<p></p><p>

</p><div class="together">
This <code>random_unit_vector()</code> is a drop-in replacement for the existing <code>random_in_unit_sphere()</code>
function.

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-function">color <span class="hljs-title">ray_color</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ray&amp; r, <span class="hljs-keyword">const</span> hittable&amp; world, <span class="hljs-keyword">int</span> depth)</span> </span>{</span>
<span class="line">    hit_record rec;</span>
<span class="line"></span>
<span class="line">    <span class="hljs-comment">// If we've exceeded the ray bounce limit, no more light is gathered.</span></span>
<span class="line">    <span class="hljs-keyword">if</span> (depth &lt;= <span class="hljs-number">0</span>)</span>
<span class="line">        <span class="hljs-keyword">return</span> color(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">if</span> (world.hit(r, <span class="hljs-number">0.001</span>, infinity, rec)) {</span><div class=" highlight"><span class="line">        point3 target = rec.p + rec.normal + random_unit_vector();</span></div><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-number">0.5</span> * ray_color(ray(rec.p, target - rec.p), world, depth<span class="hljs-number">-1</span>);</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    vec3 unit_direction = unit_vector(r.direction());</span>
<span class="line">    <span class="hljs-keyword">auto</span> t = <span class="hljs-number">0.5</span>*(unit_direction.y() + <span class="hljs-number">1.0</span>);</span>
<span class="line">    <span class="hljs-keyword">return</span> (<span class="hljs-number">1.0</span>-t)*color(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>) + t*color(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.7</span>, <span class="hljs-number">1.0</span>);</span>
<span class="line">}</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_ray-color-unit-sphere">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;38:</b> <kbd>[main.cc]</kbd> ray_color() with replacement diffuse</div></center>
<p>

</p></div>

<p></p><p>

</p><div class="together">
After rendering we get a similar image:

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/img-1.09-correct-lambertian.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing in One Weekend_files/img-1.09-correct-lambertian.png"></a><center><span class="imagecaption">Image 9: Correct rendering of Lambertian spheres
  </span></center></div></center>

<p></p><p>

It's hard to tell the difference between these two diffuse methods, given that our scene of two
spheres is so simple, but you should be able to notice two important visual differences:

</p><p>

</p><ol start="1">
  <li class="number">The shadows are less pronounced after the change
</li>
  <li class="number">Both spheres are lighter in appearance after the change</li></ol>

<p></p><p>

Both of these changes are due to the more uniform scattering of the light rays, fewer rays are
scattering toward the normal. This means that for diffuse objects, they will appear <em class="underscore">lighter</em>
because more light bounces toward the camera. For the shadows, less light bounces straight-up, so
the parts of the larger sphere directly underneath the smaller sphere are brighter.
</p></div>

<p></p>
<a class="target" name="analternativediffuseformulation">&nbsp;</a><a class="target" name="diffusematerials/analternativediffuseformulation">&nbsp;</a><a class="target" name="toc8.6">&nbsp;</a><h2>An Alternative Diffuse Formulation</h2>
<p>

</p><div class="together">
The initial hack presented in this book lasted a long time before it was proven to be an incorrect
approximation of ideal Lambertian diffuse. A big reason that the error persisted for so long is
that it can be difficult to:

<p></p><p>

</p><ol start="1">
  <li class="number">Mathematically prove that the probability distribution is incorrect
</li>
  <li class="number">Intuitively explain why a <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-86-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-876" style="width: 3.402em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.702em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1002.6em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-877"><span class="mi" id="MathJax-Span-878" style="font-family: MathJax_Main;">cos</span><span class="mo" id="MathJax-Span-879"></span><span class="mo" id="MathJax-Span-880" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-881" style="font-family: MathJax_Math-italic;">ϕ</span><span class="mo" id="MathJax-Span-882" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>ϕ</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-86">\cos (\phi)</script> distribution is desirable (and what it would look like)</li></ol>

<p></p><p>

Not a lot of common, everyday objects are perfectly diffuse, so our visual intuition of how these
objects behave under light can be poorly formed.
</p></div>

<p></p><p>

</p><div class="together">
In the interest of learning, we are including an intuitive and easy to understand diffuse method.
For the two methods above we had a random vector, first of random length and then of unit length,
offset from the hit point by the normal. It may not be immediately obvious why the vectors should be
displaced by the normal.

<p></p><p>

A more intuitive approach is to have a uniform scatter direction for all angles away from the hit
point, with no dependence on the angle from the normal. Many of the first raytracing papers used
this diffuse method (before adopting Lambertian diffuse).

</p><pre class="listing tilde"><code><span class="line"><span class="hljs-function">vec3 <span class="hljs-title">random_in_hemisphere</span><span class="hljs-params">(<span class="hljs-keyword">const</span> vec3&amp; normal)</span> </span>{</span>
<span class="line">    vec3 in_unit_sphere = random_in_unit_sphere();</span>
<span class="line">    <span class="hljs-keyword">if</span> (dot(in_unit_sphere, normal) &gt; <span class="hljs-number">0.0</span>) <span class="hljs-comment">// In the same hemisphere as the normal</span></span>
<span class="line">        <span class="hljs-keyword">return</span> in_unit_sphere;</span>
<span class="line">    <span class="hljs-keyword">else</span></span>
<span class="line">        <span class="hljs-keyword">return</span> -in_unit_sphere;</span>
<span class="line">}</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_random-in-hemisphere">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;39:</b> <kbd>[vec3.h]</kbd> The random_in_hemisphere(normal) function</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
Plugging the new formula into the <code>ray_color()</code> function:

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-function">color <span class="hljs-title">ray_color</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ray&amp; r, <span class="hljs-keyword">const</span> hittable&amp; world, <span class="hljs-keyword">int</span> depth)</span> </span>{</span>
<span class="line">    hit_record rec;</span>
<span class="line"></span>
<span class="line">    <span class="hljs-comment">// If we've exceeded the ray bounce limit, no more light is gathered.</span></span>
<span class="line">    <span class="hljs-keyword">if</span> (depth &lt;= <span class="hljs-number">0</span>)</span>
<span class="line">        <span class="hljs-keyword">return</span> color(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">if</span> (world.hit(r, <span class="hljs-number">0.001</span>, infinity, rec)) {</span><div class=" highlight"><span class="line">        point3 target = rec.p + random_in_hemisphere(rec.normal);</span></div><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-number">0.5</span> * ray_color(ray(rec.p, target - rec.p), world, depth<span class="hljs-number">-1</span>);</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    vec3 unit_direction = unit_vector(r.direction());</span>
<span class="line">    <span class="hljs-keyword">auto</span> t = <span class="hljs-number">0.5</span>*(unit_direction.y() + <span class="hljs-number">1.0</span>);</span>
<span class="line">    <span class="hljs-keyword">return</span> (<span class="hljs-number">1.0</span>-t)*color(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>) + t*color(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.7</span>, <span class="hljs-number">1.0</span>);</span>
<span class="line">}</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_ray-color-hemisphere">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;40:</b> <kbd>[main.cc]</kbd> ray_color() with hemispherical scattering</div></center>
<p>


Gives us the following image:

</p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/img-1.10-rand-hemispherical.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing in One Weekend_files/img-1.10-rand-hemispherical.png"></a><center><span class="imagecaption">Image 10: Rendering of diffuse spheres with hemispherical scattering
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p><p>

</p><div class="together">
Scenes will become more complicated over the course of the book. You are encouraged to
switch between the different diffuse renderers presented here. Most scenes of interest will contain
a disproportionate amount of diffuse materials. You can gain valuable insight by understanding the
effect of different diffuse methods on the lighting of the scene.
</div>

<p></p>
<a class="target" name="metal">&nbsp;</a><a class="target" name="metal">&nbsp;</a><a class="target" name="toc9">&nbsp;</a><h1>Metal</h1>

<a class="target" name="anabstractclassformaterials">&nbsp;</a><a class="target" name="metal/anabstractclassformaterials">&nbsp;</a><a class="target" name="toc9.1">&nbsp;</a><h2>An Abstract Class for Materials</h2>
<p>

If we want different objects to have different materials, we have a design decision. We could have a
universal material with lots of parameters and different material types just zero out some of those
parameters. This is not a bad approach. Or we could have an abstract material class that
encapsulates behavior. I am a fan of the latter approach. For our program the material needs to do
two things:

</p><p>

</p><ol start="1">
  <li class="number">Produce a scattered ray (or say it absorbed the incident ray).
</li>
  <li class="number">If scattered, say how much the ray should be attenuated.</li></ol>

<p></p><p>

</p><div class="together">
This suggests the abstract class:

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> MATERIAL_H</span></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MATERIAL_H</span></span>
<span class="line"></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"rtweekend.h"</span></span></span>
<span class="line"></span>
<span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">hit_record</span>;</span></span>
<span class="line"></span>
<span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">material</span> {</span></span>
<span class="line">    <span class="hljs-keyword">public</span>:</span>
<span class="line">        <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">scatter</span><span class="hljs-params">(</span>
<span class="line">            <span class="hljs-keyword">const</span> ray&amp; r_in, <span class="hljs-keyword">const</span> hit_record&amp; rec, color&amp; attenuation, ray&amp; scattered</span>
<span class="line">        )</span> <span class="hljs-keyword">const</span> </span>= <span class="hljs-number">0</span>;</span>
<span class="line">};</span>
<span class="line"></span>
<span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span></span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_material-initial">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;41:</b> <kbd>[material.h]</kbd> The material class</div></center>
<p>

</p></div>

<p></p>
<a class="target" name="adatastructuretodescriberay-objectintersections">&nbsp;</a><a class="target" name="metal/adatastructuretodescriberay-objectintersections">&nbsp;</a><a class="target" name="toc9.2">&nbsp;</a><h2>A Data Structure to Describe Ray-Object Intersections</h2>
<p>

</p><div class="together">
The <code>hit_record</code> is to avoid a bunch of arguments so we can stuff whatever info we want in there.
You can use arguments instead; it’s a matter of taste. Hittables and materials need to know each
other so there is some circularity of the references. In C++ you just need to alert the compiler
that the pointer is to a class, which the “class material” in the hittable class below does:

<p></p><pre class="listing tilde"><code><span class="line"></span><div class=" highlight"><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"rtweekend.h"</span></span></span>
<span class="line"></span>
<span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">material</span>;</span></span></div><span class="line"></span>
<span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">hit_record</span> {</span></span>
<span class="line">    point3 p;</span>
<span class="line">    vec3 normal;</span><div class=" highlight"><span class="line">    <span class="hljs-built_in">shared_ptr</span>&lt;material&gt; mat_ptr;</span></div><span class="line">    <span class="hljs-keyword">double</span> t;</span>
<span class="line">    <span class="hljs-keyword">bool</span> front_face;</span>
<span class="line"></span>
<span class="line">    <span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">set_face_normal</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ray&amp; r, <span class="hljs-keyword">const</span> vec3&amp; outward_normal)</span> </span>{</span>
<span class="line">        front_face = dot(r.direction(), outward_normal) &lt; <span class="hljs-number">0</span>;</span>
<span class="line">        normal = front_face ? outward_normal :-outward_normal;</span>
<span class="line">    }</span>
<span class="line">};</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_hit-with-material">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;42:</b> <kbd>[hittable.h]</kbd> Hit record with added material pointer</div></center>
<p>

</p></div>

<p></p><p>

What we have set up here is that material will tell us how rays interact with the surface.
<code>hit_record</code> is just a way to stuff a bunch of arguments into a struct so we can send them as a
group. When a ray hits a surface (a particular sphere for example), the material pointer in the
<code>hit_record</code> will be set to point at the material pointer the sphere was given when it was set up in
<code>main()</code> when we start. When the <code>ray_color()</code> routine gets the <code>hit_record</code> it can call member
functions of the material pointer to find out what ray, if any, is scattered.

</p><p>

</p><div class="together">
To achieve this, we must have a reference to the material for our sphere class to returned
within <code>hit_record</code>. See the highlighted lines below:

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">sphere</span> :</span> <span class="hljs-keyword">public</span> hittable {</span>
<span class="line">    <span class="hljs-keyword">public</span>:</span>
<span class="line">        sphere() {}</span><div class=" highlight"><span class="line">        sphere(point3 cen, <span class="hljs-keyword">double</span> r, <span class="hljs-built_in">shared_ptr</span>&lt;material&gt; m)</span>
<span class="line">            : center(cen), radius(r), mat_ptr(m) {};</span></div><span class="line"></span>
<span class="line">        <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">hit</span><span class="hljs-params">(</span>
<span class="line">            <span class="hljs-keyword">const</span> ray&amp; r, <span class="hljs-keyword">double</span> t_min, <span class="hljs-keyword">double</span> t_max, hit_record&amp; rec)</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span></span>;</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">public</span>:</span>
<span class="line">        point3 center;</span>
<span class="line">        <span class="hljs-keyword">double</span> radius;</span><div class=" highlight"><span class="line">        <span class="hljs-built_in">shared_ptr</span>&lt;material&gt; mat_ptr;</span></div><span class="line">};</span>
<span class="line"></span>
<span class="line"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">sphere::hit</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ray&amp; r, <span class="hljs-keyword">double</span> t_min, <span class="hljs-keyword">double</span> t_max, hit_record&amp; rec)</span> <span class="hljs-keyword">const</span> </span>{</span>
<span class="line">    ...</span>
<span class="line"></span>
<span class="line">    rec.t = root;</span>
<span class="line">    rec.p = r.at(rec.t);</span>
<span class="line">    vec3 outward_normal = (rec.p - center) / radius;</span>
<span class="line">    rec.set_face_normal(r, outward_normal);</span><div class=" highlight"><span class="line">    rec.mat_ptr = mat_ptr;</span></div><span class="line"></span>
<span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</span>
<span class="line">}</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_sphere-material">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;43:</b> <kbd>[sphere.h]</kbd> Ray-sphere intersection with added material information</div></center>
<p>

</p></div>

<p></p>
<a class="target" name="modelinglightscatterandreflectance">&nbsp;</a><a class="target" name="metal/modelinglightscatterandreflectance">&nbsp;</a><a class="target" name="toc9.3">&nbsp;</a><h2>Modeling Light Scatter and Reflectance</h2>
<p>

</p><div class="together">
For the Lambertian (diffuse) case we already have, it can either scatter always and attenuate by its
reflectance <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-87-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-883" style="width: 0.953em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.753em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.052em, 1000.75em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-884"><span class="mi" id="MathJax-Span-885" style="font-family: MathJax_Math-italic;">R</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>R</mi></math></span></span><script type="math/tex" id="MathJax-Element-87">R</script>, or it can scatter with no attenuation but absorb the fraction <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-88-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-886" style="width: 3.103em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.452em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1002.45em, 2.402em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-887"><span class="mn" id="MathJax-Span-888" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-889" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="mi" id="MathJax-Span-890" style="font-family: MathJax_Math-italic; padding-left: 0.202em;">R</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.184em; border-left: 0px solid; width: 0px; height: 1.066em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mo>−</mo><mi>R</mi></math></span></span><script type="math/tex" id="MathJax-Element-88">1-R</script> of the rays, or
it could be a mixture of those strategies. For Lambertian materials we get this simple class:

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">lambertian</span> :</span> <span class="hljs-keyword">public</span> material {</span>
<span class="line">    <span class="hljs-keyword">public</span>:</span>
<span class="line">        lambertian(<span class="hljs-keyword">const</span> color&amp; a) : albedo(a) {}</span>
<span class="line"></span>
<span class="line">        <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">scatter</span><span class="hljs-params">(</span>
<span class="line">            <span class="hljs-keyword">const</span> ray&amp; r_in, <span class="hljs-keyword">const</span> hit_record&amp; rec, color&amp; attenuation, ray&amp; scattered</span>
<span class="line">        )</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{</span>
<span class="line">            <span class="hljs-keyword">auto</span> scatter_direction = rec.normal + random_unit_vector();</span>
<span class="line">            scattered = ray(rec.p, scatter_direction);</span>
<span class="line">            attenuation = albedo;</span>
<span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</span>
<span class="line">        }</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">public</span>:</span>
<span class="line">        color albedo;</span>
<span class="line">};</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_lambertian-initial">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;44:</b> <kbd>[material.h]</kbd> The lambertian material class</div></center>
<p>

</p></div>

<p></p><p>

Note we could just as well only scatter with some probability <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-89-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-891" style="width: 0.653em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.503em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1000.5em, 2.252em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-892"><span class="mi" id="MathJax-Span-893" style="font-family: MathJax_Math-italic;">p</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math></span></span><script type="math/tex" id="MathJax-Element-89">p</script> and have attenuation be
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-90-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;/&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-894" style="width: 4.702em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.752em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1003.75em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-895"><span class="mi" id="MathJax-Span-896" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-897" style="font-family: MathJax_Math-italic;">l</span><span class="mi" id="MathJax-Span-898" style="font-family: MathJax_Math-italic;">b</span><span class="mi" id="MathJax-Span-899" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-900" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-901" style="font-family: MathJax_Math-italic;">o</span><span class="texatom" id="MathJax-Span-902"><span class="mrow" id="MathJax-Span-903"><span class="mo" id="MathJax-Span-904" style="font-family: MathJax_Main;">/</span></span></span><span class="mi" id="MathJax-Span-905" style="font-family: MathJax_Math-italic;">p</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi><mi>l</mi><mi>b</mi><mi>e</mi><mi>d</mi><mi>o</mi><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mi>p</mi></math></span></span><script type="math/tex" id="MathJax-Element-90">albedo/p</script>. Your choice.

</p><p>

If you read the code above carefully, you'll notice a small chance of mischief. If the random unit
vector we generate is exactly opposite the normal vector, the two will sum to zero, which will
result in a zero scatter direction vector. This leads to bad scenarios later on (infinities and
NaNs), so we need to intercept the condition before we pass it on.

</p><p>

</p><div class="together">
In service of this, we'll create a new vector method — <code>vec3::near_zero()</code> — that returns true if
the vector is very close to zero in all dimensions.

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">vec3</span> {</span></span>
<span class="line">    ...</span>
<span class="line">    <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">near_zero</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>{</span>
<span class="line">        <span class="hljs-comment">// Return true if the vector is close to zero in all dimensions.</span></span>
<span class="line">        <span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> s = <span class="hljs-number">1e-8</span>;</span>
<span class="line">        <span class="hljs-keyword">return</span> (<span class="hljs-built_in">fabs</span>(e[<span class="hljs-number">0</span>]) &lt; s) &amp;&amp; (<span class="hljs-built_in">fabs</span>(e[<span class="hljs-number">1</span>]) &lt; s) &amp;&amp; (<span class="hljs-built_in">fabs</span>(e[<span class="hljs-number">2</span>]) &lt; s);</span>
<span class="line">    }</span>
<span class="line">    ...</span>
<span class="line">};</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_vec3-near-zero">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;45:</b> <kbd>[vec3.h]</kbd> The vec3::near_zero() method</div></center>
<pre class="listing tilde"><code><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">lambertian</span> :</span> <span class="hljs-keyword">public</span> material {</span>
<span class="line">    <span class="hljs-keyword">public</span>:</span>
<span class="line">        lambertian(<span class="hljs-keyword">const</span> color&amp; a) : albedo(a) {}</span>
<span class="line"></span>
<span class="line">        <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">scatter</span><span class="hljs-params">(</span>
<span class="line">            <span class="hljs-keyword">const</span> ray&amp; r_in, <span class="hljs-keyword">const</span> hit_record&amp; rec, color&amp; attenuation, ray&amp; scattered</span>
<span class="line">        )</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{</span>
<span class="line">            <span class="hljs-keyword">auto</span> scatter_direction = rec.normal + random_unit_vector();</span>
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line">            <span class="hljs-comment">// Catch degenerate scatter direction</span></span>
<span class="line">            <span class="hljs-keyword">if</span> (scatter_direction.near_zero())</span>
<span class="line">                scatter_direction = rec.normal;</span></div><span class="line"></span>
<span class="line">            scattered = ray(rec.p, scatter_direction);</span>
<span class="line">            attenuation = albedo;</span>
<span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</span>
<span class="line">        }</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">public</span>:</span>
<span class="line">        color albedo;</span>
<span class="line">};</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_lambertian-catch-zero">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;46:</b> <kbd>[material.h]</kbd> Lambertian scatter, bullet-proof</div></center>
<p>

</p></div>

<p></p>
<a class="target" name="mirroredlightreflection">&nbsp;</a><a class="target" name="metal/mirroredlightreflection">&nbsp;</a><a class="target" name="toc9.4">&nbsp;</a><h2>Mirrored Light Reflection</h2>
<p>

</p><div class="together">
For smooth metals the ray won’t be randomly scattered. The key math is: how does a ray get
reflected from a metal mirror? Vector math is our friend here:

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/fig-1.11-reflection.jpg" target="_blank"><img class="markdeep" src="./Ray Tracing in One Weekend_files/fig-1.11-reflection.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_reflection">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;11:</b> Ray reflection</span></center></div></center>

<p></p><p>

</p></div>

<p></p><p>

</p><div class="together">
The reflected ray direction in red is just <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-91-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-906" style="width: 3.702em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.952em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1002.9em, 2.452em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-907"><span class="texatom" id="MathJax-Span-908"><span class="mrow" id="MathJax-Span-909"><span class="mi" id="MathJax-Span-910" style="font-family: MathJax_Main-bold;">v</span></span></span><span class="mo" id="MathJax-Span-911" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mn" id="MathJax-Span-912" style="font-family: MathJax_Main; padding-left: 0.202em;">2</span><span class="texatom" id="MathJax-Span-913"><span class="mrow" id="MathJax-Span-914"><span class="mi" id="MathJax-Span-915" style="font-family: MathJax_Main-bold;">b</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.184em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow><mo>+</mo><mn>2</mn><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-91">\mathbf{v} + 2\mathbf{b}</script>. In our design, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-92-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-916" style="width: 0.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.653em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.602em, 1000.65em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-917"><span class="texatom" id="MathJax-Span-918"><span class="mrow" id="MathJax-Span-919"><span class="mi" id="MathJax-Span-920" style="font-family: MathJax_Main-bold;">n</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-92">\mathbf{n}</script>
is a unit vector, but <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-93-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-921" style="width: 0.753em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.603em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.602em, 1000.55em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-922"><span class="texatom" id="MathJax-Span-923"><span class="mrow" id="MathJax-Span-924"><span class="mi" id="MathJax-Span-925" style="font-family: MathJax_Main-bold;">v</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-93">\mathbf{v}</script> may not be. The length of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-94-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-926" style="width: 0.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.653em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1000.6em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-927"><span class="texatom" id="MathJax-Span-928"><span class="mrow" id="MathJax-Span-929"><span class="mi" id="MathJax-Span-930" style="font-family: MathJax_Main-bold;">b</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-94">\mathbf{b}</script> should be <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-95-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-931" style="width: 2.452em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.952em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.702em, 1001.95em, 2.452em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-932"><span class="texatom" id="MathJax-Span-933"><span class="mrow" id="MathJax-Span-934"><span class="mi" id="MathJax-Span-935" style="font-family: MathJax_Main-bold;">v</span></span></span><span class="mo" id="MathJax-Span-936" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="texatom" id="MathJax-Span-937" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-938"><span class="mi" id="MathJax-Span-939" style="font-family: MathJax_Main-bold;">n</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow><mo>⋅</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-95">\mathbf{v}
\cdot \mathbf{n}</script>. Because <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-96-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-940" style="width: 0.753em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.603em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.602em, 1000.55em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-941"><span class="texatom" id="MathJax-Span-942"><span class="mrow" id="MathJax-Span-943"><span class="mi" id="MathJax-Span-944" style="font-family: MathJax_Main-bold;">v</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">v</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-96">\mathbf{v}</script> points in, we will need a minus sign, yielding:

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-function">vec3 <span class="hljs-title">reflect</span><span class="hljs-params">(<span class="hljs-keyword">const</span> vec3&amp; v, <span class="hljs-keyword">const</span> vec3&amp; n)</span> </span>{</span>
<span class="line">    <span class="hljs-keyword">return</span> v - <span class="hljs-number">2</span>*dot(v,n)*n;</span>
<span class="line">}</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_vec3-reflect">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;47:</b> <kbd>[vec3.h]</kbd> vec3 reflection function</div></center>
<p>

</p></div>

<p></p><p>

</p><div class="together">
The metal material just reflects rays using that formula:

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">metal</span> :</span> <span class="hljs-keyword">public</span> material {</span>
<span class="line">    <span class="hljs-keyword">public</span>:</span>
<span class="line">        metal(<span class="hljs-keyword">const</span> color&amp; a) : albedo(a) {}</span>
<span class="line"></span>
<span class="line">        <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">scatter</span><span class="hljs-params">(</span>
<span class="line">            <span class="hljs-keyword">const</span> ray&amp; r_in, <span class="hljs-keyword">const</span> hit_record&amp; rec, color&amp; attenuation, ray&amp; scattered</span>
<span class="line">        )</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{</span>
<span class="line">            vec3 reflected = reflect(unit_vector(r_in.direction()), rec.normal);</span>
<span class="line">            scattered = ray(rec.p, reflected);</span>
<span class="line">            attenuation = albedo;</span>
<span class="line">            <span class="hljs-keyword">return</span> (dot(scattered.direction(), rec.normal) &gt; <span class="hljs-number">0</span>);</span>
<span class="line">        }</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">public</span>:</span>
<span class="line">        color albedo;</span>
<span class="line">};</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_metal-material">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;48:</b> <kbd>[material.h]</kbd> Metal material with reflectance function</div></center>
<p>

</p></div>

<p></p><p>

</p><div class="together">
We need to modify the <code>ray_color()</code> function to use this:

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-function">color <span class="hljs-title">ray_color</span><span class="hljs-params">(<span class="hljs-keyword">const</span> ray&amp; r, <span class="hljs-keyword">const</span> hittable&amp; world, <span class="hljs-keyword">int</span> depth)</span> </span>{</span>
<span class="line">    hit_record rec;</span>
<span class="line"></span>
<span class="line">    <span class="hljs-comment">// If we've exceeded the ray bounce limit, no more light is gathered.</span></span>
<span class="line">    <span class="hljs-keyword">if</span> (depth &lt;= <span class="hljs-number">0</span>)</span>
<span class="line">        <span class="hljs-keyword">return</span> color(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">if</span> (world.hit(r, <span class="hljs-number">0.001</span>, infinity, rec)) {</span><div class=" highlight"><span class="line">        ray scattered;</span>
<span class="line">        color attenuation;</span>
<span class="line">        <span class="hljs-keyword">if</span> (rec.mat_ptr-&gt;scatter(r, rec, attenuation, scattered))</span>
<span class="line">            <span class="hljs-keyword">return</span> attenuation * ray_color(scattered, world, depth<span class="hljs-number">-1</span>);</span>
<span class="line">        <span class="hljs-keyword">return</span> color(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);</span></div><span class="line">    }</span>
<span class="line"></span>
<span class="line">    vec3 unit_direction = unit_vector(r.direction());</span>
<span class="line">    <span class="hljs-keyword">auto</span> t = <span class="hljs-number">0.5</span>*(unit_direction.y() + <span class="hljs-number">1.0</span>);</span>
<span class="line">    <span class="hljs-keyword">return</span> (<span class="hljs-number">1.0</span>-t)*color(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>) + t*color(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.7</span>, <span class="hljs-number">1.0</span>);</span>
<span class="line">}</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_ray-color-scatter">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;49:</b> <kbd>[main.cc]</kbd> Ray color with scattered reflectance</div></center>
<p>

</p></div>

<p></p>
<a class="target" name="ascenewithmetalspheres">&nbsp;</a><a class="target" name="metal/ascenewithmetalspheres">&nbsp;</a><a class="target" name="toc9.5">&nbsp;</a><h2>A Scene with Metal Spheres</h2>
<p>

</p><div class="together">
Now let’s add some metal spheres to our scene:

<p></p><pre class="listing tilde"><code><span class="line">...</span>
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"material.h"</span></span></span></div><span class="line"></span>
<span class="line">...</span>
<span class="line"></span>
<span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{</span>
<span class="line"></span>
<span class="line">    <span class="hljs-comment">// Image</span></span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> aspect_ratio = <span class="hljs-number">16.0</span> / <span class="hljs-number">9.0</span>;</span>
<span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> image_width = <span class="hljs-number">400</span>;</span>
<span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> image_height = <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">int</span>&gt;(image_width / aspect_ratio);</span>
<span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> samples_per_pixel = <span class="hljs-number">100</span>;</span>
<span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> max_depth = <span class="hljs-number">50</span>;</span>
<span class="line"></span>
<span class="line">    <span class="hljs-comment">// World</span></span>
<span class="line"></span>
<span class="line">    hittable_list world;</span>
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line">    <span class="hljs-keyword">auto</span> material_ground = make_shared&lt;lambertian&gt;(color(<span class="hljs-number">0.8</span>, <span class="hljs-number">0.8</span>, <span class="hljs-number">0.0</span>));</span>
<span class="line">    <span class="hljs-keyword">auto</span> material_center = make_shared&lt;lambertian&gt;(color(<span class="hljs-number">0.7</span>, <span class="hljs-number">0.3</span>, <span class="hljs-number">0.3</span>));</span>
<span class="line">    <span class="hljs-keyword">auto</span> material_left   = make_shared&lt;metal&gt;(color(<span class="hljs-number">0.8</span>, <span class="hljs-number">0.8</span>, <span class="hljs-number">0.8</span>));</span>
<span class="line">    <span class="hljs-keyword">auto</span> material_right  = make_shared&lt;metal&gt;(color(<span class="hljs-number">0.8</span>, <span class="hljs-number">0.6</span>, <span class="hljs-number">0.2</span>));</span>
<span class="line"></span>
<span class="line">    world.add(make_shared&lt;sphere&gt;(point3( <span class="hljs-number">0.0</span>, <span class="hljs-number">-100.5</span>, <span class="hljs-number">-1.0</span>), <span class="hljs-number">100.0</span>, material_ground));</span>
<span class="line">    world.add(make_shared&lt;sphere&gt;(point3( <span class="hljs-number">0.0</span>,    <span class="hljs-number">0.0</span>, <span class="hljs-number">-1.0</span>),   <span class="hljs-number">0.5</span>, material_center));</span>
<span class="line">    world.add(make_shared&lt;sphere&gt;(point3(<span class="hljs-number">-1.0</span>,    <span class="hljs-number">0.0</span>, <span class="hljs-number">-1.0</span>),   <span class="hljs-number">0.5</span>, material_left));</span>
<span class="line">    world.add(make_shared&lt;sphere&gt;(point3( <span class="hljs-number">1.0</span>,    <span class="hljs-number">0.0</span>, <span class="hljs-number">-1.0</span>),   <span class="hljs-number">0.5</span>, material_right));</span></div><span class="line"></span>
<span class="line">    <span class="hljs-comment">// Camera</span></span>
<span class="line"></span>
<span class="line">    camera cam;</span>
<span class="line"></span>
<span class="line">    <span class="hljs-comment">// Render</span></span>
<span class="line"></span>
<span class="line">    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"P3\n"</span> &lt;&lt; image_width &lt;&lt; <span class="hljs-string">" "</span> &lt;&lt; image_height &lt;&lt; <span class="hljs-string">"\n255\n"</span>;</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = image_height<span class="hljs-number">-1</span>; j &gt;= <span class="hljs-number">0</span>; --j) {</span>
<span class="line">        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"\rScanlines remaining: "</span> &lt;&lt; j &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; <span class="hljs-built_in">std</span>::flush;</span>
<span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; image_width; ++i) {</span>
<span class="line">            <span class="hljs-function">color <span class="hljs-title">pixel_color</span><span class="hljs-params">(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)</span></span>;</span>
<span class="line">            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> s = <span class="hljs-number">0</span>; s &lt; samples_per_pixel; ++s) {</span>
<span class="line">                <span class="hljs-keyword">auto</span> u = (i + random_double()) / (image_width<span class="hljs-number">-1</span>);</span>
<span class="line">                <span class="hljs-keyword">auto</span> v = (j + random_double()) / (image_height<span class="hljs-number">-1</span>);</span>
<span class="line">                ray r = cam.get_ray(u, v);</span>
<span class="line">                pixel_color += ray_color(r, world, max_depth);</span>
<span class="line">            }</span>
<span class="line">            write_color(<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span>, pixel_color, samples_per_pixel);</span>
<span class="line">        }</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cerr</span> &lt;&lt; <span class="hljs-string">"\nDone.\n"</span>;</span>
<span class="line">}</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_scene-with-metal">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;50:</b> <kbd>[main.cc]</kbd> Scene with metal spheres</div></center>
<p>

</p></div>

<p></p><p>

</p><div class="together">
Which gives:

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/img-1.11-metal-shiny.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing in One Weekend_files/img-1.11-metal-shiny.png"></a><center><span class="imagecaption">Image 11: Shiny metal</span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="fuzzyreflection">&nbsp;</a><a class="target" name="metal/fuzzyreflection">&nbsp;</a><a class="target" name="toc9.6">&nbsp;</a><h2>Fuzzy Reflection</h2>
<p>

</p><div class="together">
We can also randomize the reflected direction by using a small sphere and choosing a new endpoint
for the ray:

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/fig-1.12-reflect-fuzzy.jpg" target="_blank"><img class="markdeep" src="./Ray Tracing in One Weekend_files/fig-1.12-reflect-fuzzy.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_reflect-fuzzy">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;12:</b> Generating fuzzed reflection rays</span></center></div></center>

<p></p><p>

</p></div>

<p></p><p>

</p><div class="together">
The bigger the sphere, the fuzzier the reflections will be. This suggests adding a fuzziness
parameter that is just the radius of the sphere (so zero is no perturbation). The catch is that for
big spheres or grazing rays, we may scatter below the surface. We can just have the surface
absorb those.

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">metal</span> :</span> <span class="hljs-keyword">public</span> material {</span>
<span class="line">    <span class="hljs-keyword">public</span>:</span><div class=" highlight"><span class="line">        metal(<span class="hljs-keyword">const</span> color&amp; a, <span class="hljs-keyword">double</span> f) : albedo(a), fuzz(f &lt; <span class="hljs-number">1</span> ? f : <span class="hljs-number">1</span>) {}</span></div><span class="line"></span>
<span class="line">        <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">scatter</span><span class="hljs-params">(</span>
<span class="line">            <span class="hljs-keyword">const</span> ray&amp; r_in, <span class="hljs-keyword">const</span> hit_record&amp; rec, color&amp; attenuation, ray&amp; scattered</span>
<span class="line">        )</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{</span>
<span class="line">            vec3 reflected = reflect(unit_vector(r_in.direction()), rec.normal);</span><div class=" highlight"><span class="line">            scattered = ray(rec.p, reflected + fuzz*random_in_unit_sphere());</span></div><span class="line">            attenuation = albedo;</span>
<span class="line">            <span class="hljs-keyword">return</span> (dot(scattered.direction(), rec.normal) &gt; <span class="hljs-number">0</span>);</span>
<span class="line">        }</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">public</span>:</span>
<span class="line">        color albedo;</span><div class=" highlight"><span class="line">        <span class="hljs-keyword">double</span> fuzz;</span></div><span class="line">};</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_metal-fuzz">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;51:</b> <kbd>[material.h]</kbd> Metal material fuzziness</div></center>
<p>


</p></div>

<p></p><p>

We can try that out by adding fuzziness 0.3 and 1.0 to the metals:

</p><pre class="listing tilde"><code><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{</span>
<span class="line">    ...</span>
<span class="line">    <span class="hljs-comment">// World</span></span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">auto</span> material_ground = make_shared&lt;lambertian&gt;(color(<span class="hljs-number">0.8</span>, <span class="hljs-number">0.8</span>, <span class="hljs-number">0.0</span>));</span>
<span class="line">    <span class="hljs-keyword">auto</span> material_center = make_shared&lt;lambertian&gt;(color(<span class="hljs-number">0.7</span>, <span class="hljs-number">0.3</span>, <span class="hljs-number">0.3</span>));</span><div class=" highlight"><span class="line">    <span class="hljs-keyword">auto</span> material_left   = make_shared&lt;metal&gt;(color(<span class="hljs-number">0.8</span>, <span class="hljs-number">0.8</span>, <span class="hljs-number">0.8</span>), <span class="hljs-number">0.3</span>);</span>
<span class="line">    <span class="hljs-keyword">auto</span> material_right  = make_shared&lt;metal&gt;(color(<span class="hljs-number">0.8</span>, <span class="hljs-number">0.6</span>, <span class="hljs-number">0.2</span>), <span class="hljs-number">1.0</span>);</span></div><span class="line">    ...</span>
<span class="line">}</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_metal-fuzz-spheres">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;52:</b> <kbd>[main.cc]</kbd> Metal spheres with fuzziness</div></center>
<p>


  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/img-1.12-metal-fuzz.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing in One Weekend_files/img-1.12-metal-fuzz.png"></a><center><span class="imagecaption">Image 12: Fuzzed metal</span></center></div></center>

<p></p>
<a class="target" name="dielectrics">&nbsp;</a><a class="target" name="dielectrics">&nbsp;</a><a class="target" name="toc10">&nbsp;</a><h1>Dielectrics</h1>
<p>


Clear materials such as water, glass, and diamonds are dielectrics. When a light ray hits them, it
splits into a reflected ray and a refracted (transmitted) ray. We’ll handle that by randomly
choosing between reflection or refraction, and only generating one scattered ray per interaction.

</p>
<a class="target" name="refraction">&nbsp;</a><a class="target" name="dielectrics/refraction">&nbsp;</a><a class="target" name="toc10.1">&nbsp;</a><h2>Refraction</h2>
<p>

</p><div class="together">
The hardest part to debug is the refracted ray. I usually first just have all the light refract if
there is a refraction ray at all. For this project, I tried to put two glass balls in our scene, and
I got this (I have not told you how to do this right or wrong yet, but soon!):

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/img-1.13-glass-first.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing in One Weekend_files/img-1.13-glass-first.png"></a><center><span class="imagecaption">Image 13: Glass first</span></center></div></center>

<p></p><p>

</p></div>

<p></p><p>

Is that right? Glass balls look odd in real life. But no, it isn’t right. The world should be
flipped upside down and no weird black stuff. I just printed out the ray straight through the middle
of the image and it was clearly wrong. That often does the job.

</p>
<a class="target" name="snell&#39;slaw">&nbsp;</a><a class="target" name="dielectrics/snell&#39;slaw">&nbsp;</a><a class="target" name="toc10.2">&nbsp;</a><h2>Snell's Law</h2>
<p>

</p><div class="together">
The refraction is described by Snell’s law:

<p></p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-97-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;&amp;#x03B7;&lt;/mi&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B7;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-945" style="width: 10.103em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.053em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1008.05em, 2.652em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-946"><span class="mi" id="MathJax-Span-947" style="font-family: MathJax_Math-italic;">η<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-948" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mi" id="MathJax-Span-949" style="font-family: MathJax_Main; padding-left: 0.202em;">sin</span><span class="mo" id="MathJax-Span-950"></span><span class="mi" id="MathJax-Span-951" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">θ</span><span class="mo" id="MathJax-Span-952" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="msup" id="MathJax-Span-953" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.353em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-954" style="font-family: MathJax_Math-italic;">η<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.397em; left: 0.552em;"><span class="mo" id="MathJax-Span-955" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-956" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mi" id="MathJax-Span-957" style="font-family: MathJax_Main; padding-left: 0.202em;">sin</span><span class="mo" id="MathJax-Span-958"></span><span class="msup" id="MathJax-Span-959" style="padding-left: 0.152em;"><span style="display: inline-block; position: relative; width: 0.753em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.45em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-960" style="font-family: MathJax_Math-italic;">θ</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.397em; left: 0.453em;"><span class="mo" id="MathJax-Span-961" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>η</mi><mo>⋅</mo><mi>sin</mi><mo>⁡</mo><mi>θ</mi><mo>=</mo><msup><mi>η</mi><mo>′</mo></msup><mo>⋅</mo><mi>sin</mi><mo>⁡</mo><msup><mi>θ</mi><mo>′</mo></msup></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-97"> \eta \cdot \sin\theta = \eta' \cdot \sin\theta' </script>

</p><p>

Where <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-98-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-962" style="width: 0.603em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.453em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.052em, 1000.45em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-963"><span class="mi" id="MathJax-Span-964" style="font-family: MathJax_Math-italic;">θ</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>θ</mi></math></span></span><script type="math/tex" id="MathJax-Element-98">\theta</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-99-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-965" style="width: 0.953em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.753em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.102em, 1000.75em, 1.153em, -999.998em); top: -0.997em; left: 0em;"><span class="mrow" id="MathJax-Span-966"><span class="msup" id="MathJax-Span-967"><span style="display: inline-block; position: relative; width: 0.753em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.45em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-968" style="font-family: MathJax_Math-italic;">θ</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.348em; left: 0.453em;"><span class="mo" id="MathJax-Span-969" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.002em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.066em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>θ</mi><mo>′</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-99">\theta'</script> are the angles from the normal, and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-100-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B7;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-970" style="width: 0.653em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.503em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1000.5em, 2.252em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-971"><span class="mi" id="MathJax-Span-972" style="font-family: MathJax_Math-italic;">η<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>η</mi></math></span></span><script type="math/tex" id="MathJax-Element-100">\eta</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-101-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B7;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-973" style="width: 1.002em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.102em, 1000.8em, 1.353em, -999.998em); top: -0.997em; left: 0em;"><span class="mrow" id="MathJax-Span-974"><span class="msup" id="MathJax-Span-975"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.353em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-976" style="font-family: MathJax_Math-italic;">η<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.348em; left: 0.552em;"><span class="mo" id="MathJax-Span-977" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.002em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.316em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>η</mi><mo>′</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-101">\eta'</script> (pronounced
“eta” and “eta prime”) are the refractive indices (typically air = 1.0, glass = 1.3–1.7, diamond =
2.4). The geometry is:

</p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/fig-1.13-refraction.jpg" target="_blank"><img class="markdeep" src="./Ray Tracing in One Weekend_files/fig-1.13-refraction.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_refraction">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;13:</b> Ray refraction</span></center></div></center>

<p></p><p>

</p></div>

<p></p><p>

</p><div class="together">
In order to determine the direction of the refracted ray, we have to solve for <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-102-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-978" style="width: 2.702em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.152em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.403em, 1002.15em, 2.452em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-979"><span class="mi" id="MathJax-Span-980" style="font-family: MathJax_Main;">sin</span><span class="mo" id="MathJax-Span-981"></span><span class="msup" id="MathJax-Span-982" style="padding-left: 0.152em;"><span style="display: inline-block; position: relative; width: 0.753em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.45em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-983" style="font-family: MathJax_Math-italic;">θ</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.348em; left: 0.453em;"><span class="mo" id="MathJax-Span-984" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.066em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>sin</mi><mo>⁡</mo><msup><mi>θ</mi><mo>′</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-102">\sin\theta'</script>:

<p></p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-103-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mi&gt;&amp;#x03B7;&lt;/mi&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B7;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mfrac&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-985" style="width: 9.003em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.203em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.052em, 1007.2em, 3.353em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-986"><span class="mi" id="MathJax-Span-987" style="font-family: MathJax_Main;">sin</span><span class="mo" id="MathJax-Span-988"></span><span class="msup" id="MathJax-Span-989" style="padding-left: 0.152em;"><span style="display: inline-block; position: relative; width: 0.753em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.45em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-990" style="font-family: MathJax_Math-italic;">θ</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.397em; left: 0.453em;"><span class="mo" id="MathJax-Span-991" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-992" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mfrac" id="MathJax-Span-993" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 0.953em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.353em, -999.998em); top: -4.697em; left: 50%; margin-left: -0.247em;"><span class="mi" id="MathJax-Span-994" style="font-family: MathJax_Math-italic;">η<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.152em, 1000.8em, 4.353em, -999.998em); top: -3.298em; left: 50%; margin-left: -0.398em;"><span class="msup" id="MathJax-Span-995"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.353em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-996" style="font-family: MathJax_Math-italic;">η<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.298em; left: 0.552em;"><span class="mo" id="MathJax-Span-997" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(0.853em, 1000.95em, 1.203em, -999.998em); top: -1.248em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.953em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.052em;"></span></span></span></span><span class="mo" id="MathJax-Span-998" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mi" id="MathJax-Span-999" style="font-family: MathJax_Main; padding-left: 0.202em;">sin</span><span class="mo" id="MathJax-Span-1000"></span><span class="mi" id="MathJax-Span-1001" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">θ</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.184em; border-left: 0px solid; width: 0px; height: 2.628em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>sin</mi><mo>⁡</mo><msup><mi>θ</mi><mo>′</mo></msup><mo>=</mo><mfrac><mi>η</mi><msup><mi>η</mi><mo>′</mo></msup></mfrac><mo>⋅</mo><mi>sin</mi><mo>⁡</mo><mi>θ</mi></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-103"> \sin\theta' = \frac{\eta}{\eta'} \cdot \sin\theta </script>

</p><p>

On the refracted side of the surface there is a refracted ray <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-104-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;R&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1002" style="width: 1.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.153em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.102em, 1001.15em, 1.153em, -999.998em); top: -0.997em; left: 0em;"><span class="mrow" id="MathJax-Span-1003"><span class="texatom" id="MathJax-Span-1004"><span class="mrow" id="MathJax-Span-1005"><span class="msup" id="MathJax-Span-1006"><span style="display: inline-block; position: relative; width: 1.153em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.85em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-1007" style="font-family: MathJax_Main-bold;">R</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.348em; left: 0.853em;"><span class="mo" id="MathJax-Span-1008" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.002em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.066em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><msup><mi mathvariant="bold">R</mi><mo>′</mo></msup></mrow></math></span></span><script type="math/tex" id="MathJax-Element-104">\mathbf{R'}</script> and a normal
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-105-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1009" style="width: 1.153em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.903em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.102em, 1000.9em, 1.153em, -999.998em); top: -0.997em; left: 0em;"><span class="mrow" id="MathJax-Span-1010"><span class="texatom" id="MathJax-Span-1011"><span class="mrow" id="MathJax-Span-1012"><span class="msup" id="MathJax-Span-1013"><span style="display: inline-block; position: relative; width: 0.903em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.6em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-1014" style="font-family: MathJax_Main-bold;">n</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.348em; left: 0.653em;"><span class="mo" id="MathJax-Span-1015" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.002em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.066em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><msup><mi mathvariant="bold">n</mi><mo>′</mo></msup></mrow></math></span></span><script type="math/tex" id="MathJax-Element-105">\mathbf{n'}</script>, and there exists an angle, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-106-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1016" style="width: 0.953em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.753em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.102em, 1000.75em, 1.153em, -999.998em); top: -0.997em; left: 0em;"><span class="mrow" id="MathJax-Span-1017"><span class="msup" id="MathJax-Span-1018"><span style="display: inline-block; position: relative; width: 0.753em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.45em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-1019" style="font-family: MathJax_Math-italic;">θ</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.348em; left: 0.453em;"><span class="mo" id="MathJax-Span-1020" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.002em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.066em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>θ</mi><mo>′</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-106">\theta'</script>, between them. We can split <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-107-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;R&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1021" style="width: 1.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.153em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.102em, 1001.15em, 1.153em, -999.998em); top: -0.997em; left: 0em;"><span class="mrow" id="MathJax-Span-1022"><span class="texatom" id="MathJax-Span-1023"><span class="mrow" id="MathJax-Span-1024"><span class="msup" id="MathJax-Span-1025"><span style="display: inline-block; position: relative; width: 1.153em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.85em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-1026" style="font-family: MathJax_Main-bold;">R</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.348em; left: 0.853em;"><span class="mo" id="MathJax-Span-1027" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.002em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.066em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><msup><mi mathvariant="bold">R</mi><mo>′</mo></msup></mrow></math></span></span><script type="math/tex" id="MathJax-Element-107">\mathbf{R'}</script> into
the parts of the ray that are perpendicular to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-108-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1028" style="width: 1.153em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.903em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.102em, 1000.9em, 1.153em, -999.998em); top: -0.997em; left: 0em;"><span class="mrow" id="MathJax-Span-1029"><span class="texatom" id="MathJax-Span-1030"><span class="mrow" id="MathJax-Span-1031"><span class="msup" id="MathJax-Span-1032"><span style="display: inline-block; position: relative; width: 0.903em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.6em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-1033" style="font-family: MathJax_Main-bold;">n</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.348em; left: 0.653em;"><span class="mo" id="MathJax-Span-1034" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.002em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.066em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><msup><mi mathvariant="bold">n</mi><mo>′</mo></msup></mrow></math></span></span><script type="math/tex" id="MathJax-Element-108">\mathbf{n'}</script> and parallel to <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-109-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1035" style="width: 1.153em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.903em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.102em, 1000.9em, 1.153em, -999.998em); top: -0.997em; left: 0em;"><span class="mrow" id="MathJax-Span-1036"><span class="texatom" id="MathJax-Span-1037"><span class="mrow" id="MathJax-Span-1038"><span class="msup" id="MathJax-Span-1039"><span style="display: inline-block; position: relative; width: 0.903em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.6em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-1040" style="font-family: MathJax_Main-bold;">n</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.348em; left: 0.653em;"><span class="mo" id="MathJax-Span-1041" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.002em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.066em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><msup><mi mathvariant="bold">n</mi><mo>′</mo></msup></mrow></math></span></span><script type="math/tex" id="MathJax-Element-109">\mathbf{n'}</script>:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-110-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;R&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;R&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x22A5;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;R&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x2225;&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1042" style="width: 8.753em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.003em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1007em, 2.802em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-1043"><span class="texatom" id="MathJax-Span-1044"><span class="mrow" id="MathJax-Span-1045"><span class="msup" id="MathJax-Span-1046"><span style="display: inline-block; position: relative; width: 1.153em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.85em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-1047" style="font-family: MathJax_Main-bold;">R</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.397em; left: 0.853em;"><span class="mo" id="MathJax-Span-1048" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-1049" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="msubsup" id="MathJax-Span-1050" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 1.752em; height: 0px;"><span style="position: absolute; clip: rect(3.052em, 1001.15em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="texatom" id="MathJax-Span-1051"><span class="mrow" id="MathJax-Span-1052"><span class="msup" id="MathJax-Span-1053"><span style="display: inline-block; position: relative; width: 1.153em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.85em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-1054" style="font-family: MathJax_Main-bold;">R</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.397em; left: 0.853em;"><span class="mo" id="MathJax-Span-1055" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 1.153em;"><span class="texatom" id="MathJax-Span-1056"><span class="mrow" id="MathJax-Span-1057"><span class="mi" id="MathJax-Span-1058" style="font-size: 70.7%; font-family: MathJax_Main;">⊥</span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-1059" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="msubsup" id="MathJax-Span-1060" style="padding-left: 0.202em;"><span style="display: inline-block; position: relative; width: 1.552em; height: 0px;"><span style="position: absolute; clip: rect(3.052em, 1001.15em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="texatom" id="MathJax-Span-1061"><span class="mrow" id="MathJax-Span-1062"><span class="msup" id="MathJax-Span-1063"><span style="display: inline-block; position: relative; width: 1.153em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.85em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-1064" style="font-family: MathJax_Main-bold;">R</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.397em; left: 0.853em;"><span class="mo" id="MathJax-Span-1065" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.798em; left: 1.153em;"><span class="texatom" id="MathJax-Span-1066"><span class="mrow" id="MathJax-Span-1067"><span class="mo" id="MathJax-Span-1068" style="font-size: 70.7%; font-family: MathJax_Main;">∥</span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.497em; border-left: 0px solid; width: 0px; height: 1.566em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow class="MJX-TeXAtom-ORD"><msup><mi mathvariant="bold">R</mi><mo>′</mo></msup></mrow><mo>=</mo><msub><mrow class="MJX-TeXAtom-ORD"><msup><mi mathvariant="bold">R</mi><mo>′</mo></msup></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">⊥</mi></mrow></msub><mo>+</mo><msub><mrow class="MJX-TeXAtom-ORD"><msup><mi mathvariant="bold">R</mi><mo>′</mo></msup></mrow><mrow class="MJX-TeXAtom-ORD"><mo>∥</mo></mrow></msub></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-110"> \mathbf{R'} = \mathbf{R'}_{\bot} + \mathbf{R'}_{\parallel} </script>

</p><p>

If we solve for <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-111-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;R&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x22A5;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1069" style="width: 2.202em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.752em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.102em, 1001.75em, 1.302em, -999.998em); top: -0.997em; left: 0em;"><span class="mrow" id="MathJax-Span-1070"><span class="msubsup" id="MathJax-Span-1071"><span style="display: inline-block; position: relative; width: 1.752em; height: 0px;"><span style="position: absolute; clip: rect(3.103em, 1001.15em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="texatom" id="MathJax-Span-1072"><span class="mrow" id="MathJax-Span-1073"><span class="msup" id="MathJax-Span-1074"><span style="display: inline-block; position: relative; width: 1.153em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.85em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-1075" style="font-family: MathJax_Main-bold;">R</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.348em; left: 0.853em;"><span class="mo" id="MathJax-Span-1076" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 1.153em;"><span class="texatom" id="MathJax-Span-1077"><span class="mrow" id="MathJax-Span-1078"><span class="mi" id="MathJax-Span-1079" style="font-size: 70.7%; font-family: MathJax_Main;">⊥</span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.002em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mrow class="MJX-TeXAtom-ORD"><msup><mi mathvariant="bold">R</mi><mo>′</mo></msup></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">⊥</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-111">\mathbf{R'}_{\bot}</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-112-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;R&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x2225;&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1080" style="width: 1.952em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.552em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.102em, 1001.55em, 1.502em, -999.998em); top: -0.997em; left: 0em;"><span class="mrow" id="MathJax-Span-1081"><span class="msubsup" id="MathJax-Span-1082"><span style="display: inline-block; position: relative; width: 1.552em; height: 0px;"><span style="position: absolute; clip: rect(3.103em, 1001.15em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="texatom" id="MathJax-Span-1083"><span class="mrow" id="MathJax-Span-1084"><span class="msup" id="MathJax-Span-1085"><span style="display: inline-block; position: relative; width: 1.153em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.85em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-1086" style="font-family: MathJax_Main-bold;">R</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.348em; left: 0.853em;"><span class="mo" id="MathJax-Span-1087" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.798em; left: 1.153em;"><span class="texatom" id="MathJax-Span-1088"><span class="mrow" id="MathJax-Span-1089"><span class="mo" id="MathJax-Span-1090" style="font-size: 70.7%; font-family: MathJax_Main;">∥</span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.002em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.497em; border-left: 0px solid; width: 0px; height: 1.503em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mrow class="MJX-TeXAtom-ORD"><msup><mi mathvariant="bold">R</mi><mo>′</mo></msup></mrow><mrow class="MJX-TeXAtom-ORD"><mo>∥</mo></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-112">\mathbf{R'}_{\parallel}</script> we get:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-113-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;R&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x22A5;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mi&gt;&amp;#x03B7;&lt;/mi&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B7;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mfrac&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1091" style="width: 12.152em; display: inline-block;"><span style="display: inline-block; position: relative; width: 9.703em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.052em, 1009.6em, 3.353em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-1092"><span class="msubsup" id="MathJax-Span-1093"><span style="display: inline-block; position: relative; width: 1.752em; height: 0px;"><span style="position: absolute; clip: rect(3.052em, 1001.15em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="texatom" id="MathJax-Span-1094"><span class="mrow" id="MathJax-Span-1095"><span class="msup" id="MathJax-Span-1096"><span style="display: inline-block; position: relative; width: 1.153em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.85em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-1097" style="font-family: MathJax_Main-bold;">R</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.397em; left: 0.853em;"><span class="mo" id="MathJax-Span-1098" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 1.153em;"><span class="texatom" id="MathJax-Span-1099"><span class="mrow" id="MathJax-Span-1100"><span class="mi" id="MathJax-Span-1101" style="font-size: 70.7%; font-family: MathJax_Main;">⊥</span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-1102" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mfrac" id="MathJax-Span-1103" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 0.953em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.353em, -999.998em); top: -4.697em; left: 50%; margin-left: -0.247em;"><span class="mi" id="MathJax-Span-1104" style="font-family: MathJax_Math-italic;">η<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.152em, 1000.8em, 4.353em, -999.998em); top: -3.298em; left: 50%; margin-left: -0.398em;"><span class="msup" id="MathJax-Span-1105"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.353em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-1106" style="font-family: MathJax_Math-italic;">η<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.298em; left: 0.552em;"><span class="mo" id="MathJax-Span-1107" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(0.853em, 1000.95em, 1.203em, -999.998em); top: -1.248em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.953em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.052em;"></span></span></span></span><span class="mo" id="MathJax-Span-1108" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-1109"><span class="mrow" id="MathJax-Span-1110"><span class="mi" id="MathJax-Span-1111" style="font-family: MathJax_Main-bold;">R</span></span></span><span class="mo" id="MathJax-Span-1112" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mi" id="MathJax-Span-1113" style="font-family: MathJax_Main; padding-left: 0.202em;">cos</span><span class="mo" id="MathJax-Span-1114"></span><span class="mi" id="MathJax-Span-1115" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">θ</span><span class="texatom" id="MathJax-Span-1116"><span class="mrow" id="MathJax-Span-1117"><span class="mi" id="MathJax-Span-1118" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-1119" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.184em; border-left: 0px solid; width: 0px; height: 2.628em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mrow class="MJX-TeXAtom-ORD"><msup><mi mathvariant="bold">R</mi><mo>′</mo></msup></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">⊥</mi></mrow></msub><mo>=</mo><mfrac><mi>η</mi><msup><mi>η</mi><mo>′</mo></msup></mfrac><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">R</mi></mrow><mo>+</mo><mi>cos</mi><mo>⁡</mo><mi>θ</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-113"> \mathbf{R'}_{\bot} = \frac{\eta}{\eta'} (\mathbf{R} + \cos\theta \mathbf{n}) </script>
  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-114-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;R&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x2225;&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msqrt&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;R&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x22A5;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;msup&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/msqrt&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1120" style="width: 12.203em; display: inline-block;"><span style="display: inline-block; position: relative; width: 9.753em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.802em, 1009.75em, 2.902em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1121"><span class="msubsup" id="MathJax-Span-1122"><span style="display: inline-block; position: relative; width: 1.552em; height: 0px;"><span style="position: absolute; clip: rect(3.052em, 1001.15em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="texatom" id="MathJax-Span-1123"><span class="mrow" id="MathJax-Span-1124"><span class="msup" id="MathJax-Span-1125"><span style="display: inline-block; position: relative; width: 1.153em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.85em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-1126" style="font-family: MathJax_Main-bold;">R</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.397em; left: 0.853em;"><span class="mo" id="MathJax-Span-1127" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.798em; left: 1.153em;"><span class="texatom" id="MathJax-Span-1128"><span class="mrow" id="MathJax-Span-1129"><span class="mo" id="MathJax-Span-1130" style="font-size: 70.7%; font-family: MathJax_Main;">∥</span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-1131" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mo" id="MathJax-Span-1132" style="font-family: MathJax_Main; padding-left: 0.302em;">−</span><span class="msqrt" id="MathJax-Span-1133"><span style="display: inline-block; position: relative; width: 5.402em; height: 0px;"><span style="position: absolute; clip: rect(2.902em, 1004.4em, 4.402em, -999.998em); top: -3.998em; left: 1.002em;"><span class="mrow" id="MathJax-Span-1134"><span class="mn" id="MathJax-Span-1135" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-1136" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="texatom" id="MathJax-Span-1137" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1138"><span class="mo" id="MathJax-Span-1139" style="font-family: MathJax_Main;">|</span></span></span><span class="msubsup" id="MathJax-Span-1140"><span style="display: inline-block; position: relative; width: 1.752em; height: 0px;"><span style="position: absolute; clip: rect(3.052em, 1001.15em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="texatom" id="MathJax-Span-1141"><span class="mrow" id="MathJax-Span-1142"><span class="msup" id="MathJax-Span-1143"><span style="display: inline-block; position: relative; width: 1.153em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.85em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-1144" style="font-family: MathJax_Main-bold;">R</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.397em; left: 0.853em;"><span class="mo" id="MathJax-Span-1145" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 1.153em;"><span class="texatom" id="MathJax-Span-1146"><span class="mrow" id="MathJax-Span-1147"><span class="mi" id="MathJax-Span-1148" style="font-size: 70.7%; font-family: MathJax_Main;">⊥</span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-1149"><span style="display: inline-block; position: relative; width: 0.703em; height: 0px;"><span style="position: absolute; clip: rect(3.103em, 1000.15em, 4.402em, -999.998em); top: -3.998em; left: 0em;"><span class="texatom" id="MathJax-Span-1150"><span class="mrow" id="MathJax-Span-1151"><span class="mo" id="MathJax-Span-1152" style="font-family: MathJax_Main;">|</span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.498em; left: 0.302em;"><span class="mn" id="MathJax-Span-1153" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.603em, 1004.35em, 3.902em, -999.998em); top: -4.947em; left: 1.002em;"><span style="display: inline-block; position: relative; width: 4.353em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.998em; left: -0.098em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.998em; left: 3.652em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 0.453em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 1.002em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 1.552em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 2.103em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 2.652em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 3.202em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(2.702em, 1001em, 4.803em, -999.998em); top: -4.098em; left: 0em;"><span style="font-family: MathJax_Size2;">√</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="texatom" id="MathJax-Span-1154"><span class="mrow" id="MathJax-Span-1155"><span class="mi" id="MathJax-Span-1156" style="font-family: MathJax_Main-bold;">n</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.747em; border-left: 0px solid; width: 0px; height: 2.378em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mrow class="MJX-TeXAtom-ORD"><msup><mi mathvariant="bold">R</mi><mo>′</mo></msup></mrow><mrow class="MJX-TeXAtom-ORD"><mo>∥</mo></mrow></msub><mo>=</mo><mo>−</mo><msqrt><mn>1</mn><mo>−</mo><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msub><mrow class="MJX-TeXAtom-ORD"><msup><mi mathvariant="bold">R</mi><mo>′</mo></msup></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">⊥</mi></mrow></msub><msup><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mn>2</mn></msup></msqrt><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-114"> \mathbf{R'}_{\parallel} = -\sqrt{1 - |\mathbf{R'}_{\bot}|^2} \mathbf{n} </script>

</p><p>

You can go ahead and prove this for yourself if you want, but we will treat it as fact and move on.
The rest of the book will not require you to understand the proof.

</p><p>

We still need to solve for <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-115-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1157" style="width: 2.452em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.952em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.302em, 1001.95em, 2.302em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-1158"><span class="mi" id="MathJax-Span-1159" style="font-family: MathJax_Main;">cos</span><span class="mo" id="MathJax-Span-1160"></span><span class="mi" id="MathJax-Span-1161" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">θ</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>cos</mi><mo>⁡</mo><mi>θ</mi></math></span></span><script type="math/tex" id="MathJax-Element-115">\cos\theta</script>. It is well known that the dot product of two vectors can
be explained in terms of the cosine of the angle between them:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-116-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1162" style="width: 9.652em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.703em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.403em, 1007.7em, 2.702em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-1163"><span class="texatom" id="MathJax-Span-1164"><span class="mrow" id="MathJax-Span-1165"><span class="mi" id="MathJax-Span-1166" style="font-family: MathJax_Main-bold;">a</span></span></span><span class="mo" id="MathJax-Span-1167" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="texatom" id="MathJax-Span-1168" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1169"><span class="mi" id="MathJax-Span-1170" style="font-family: MathJax_Main-bold;">b</span></span></span><span class="mo" id="MathJax-Span-1171" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="texatom" id="MathJax-Span-1172" style="padding-left: 0.302em;"><span class="mrow" id="MathJax-Span-1173"><span class="mo" id="MathJax-Span-1174" style="font-family: MathJax_Main;">|</span></span></span><span class="texatom" id="MathJax-Span-1175"><span class="mrow" id="MathJax-Span-1176"><span class="mi" id="MathJax-Span-1177" style="font-family: MathJax_Main-bold;">a</span></span></span><span class="texatom" id="MathJax-Span-1178"><span class="mrow" id="MathJax-Span-1179"><span class="mo" id="MathJax-Span-1180" style="font-family: MathJax_Main;">|</span></span></span><span class="texatom" id="MathJax-Span-1181"><span class="mrow" id="MathJax-Span-1182"><span class="mo" id="MathJax-Span-1183" style="font-family: MathJax_Main;">|</span></span></span><span class="texatom" id="MathJax-Span-1184"><span class="mrow" id="MathJax-Span-1185"><span class="mi" id="MathJax-Span-1186" style="font-family: MathJax_Main-bold;">b</span></span></span><span class="texatom" id="MathJax-Span-1187"><span class="mrow" id="MathJax-Span-1188"><span class="mo" id="MathJax-Span-1189" style="font-family: MathJax_Main;">|</span></span></span><span class="mi" id="MathJax-Span-1190" style="font-family: MathJax_Main; padding-left: 0.152em;">cos</span><span class="mo" id="MathJax-Span-1191"></span><span class="mi" id="MathJax-Span-1192" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">θ</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">a</mi></mrow><mo>⋅</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow><mo>=</mo><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">a</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>cos</mi><mo>⁡</mo><mi>θ</mi></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-116"> \mathbf{a} \cdot \mathbf{b} = |\mathbf{a}| |\mathbf{b}| \cos\theta </script>

</p><p>

If we restrict <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-117-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1193" style="width: 0.703em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.552em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.602em, 1000.55em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1194"><span class="texatom" id="MathJax-Span-1195"><span class="mrow" id="MathJax-Span-1196"><span class="mi" id="MathJax-Span-1197" style="font-family: MathJax_Main-bold;">a</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">a</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-117">\mathbf{a}</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-118-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1198" style="width: 0.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.653em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1000.6em, 2.353em, -999.998em); top: -2.198em; left: 0em;"><span class="mrow" id="MathJax-Span-1199"><span class="texatom" id="MathJax-Span-1200"><span class="mrow" id="MathJax-Span-1201"><span class="mi" id="MathJax-Span-1202" style="font-family: MathJax_Main-bold;">b</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.202em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-118">\mathbf{b}</script> to be unit vectors:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-119-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;b&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1203" style="width: 6.503em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.202em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.453em, 1005.2em, 2.452em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-1204"><span class="texatom" id="MathJax-Span-1205"><span class="mrow" id="MathJax-Span-1206"><span class="mi" id="MathJax-Span-1207" style="font-family: MathJax_Main-bold;">a</span></span></span><span class="mo" id="MathJax-Span-1208" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="texatom" id="MathJax-Span-1209" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1210"><span class="mi" id="MathJax-Span-1211" style="font-family: MathJax_Main-bold;">b</span></span></span><span class="mo" id="MathJax-Span-1212" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mi" id="MathJax-Span-1213" style="font-family: MathJax_Main; padding-left: 0.302em;">cos</span><span class="mo" id="MathJax-Span-1214"></span><span class="mi" id="MathJax-Span-1215" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">θ</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">a</mi></mrow><mo>⋅</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">b</mi></mrow><mo>=</mo><mi>cos</mi><mo>⁡</mo><mi>θ</mi></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-119"> \mathbf{a} \cdot \mathbf{b} = \cos\theta </script>

</p><p>

We can now rewrite <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-120-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;R&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x22A5;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1216" style="width: 2.202em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.752em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.102em, 1001.75em, 1.302em, -999.998em); top: -0.997em; left: 0em;"><span class="mrow" id="MathJax-Span-1217"><span class="msubsup" id="MathJax-Span-1218"><span style="display: inline-block; position: relative; width: 1.752em; height: 0px;"><span style="position: absolute; clip: rect(3.103em, 1001.15em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="texatom" id="MathJax-Span-1219"><span class="mrow" id="MathJax-Span-1220"><span class="msup" id="MathJax-Span-1221"><span style="display: inline-block; position: relative; width: 1.153em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.85em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-1222" style="font-family: MathJax_Main-bold;">R</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.348em; left: 0.853em;"><span class="mo" id="MathJax-Span-1223" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 1.153em;"><span class="texatom" id="MathJax-Span-1224"><span class="mrow" id="MathJax-Span-1225"><span class="mi" id="MathJax-Span-1226" style="font-size: 70.7%; font-family: MathJax_Main;">⊥</span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.002em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mrow class="MJX-TeXAtom-ORD"><msup><mi mathvariant="bold">R</mi><mo>′</mo></msup></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">⊥</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-120">\mathbf{R'}_{\bot}</script> in terms of known quantities:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-121-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;R&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x22A5;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mi&gt;&amp;#x03B7;&lt;/mi&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B7;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mfrac&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo mathvariant=&quot;bold&quot;&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1227" style="width: 14.503em; display: inline-block;"><span style="display: inline-block; position: relative; width: 11.603em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.052em, 1011.5em, 3.353em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-1228"><span class="msubsup" id="MathJax-Span-1229"><span style="display: inline-block; position: relative; width: 1.752em; height: 0px;"><span style="position: absolute; clip: rect(3.052em, 1001.15em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="texatom" id="MathJax-Span-1230"><span class="mrow" id="MathJax-Span-1231"><span class="msup" id="MathJax-Span-1232"><span style="display: inline-block; position: relative; width: 1.153em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.85em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-1233" style="font-family: MathJax_Main-bold;">R</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.397em; left: 0.853em;"><span class="mo" id="MathJax-Span-1234" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -3.848em; left: 1.153em;"><span class="texatom" id="MathJax-Span-1235"><span class="mrow" id="MathJax-Span-1236"><span class="mi" id="MathJax-Span-1237" style="font-size: 70.7%; font-family: MathJax_Main;">⊥</span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-1238" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mfrac" id="MathJax-Span-1239" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 0.953em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.353em, -999.998em); top: -4.697em; left: 50%; margin-left: -0.247em;"><span class="mi" id="MathJax-Span-1240" style="font-family: MathJax_Math-italic;">η<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.152em, 1000.8em, 4.353em, -999.998em); top: -3.298em; left: 50%; margin-left: -0.398em;"><span class="msup" id="MathJax-Span-1241"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.353em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-1242" style="font-family: MathJax_Math-italic;">η<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.298em; left: 0.552em;"><span class="mo" id="MathJax-Span-1243" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(0.853em, 1000.95em, 1.203em, -999.998em); top: -1.248em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.953em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.052em;"></span></span></span></span><span class="mo" id="MathJax-Span-1244" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-1245"><span class="mrow" id="MathJax-Span-1246"><span class="mi" id="MathJax-Span-1247" style="font-family: MathJax_Main-bold;">R</span></span></span><span class="mo" id="MathJax-Span-1248" style="font-family: MathJax_Main; padding-left: 0.202em;">+</span><span class="mo" id="MathJax-Span-1249" style="font-family: MathJax_Main; padding-left: 0.202em;">(</span><span class="texatom" id="MathJax-Span-1250"><span class="mrow" id="MathJax-Span-1251"><span class="mo" id="MathJax-Span-1252" style="font-family: MathJax_Main-bold;">−</span><span class="mi" id="MathJax-Span-1253" style="font-family: MathJax_Main-bold;">R</span></span></span><span class="mo" id="MathJax-Span-1254" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="texatom" id="MathJax-Span-1255" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1256"><span class="mi" id="MathJax-Span-1257" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-1258" style="font-family: MathJax_Main;">)</span><span class="texatom" id="MathJax-Span-1259"><span class="mrow" id="MathJax-Span-1260"><span class="mi" id="MathJax-Span-1261" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-1262" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.184em; border-left: 0px solid; width: 0px; height: 2.628em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mrow class="MJX-TeXAtom-ORD"><msup><mi mathvariant="bold">R</mi><mo>′</mo></msup></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">⊥</mi></mrow></msub><mo>=</mo><mfrac><mi>η</mi><msup><mi>η</mi><mo>′</mo></msup></mfrac><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">R</mi></mrow><mo>+</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mo mathvariant="bold">−</mo><mi mathvariant="bold">R</mi></mrow><mo>⋅</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo stretchy="false">)</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-121"> \mathbf{R'}_{\bot} =
     \frac{\eta}{\eta'} (\mathbf{R} + (\mathbf{-R} \cdot \mathbf{n}) \mathbf{n}) </script>

</p><p>

When we combine them back together, we can write a function to calculate <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-122-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msup&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;R&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1263" style="width: 1.453em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.153em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.102em, 1001.15em, 1.153em, -999.998em); top: -0.997em; left: 0em;"><span class="mrow" id="MathJax-Span-1264"><span class="texatom" id="MathJax-Span-1265"><span class="mrow" id="MathJax-Span-1266"><span class="msup" id="MathJax-Span-1267"><span style="display: inline-block; position: relative; width: 1.153em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.85em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-1268" style="font-family: MathJax_Main-bold;">R</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.348em; left: 0.853em;"><span class="mo" id="MathJax-Span-1269" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 1.002em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.066em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><msup><mi mathvariant="bold">R</mi><mo>′</mo></msup></mrow></math></span></span><script type="math/tex" id="MathJax-Element-122">\mathbf{R'}</script>:

</p><pre class="listing tilde"><code><span class="line"><span class="hljs-function">vec3 <span class="hljs-title">refract</span><span class="hljs-params">(<span class="hljs-keyword">const</span> vec3&amp; uv, <span class="hljs-keyword">const</span> vec3&amp; n, <span class="hljs-keyword">double</span> etai_over_etat)</span> </span>{</span>
<span class="line">    <span class="hljs-keyword">auto</span> cos_theta = fmin(dot(-uv, n), <span class="hljs-number">1.0</span>);</span>
<span class="line">    vec3 r_out_perp =  etai_over_etat * (uv + cos_theta*n);</span>
<span class="line">    vec3 r_out_parallel = -<span class="hljs-built_in">sqrt</span>(<span class="hljs-built_in">fabs</span>(<span class="hljs-number">1.0</span> - r_out_perp.length_squared())) * n;</span>
<span class="line">    <span class="hljs-keyword">return</span> r_out_perp + r_out_parallel;</span>
<span class="line">}</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_refract">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;53:</b> <kbd>[vec3.h]</kbd> Refraction function</div></center>
<p>

</p></div>

<p></p><p>

</p><div class="together">
And the dielectric material that always refracts is:

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">dielectric</span> :</span> <span class="hljs-keyword">public</span> material {</span>
<span class="line">    <span class="hljs-keyword">public</span>:</span>
<span class="line">        dielectric(<span class="hljs-keyword">double</span> index_of_refraction) : ir(index_of_refraction) {}</span>
<span class="line"></span>
<span class="line">        <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">scatter</span><span class="hljs-params">(</span>
<span class="line">            <span class="hljs-keyword">const</span> ray&amp; r_in, <span class="hljs-keyword">const</span> hit_record&amp; rec, color&amp; attenuation, ray&amp; scattered</span>
<span class="line">        )</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{</span>
<span class="line">            attenuation = color(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>);</span>
<span class="line">            <span class="hljs-keyword">double</span> refraction_ratio = rec.front_face ? (<span class="hljs-number">1.0</span>/ir) : ir;</span>
<span class="line"></span>
<span class="line">            vec3 unit_direction = unit_vector(r_in.direction());</span>
<span class="line">            vec3 refracted = refract(unit_direction, rec.normal, refraction_ratio);</span>
<span class="line"></span>
<span class="line">            scattered = ray(rec.p, refracted);</span>
<span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</span>
<span class="line">        }</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">public</span>:</span>
<span class="line">        <span class="hljs-keyword">double</span> ir; <span class="hljs-comment">// Index of Refraction</span></span>
<span class="line">};</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_dielectric">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;54:</b> <kbd>[material.h]</kbd> Dielectric material class that always refracts</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
Now we'll update the scene to change the left and center spheres to glass:

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-keyword">auto</span> material_ground = make_shared&lt;lambertian&gt;(color(<span class="hljs-number">0.8</span>, <span class="hljs-number">0.8</span>, <span class="hljs-number">0.0</span>));</span><div class=" highlight"><span class="line"><span class="hljs-keyword">auto</span> material_center = make_shared&lt;dielectric&gt;(<span class="hljs-number">1.5</span>);</span>
<span class="line"><span class="hljs-keyword">auto</span> material_left   = make_shared&lt;dielectric&gt;(<span class="hljs-number">1.5</span>);</span></div><span class="line"><span class="hljs-keyword">auto</span> material_right  = make_shared&lt;metal&gt;(color(<span class="hljs-number">0.8</span>, <span class="hljs-number">0.6</span>, <span class="hljs-number">0.2</span>), <span class="hljs-number">1.0</span>);</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_two-glass">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;55:</b> <kbd>[main.cc]</kbd> Changing left and center spheres to glass</div></center>
<p>


</p></div>

<p></p><p>

This gives us the following result:

</p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/img-1.14-glass-always-refract.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing in One Weekend_files/img-1.14-glass-always-refract.png"></a><center><span class="imagecaption">Image 14: Glass sphere that always refracts
  </span></center></div></center>

<p></p>
<a class="target" name="totalinternalreflection">&nbsp;</a><a class="target" name="dielectrics/totalinternalreflection">&nbsp;</a><a class="target" name="toc10.3">&nbsp;</a><h2>Total Internal Reflection</h2>
<p>

That definitely doesn't look right. One troublesome practical issue is that when the ray is in the
material with the higher refractive index, there is no real solution to Snell’s law, and thus there
is no refraction possible. If we refer back to Snell's law and the derivation of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-123-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1270" style="width: 2.702em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.152em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.403em, 1002.15em, 2.452em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-1271"><span class="mi" id="MathJax-Span-1272" style="font-family: MathJax_Main;">sin</span><span class="mo" id="MathJax-Span-1273"></span><span class="msup" id="MathJax-Span-1274" style="padding-left: 0.152em;"><span style="display: inline-block; position: relative; width: 0.753em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.45em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-1275" style="font-family: MathJax_Math-italic;">θ</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.348em; left: 0.453em;"><span class="mo" id="MathJax-Span-1276" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.066em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>sin</mi><mo>⁡</mo><msup><mi>θ</mi><mo>′</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-123">\sin\theta'</script>:

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-124-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mi&gt;&amp;#x03B7;&lt;/mi&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B7;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/mfrac&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1277" style="width: 9.003em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.203em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.052em, 1007.2em, 3.353em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-1278"><span class="mi" id="MathJax-Span-1279" style="font-family: MathJax_Main;">sin</span><span class="mo" id="MathJax-Span-1280"></span><span class="msup" id="MathJax-Span-1281" style="padding-left: 0.152em;"><span style="display: inline-block; position: relative; width: 0.753em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.45em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-1282" style="font-family: MathJax_Math-italic;">θ</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.397em; left: 0.453em;"><span class="mo" id="MathJax-Span-1283" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-1284" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mfrac" id="MathJax-Span-1285" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 0.953em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.353em, -999.998em); top: -4.697em; left: 50%; margin-left: -0.247em;"><span class="mi" id="MathJax-Span-1286" style="font-family: MathJax_Math-italic;">η<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.152em, 1000.8em, 4.353em, -999.998em); top: -3.298em; left: 50%; margin-left: -0.398em;"><span class="msup" id="MathJax-Span-1287"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.353em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-1288" style="font-family: MathJax_Math-italic;">η<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.298em; left: 0.552em;"><span class="mo" id="MathJax-Span-1289" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(0.853em, 1000.95em, 1.203em, -999.998em); top: -1.248em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.953em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.052em;"></span></span></span></span><span class="mo" id="MathJax-Span-1290" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mi" id="MathJax-Span-1291" style="font-family: MathJax_Main; padding-left: 0.202em;">sin</span><span class="mo" id="MathJax-Span-1292"></span><span class="mi" id="MathJax-Span-1293" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">θ</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.184em; border-left: 0px solid; width: 0px; height: 2.628em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>sin</mi><mo>⁡</mo><msup><mi>θ</mi><mo>′</mo></msup><mo>=</mo><mfrac><mi>η</mi><msup><mi>η</mi><mo>′</mo></msup></mfrac><mo>⋅</mo><mi>sin</mi><mo>⁡</mo><mi>θ</mi></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-124"> \sin\theta' = \frac{\eta}{\eta'} \cdot \sin\theta </script>

</p><p>

If the ray is inside glass and outside is air (<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-125-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B7;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1.5&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1294" style="width: 3.952em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.152em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1003.1em, 2.502em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-1295"><span class="mi" id="MathJax-Span-1296" style="font-family: MathJax_Math-italic;">η<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1297" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mn" id="MathJax-Span-1298" style="font-family: MathJax_Main; padding-left: 0.302em;">1.5</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>η</mi><mo>=</mo><mn>1.5</mn></math></span></span><script type="math/tex" id="MathJax-Element-125">\eta = 1.5</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-126-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B7;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1.0&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1299" style="width: 4.353em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.452em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1003.4em, 2.502em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-1300"><span class="msup" id="MathJax-Span-1301"><span style="display: inline-block; position: relative; width: 0.802em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1000.5em, 4.353em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-1302" style="font-family: MathJax_Math-italic;">η<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.348em; left: 0.552em;"><span class="mo" id="MathJax-Span-1303" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-1304" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mn" id="MathJax-Span-1305" style="font-family: MathJax_Main; padding-left: 0.302em;">1.0</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.316em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>η</mi><mo>′</mo></msup><mo>=</mo><mn>1.0</mn></math></span></span><script type="math/tex" id="MathJax-Element-126">\eta' = 1.0</script>):

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-127-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mn&gt;1.5&lt;/mn&gt;&lt;mn&gt;1.0&lt;/mn&gt;&lt;/mfrac&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1306" style="width: 9.603em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.653em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.802em, 1007.65em, 3.152em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-1307"><span class="mi" id="MathJax-Span-1308" style="font-family: MathJax_Main;">sin</span><span class="mo" id="MathJax-Span-1309"></span><span class="msup" id="MathJax-Span-1310" style="padding-left: 0.152em;"><span style="display: inline-block; position: relative; width: 0.753em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.45em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-1311" style="font-family: MathJax_Math-italic;">θ</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.397em; left: 0.453em;"><span class="mo" id="MathJax-Span-1312" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-1313" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mfrac" id="MathJax-Span-1314" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 1.403em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.202em, 1001.25em, 4.152em, -999.998em); top: -4.697em; left: 50%; margin-left: -0.647em;"><span class="mn" id="MathJax-Span-1315" style="font-family: MathJax_Main;">1.5</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.202em, 1001.25em, 4.152em, -999.998em); top: -3.298em; left: 50%; margin-left: -0.647em;"><span class="mn" id="MathJax-Span-1316" style="font-family: MathJax_Main;">1.0</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(0.853em, 1001.4em, 1.203em, -999.998em); top: -1.248em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.403em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.052em;"></span></span></span></span><span class="mo" id="MathJax-Span-1317" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mi" id="MathJax-Span-1318" style="font-family: MathJax_Main; padding-left: 0.202em;">sin</span><span class="mo" id="MathJax-Span-1319"></span><span class="mi" id="MathJax-Span-1320" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">θ</span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.934em; border-left: 0px solid; width: 0px; height: 2.691em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>sin</mi><mo>⁡</mo><msup><mi>θ</mi><mo>′</mo></msup><mo>=</mo><mfrac><mn>1.5</mn><mn>1.0</mn></mfrac><mo>⋅</mo><mi>sin</mi><mo>⁡</mo><mi>θ</mi></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-127"> \sin\theta' = \frac{1.5}{1.0} \cdot \sin\theta </script>

</p><p>

The value of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-128-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1321" style="width: 2.702em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.152em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.403em, 1002.15em, 2.452em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-1322"><span class="mi" id="MathJax-Span-1323" style="font-family: MathJax_Main;">sin</span><span class="mo" id="MathJax-Span-1324"></span><span class="msup" id="MathJax-Span-1325" style="padding-left: 0.152em;"><span style="display: inline-block; position: relative; width: 0.753em; height: 0px;"><span style="position: absolute; clip: rect(3.152em, 1000.45em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-1326" style="font-family: MathJax_Math-italic;">θ</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.348em; left: 0.453em;"><span class="mo" id="MathJax-Span-1327" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.066em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>sin</mi><mo>⁡</mo><msup><mi>θ</mi><mo>′</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-128">\sin\theta'</script> cannot be greater than 1. So, if,

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-129-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mfrac&gt;&lt;mn&gt;1.5&lt;/mn&gt;&lt;mn&gt;1.0&lt;/mn&gt;&lt;/mfrac&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;&amp;gt;&lt;/mo&gt;&lt;mn&gt;1.0&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1328" style="width: 8.503em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.803em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(0.653em, 1006.75em, 3.002em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-1329"><span class="mfrac" id="MathJax-Span-1330"><span style="display: inline-block; position: relative; width: 1.403em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.202em, 1001.25em, 4.152em, -999.998em); top: -4.697em; left: 50%; margin-left: -0.647em;"><span class="mn" id="MathJax-Span-1331" style="font-family: MathJax_Main;">1.5</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.202em, 1001.25em, 4.152em, -999.998em); top: -3.298em; left: 50%; margin-left: -0.647em;"><span class="mn" id="MathJax-Span-1332" style="font-family: MathJax_Main;">1.0</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(0.853em, 1001.4em, 1.203em, -999.998em); top: -1.248em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.403em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.052em;"></span></span></span></span><span class="mo" id="MathJax-Span-1333" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="mi" id="MathJax-Span-1334" style="font-family: MathJax_Main; padding-left: 0.202em;">sin</span><span class="mo" id="MathJax-Span-1335"></span><span class="mi" id="MathJax-Span-1336" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">θ</span><span class="mo" id="MathJax-Span-1337" style="font-family: MathJax_Main; padding-left: 0.302em;">&gt;</span><span class="mn" id="MathJax-Span-1338" style="font-family: MathJax_Main; padding-left: 0.302em;">1.0</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.934em; border-left: 0px solid; width: 0px; height: 2.691em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mfrac><mn>1.5</mn><mn>1.0</mn></mfrac><mo>⋅</mo><mi>sin</mi><mo>⁡</mo><mi>θ</mi><mo>&gt;</mo><mn>1.0</mn></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-129"> \frac{1.5}{1.0} \cdot \sin\theta > 1.0 </script>,

</p><p>

</p><div class="together">
the equality between the two sides of the equation is broken, and a solution cannot exist. If a
solution does not exist, the glass cannot refract, and therefore must reflect the ray:

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-keyword">if</span> (refraction_ratio * sin_theta &gt; <span class="hljs-number">1.0</span>) {</span>
<span class="line">    <span class="hljs-comment">// Must Reflect</span></span>
<span class="line">    ...</span>
<span class="line">} <span class="hljs-keyword">else</span> {</span>
<span class="line">    <span class="hljs-comment">// Can Refract</span></span>
<span class="line">    ...</span>
<span class="line">}</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_dielectric">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;56:</b> <kbd>[material.h]</kbd> Determining if the ray can refract</div></center>
<p>


</p></div>

<p></p><p>

Here all the light is reflected, and because in practice that is usually inside solid objects, it
is called “total internal reflection”. This is why sometimes the water-air boundary acts as a
perfect mirror when you are submerged.

</p><p>

</p><div class="together">
We can solve for <code>sin_theta</code> using the trigonometric qualities:

<p></p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-130-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;sin&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msqrt&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/msqrt&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1339" style="width: 10.402em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.303em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.153em, 1008.3em, 2.652em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-1340"><span class="mi" id="MathJax-Span-1341" style="font-family: MathJax_Main;">sin</span><span class="mo" id="MathJax-Span-1342"></span><span class="mi" id="MathJax-Span-1343" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">θ</span><span class="mo" id="MathJax-Span-1344" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="msqrt" id="MathJax-Span-1345" style="padding-left: 0.302em;"><span style="display: inline-block; position: relative; width: 5.053em; height: 0px;"><span style="position: absolute; clip: rect(2.952em, 1004.05em, 4.252em, -999.998em); top: -3.998em; left: 1.002em;"><span class="mrow" id="MathJax-Span-1346"><span class="mn" id="MathJax-Span-1347" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-1348" style="font-family: MathJax_Main; padding-left: 0.202em;">−</span><span class="msubsup" id="MathJax-Span-1349" style="padding-left: 0.202em;"><span style="display: inline-block; position: relative; width: 1.752em; height: 0px;"><span style="position: absolute; clip: rect(3.402em, 1001.3em, 4.152em, -999.998em); top: -3.998em; left: 0em;"><span class="mi" id="MathJax-Span-1350" style="font-family: MathJax_Main;">cos</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; top: -4.397em; left: 1.353em;"><span class="mn" id="MathJax-Span-1351" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span><span class="mo" id="MathJax-Span-1352"></span><span class="mi" id="MathJax-Span-1353" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">θ</span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.603em, 1004em, 3.902em, -999.998em); top: -4.697em; left: 1.002em;"><span style="display: inline-block; position: relative; width: 4.002em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -3.998em; left: -0.098em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -3.998em; left: 3.302em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 0.403em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 0.903em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 1.403em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 1.902em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 2.402em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="font-family: MathJax_Main; position: absolute; top: -3.998em; left: 2.902em;">−<span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.002em, 1001em, 4.502em, -999.998em); top: -4.147em; left: 0em;"><span style="font-family: MathJax_Size1;">√</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.628em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>sin</mi><mo>⁡</mo><mi>θ</mi><mo>=</mo><msqrt><mn>1</mn><mo>−</mo><msup><mi>cos</mi><mn>2</mn></msup><mo>⁡</mo><mi>θ</mi></msqrt></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-130"> \sin\theta  = \sqrt{1 - \cos^2\theta} </script>

</p><p>

and

</p><p>

  <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-131-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;R&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="text-align: center; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1354" style="width: 6.903em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.502em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.453em, 1005.5em, 2.452em, -999.998em); top: -2.298em; left: 0em;"><span class="mrow" id="MathJax-Span-1355"><span class="mi" id="MathJax-Span-1356" style="font-family: MathJax_Main;">cos</span><span class="mo" id="MathJax-Span-1357"></span><span class="mi" id="MathJax-Span-1358" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">θ</span><span class="mo" id="MathJax-Span-1359" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="texatom" id="MathJax-Span-1360" style="padding-left: 0.302em;"><span class="mrow" id="MathJax-Span-1361"><span class="mi" id="MathJax-Span-1362" style="font-family: MathJax_Main-bold;">R</span></span></span><span class="mo" id="MathJax-Span-1363" style="font-family: MathJax_Main; padding-left: 0.202em;">⋅</span><span class="texatom" id="MathJax-Span-1364" style="padding-left: 0.202em;"><span class="mrow" id="MathJax-Span-1365"><span class="mi" id="MathJax-Span-1366" style="font-family: MathJax_Main-bold;">n</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.302em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>cos</mi><mo>⁡</mo><mi>θ</mi><mo>=</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">R</mi></mrow><mo>⋅</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">n</mi></mrow></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-131"> \cos\theta = \mathbf{R} \cdot \mathbf{n} </script>

</p><pre class="listing tilde"><code><span class="line"><span class="hljs-keyword">double</span> cos_theta = fmin(dot(-unit_direction, rec.normal), <span class="hljs-number">1.0</span>);</span>
<span class="line"><span class="hljs-keyword">double</span> sin_theta = <span class="hljs-built_in">sqrt</span>(<span class="hljs-number">1.0</span> - cos_theta*cos_theta);</span>
<span class="line"></span>
<span class="line"><span class="hljs-keyword">if</span> (refraction_ratio * sin_theta &gt; <span class="hljs-number">1.0</span>) {</span>
<span class="line">    <span class="hljs-comment">// Must Reflect</span></span>
<span class="line">    ...</span>
<span class="line">} <span class="hljs-keyword">else</span> {</span>
<span class="line">    <span class="hljs-comment">// Can Refract</span></span>
<span class="line">    ...</span>
<span class="line">}</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_dielectric">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;57:</b> <kbd>[material.h]</kbd> Determining if the ray can refract</div></center>
<p>


</p></div>

<p></p><p>

</p><div class="together">
And the dielectric material that always refracts (when possible) is:

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">dielectric</span> :</span> <span class="hljs-keyword">public</span> material {</span>
<span class="line">    <span class="hljs-keyword">public</span>:</span>
<span class="line">        dielectric(<span class="hljs-keyword">double</span> index_of_refraction) : ir(index_of_refraction) {}</span>
<span class="line"></span>
<span class="line">        <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">scatter</span><span class="hljs-params">(</span>
<span class="line">            <span class="hljs-keyword">const</span> ray&amp; r_in, <span class="hljs-keyword">const</span> hit_record&amp; rec, color&amp; attenuation, ray&amp; scattered</span>
<span class="line">        )</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{</span>
<span class="line">            attenuation = color(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>);</span>
<span class="line">            <span class="hljs-keyword">double</span> refraction_ratio = rec.front_face ? (<span class="hljs-number">1.0</span>/ir) : ir;</span>
<span class="line"></span>
<span class="line">            vec3 unit_direction = unit_vector(r_in.direction());</span><div class=" highlight"><span class="line">            <span class="hljs-keyword">double</span> cos_theta = fmin(dot(-unit_direction, rec.normal), <span class="hljs-number">1.0</span>);</span>
<span class="line">            <span class="hljs-keyword">double</span> sin_theta = <span class="hljs-built_in">sqrt</span>(<span class="hljs-number">1.0</span> - cos_theta*cos_theta);</span>
<span class="line"></span>
<span class="line">            <span class="hljs-keyword">bool</span> cannot_refract = refraction_ratio * sin_theta &gt; <span class="hljs-number">1.0</span>;</span>
<span class="line">            vec3 direction;</span>
<span class="line"></span>
<span class="line">            <span class="hljs-keyword">if</span> (cannot_refract)</span>
<span class="line">                direction = reflect(unit_direction, rec.normal);</span>
<span class="line">            <span class="hljs-keyword">else</span></span>
<span class="line">                direction = refract(unit_direction, rec.normal, refraction_ratio);</span>
<span class="line"></span>
<span class="line">            scattered = ray(rec.p, direction);</span></div><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</span>
<span class="line">        }</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">public</span>:</span>
<span class="line">        <span class="hljs-keyword">double</span> ir; <span class="hljs-comment">// Index of Refraction</span></span>
<span class="line">};</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_dielectric">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;58:</b> <kbd>[material.h]</kbd> Dielectric material class with reflection</div></center>
<p>

</p></div>

<p></p><p>

</p><div class="together">
Attenuation is always 1 — the glass surface absorbs nothing. If we try that out with these
parameters:

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-keyword">auto</span> material_ground = make_shared&lt;lambertian&gt;(color(<span class="hljs-number">0.8</span>, <span class="hljs-number">0.8</span>, <span class="hljs-number">0.0</span>));</span>
<span class="line"><span class="hljs-keyword">auto</span> material_center = make_shared&lt;lambertian&gt;(color(<span class="hljs-number">0.1</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">0.5</span>));</span>
<span class="line"><span class="hljs-keyword">auto</span> material_left   = make_shared&lt;dielectric&gt;(<span class="hljs-number">1.5</span>);</span>
<span class="line"><span class="hljs-keyword">auto</span> material_right  = make_shared&lt;metal&gt;(color(<span class="hljs-number">0.8</span>, <span class="hljs-number">0.6</span>, <span class="hljs-number">0.2</span>), <span class="hljs-number">0.0</span>);</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_scene-dielectric">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;59:</b> <kbd>[main.cc]</kbd> Scene with dielectric and shiny sphere</div></center>
<p>


We get:

</p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/img-1.15-glass-sometimes-refract.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing in One Weekend_files/img-1.15-glass-sometimes-refract.png"></a><center><span class="imagecaption">Image 15: Glass sphere that sometimes refracts
  </span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="schlickapproximation">&nbsp;</a><a class="target" name="dielectrics/schlickapproximation">&nbsp;</a><a class="target" name="toc10.4">&nbsp;</a><h2>Schlick Approximation</h2>
<p>

</p><div class="together">
Now real glass has reflectivity that varies with angle — look at a window at a steep angle and it
becomes a mirror. There is a big ugly equation for that, but almost everybody uses a cheap and
surprisingly accurate polynomial approximation by Christophe Schlick. This yields our full glass
material:

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">dielectric</span> :</span> <span class="hljs-keyword">public</span> material {</span>
<span class="line">    <span class="hljs-keyword">public</span>:</span>
<span class="line">        dielectric(<span class="hljs-keyword">double</span> index_of_refraction) : ir(index_of_refraction) {}</span>
<span class="line"></span>
<span class="line">        <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">scatter</span><span class="hljs-params">(</span>
<span class="line">            <span class="hljs-keyword">const</span> ray&amp; r_in, <span class="hljs-keyword">const</span> hit_record&amp; rec, color&amp; attenuation, ray&amp; scattered</span>
<span class="line">        )</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{</span>
<span class="line">            attenuation = color(<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>);</span>
<span class="line">            <span class="hljs-keyword">double</span> refraction_ratio = rec.front_face ? (<span class="hljs-number">1.0</span>/ir) : ir;</span>
<span class="line"></span>
<span class="line">            vec3 unit_direction = unit_vector(r_in.direction());</span>
<span class="line">            <span class="hljs-keyword">double</span> cos_theta = fmin(dot(-unit_direction, rec.normal), <span class="hljs-number">1.0</span>);</span>
<span class="line">            <span class="hljs-keyword">double</span> sin_theta = <span class="hljs-built_in">sqrt</span>(<span class="hljs-number">1.0</span> - cos_theta*cos_theta);</span>
<span class="line"></span>
<span class="line">            <span class="hljs-keyword">bool</span> cannot_refract = refraction_ratio * sin_theta &gt; <span class="hljs-number">1.0</span>;</span>
<span class="line">            vec3 direction;</span>
<span class="line"></span><div class=" highlight"><span class="line">            <span class="hljs-keyword">if</span> (cannot_refract || reflectance(cos_theta, refraction_ratio) &gt; random_double())</span></div><span class="line">                direction = reflect(unit_direction, rec.normal);</span>
<span class="line">            <span class="hljs-keyword">else</span></span>
<span class="line">                direction = refract(unit_direction, rec.normal, refraction_ratio);</span>
<span class="line"></span>
<span class="line">            scattered = ray(rec.p, direction);</span>
<span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</span>
<span class="line">        }</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">public</span>:</span>
<span class="line">        <span class="hljs-keyword">double</span> ir; <span class="hljs-comment">// Index of Refraction</span></span><div class=" highlight"><span class="line"></span>
<span class="line">    <span class="hljs-keyword">private</span>:</span>
<span class="line">        <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">double</span> <span class="hljs-title">reflectance</span><span class="hljs-params">(<span class="hljs-keyword">double</span> cosine, <span class="hljs-keyword">double</span> ref_idx)</span> </span>{</span>
<span class="line">            <span class="hljs-comment">// Use Schlick's approximation for reflectance.</span></span>
<span class="line">            <span class="hljs-keyword">auto</span> r0 = (<span class="hljs-number">1</span>-ref_idx) / (<span class="hljs-number">1</span>+ref_idx);</span>
<span class="line">            r0 = r0*r0;</span>
<span class="line">            <span class="hljs-keyword">return</span> r0 + (<span class="hljs-number">1</span>-r0)*<span class="hljs-built_in">pow</span>((<span class="hljs-number">1</span> - cosine),<span class="hljs-number">5</span>);</span>
<span class="line">        }</span></div><span class="line">};</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_glass">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;60:</b> <kbd>[material.h]</kbd> Full glass material</div></center>
<p>

</p></div>

<p></p>
<a class="target" name="modelingahollowglasssphere">&nbsp;</a><a class="target" name="dielectrics/modelingahollowglasssphere">&nbsp;</a><a class="target" name="toc10.5">&nbsp;</a><h2>Modeling a Hollow Glass Sphere</h2>
<p>

</p><div class="together">
An interesting and easy trick with dielectric spheres is to note that if you use a negative radius,
the geometry is unaffected, but the surface normal points inward. This can be used as a bubble to
make a hollow glass sphere:

<p></p><pre class="listing tilde"><code><span class="line">world.add(make_shared&lt;sphere&gt;(point3( <span class="hljs-number">0.0</span>, <span class="hljs-number">-100.5</span>, <span class="hljs-number">-1.0</span>), <span class="hljs-number">100.0</span>, material_ground));</span>
<span class="line">world.add(make_shared&lt;sphere&gt;(point3( <span class="hljs-number">0.0</span>,    <span class="hljs-number">0.0</span>, <span class="hljs-number">-1.0</span>),   <span class="hljs-number">0.5</span>, material_center));</span>
<span class="line">world.add(make_shared&lt;sphere&gt;(point3(<span class="hljs-number">-1.0</span>,    <span class="hljs-number">0.0</span>, <span class="hljs-number">-1.0</span>),   <span class="hljs-number">0.5</span>, material_left));</span><div class=" highlight"><span class="line">world.add(make_shared&lt;sphere&gt;(point3(<span class="hljs-number">-1.0</span>,    <span class="hljs-number">0.0</span>, <span class="hljs-number">-1.0</span>),  <span class="hljs-number">-0.4</span>, material_left));</span></div><span class="line">world.add(make_shared&lt;sphere&gt;(point3( <span class="hljs-number">1.0</span>,    <span class="hljs-number">0.0</span>, <span class="hljs-number">-1.0</span>),   <span class="hljs-number">0.5</span>, material_right));</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_scene-hollow-glass">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;61:</b> <kbd>[main.cc]</kbd> Scene with hollow glass sphere</div></center>
<p>

</p></div>

<p></p><p>

</p><div class="together">
This gives:

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/img-1.16-glass-hollow.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing in One Weekend_files/img-1.16-glass-hollow.png"></a><center><span class="imagecaption">Image 16: A hollow glass sphere</span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="positionablecamera">&nbsp;</a><a class="target" name="positionablecamera">&nbsp;</a><a class="target" name="toc11">&nbsp;</a><h1>Positionable Camera</h1>
<p>


Cameras, like dielectrics, are a pain to debug. So I always develop mine incrementally. First, let’s
allow an adjustable field of view (<em class="underscore">fov</em>). This is the angle you see through the portal. Since our
image is not square, the fov is different horizontally and vertically. I always use vertical fov. I
also usually specify it in degrees and change to radians inside a constructor — a matter of
personal taste.

</p>
<a class="target" name="cameraviewinggeometry">&nbsp;</a><a class="target" name="positionablecamera/cameraviewinggeometry">&nbsp;</a><a class="target" name="toc11.1">&nbsp;</a><h2>Camera Viewing Geometry</h2>
<p>

</p><div class="together">
I first keep the rays coming from the origin and heading to the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-132-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1367" style="width: 3.952em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.152em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1003.1em, 2.402em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-1368"><span class="mi" id="MathJax-Span-1369" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1370" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mo" id="MathJax-Span-1371" style="font-family: MathJax_Main; padding-left: 0.302em;">−</span><span class="mn" id="MathJax-Span-1372" style="font-family: MathJax_Main;">1</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.184em; border-left: 0px solid; width: 0px; height: 1.066em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>z</mi><mo>=</mo><mo>−</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-132">z = -1</script> plane. We could make it the
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-133-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1373" style="width: 3.952em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.152em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.353em, 1003.1em, 2.402em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-1374"><span class="mi" id="MathJax-Span-1375" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-1376" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mo" id="MathJax-Span-1377" style="font-family: MathJax_Main; padding-left: 0.302em;">−</span><span class="mn" id="MathJax-Span-1378" style="font-family: MathJax_Main;">2</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.184em; border-left: 0px solid; width: 0px; height: 1.066em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>z</mi><mo>=</mo><mo>−</mo><mn>2</mn></math></span></span><script type="math/tex" id="MathJax-Element-133">z = -2</script> plane, or whatever, as long as we made <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-134-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1379" style="width: 0.753em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.603em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.052em, 1000.6em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-1380"><span class="mi" id="MathJax-Span-1381" style="font-family: MathJax_Math-italic;">h</span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>h</mi></math></span></span><script type="math/tex" id="MathJax-Element-134">h</script> a ratio to that distance. Here is our setup:

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/fig-1.14-cam-view-geom.jpg" target="_blank"><img class="markdeep" src="./Ray Tracing in One Weekend_files/fig-1.14-cam-view-geom.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_cam-view-geom">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;14:</b> Camera viewing geometry</span></center></div></center>

<p></p><p>

</p></div>

<p></p><p>

</p><div class="together">
This implies <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-135-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;tan&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mfrac&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/mfrac&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1382" style="width: 6.103em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.853em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.103em, 1004.75em, 2.652em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-1383"><span class="mi" id="MathJax-Span-1384" style="font-family: MathJax_Math-italic;">h</span><span class="mo" id="MathJax-Span-1385" style="font-family: MathJax_Main; padding-left: 0.302em;">=</span><span class="mi" id="MathJax-Span-1386" style="font-family: MathJax_Main; padding-left: 0.302em;">tan</span><span class="mo" id="MathJax-Span-1387"></span><span class="mo" id="MathJax-Span-1388" style="font-family: MathJax_Main;">(</span><span class="mfrac" id="MathJax-Span-1389"><span style="display: inline-block; position: relative; width: 0.453em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.353em, 1000.35em, 4.152em, -999.998em); top: -4.397em; left: 50%; margin-left: -0.148em;"><span class="mi" id="MathJax-Span-1390" style="font-size: 70.7%; font-family: MathJax_Math-italic;">θ</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(3.402em, 1000.3em, 4.152em, -999.998em); top: -3.647em; left: 50%; margin-left: -0.198em;"><span class="mn" id="MathJax-Span-1391" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.002em;"></span></span><span style="position: absolute; clip: rect(0.853em, 1000.45em, 1.203em, -999.998em); top: -1.248em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.453em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.052em;"></span></span></span></span><span class="mo" id="MathJax-Span-1392" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.497em; border-left: 0px solid; width: 0px; height: 1.753em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>h</mi><mo>=</mo><mi>tan</mi><mo>⁡</mo><mo stretchy="false">(</mo><mfrac><mi>θ</mi><mn>2</mn></mfrac><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-135">h = \tan(\frac{\theta}{2})</script>. Our camera now becomes:

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">camera</span> {</span></span>
<span class="line">    <span class="hljs-keyword">public</span>:</span><div class=" highlight"><span class="line">        camera(</span>
<span class="line">            <span class="hljs-keyword">double</span> vfov, <span class="hljs-comment">// vertical field-of-view in degrees</span></span>
<span class="line">            <span class="hljs-keyword">double</span> aspect_ratio</span>
<span class="line">        ) {</span>
<span class="line">            <span class="hljs-keyword">auto</span> theta = degrees_to_radians(vfov);</span>
<span class="line">            <span class="hljs-keyword">auto</span> h = <span class="hljs-built_in">tan</span>(theta/<span class="hljs-number">2</span>);</span>
<span class="line">            <span class="hljs-keyword">auto</span> viewport_height = <span class="hljs-number">2.0</span> * h;</span>
<span class="line">            <span class="hljs-keyword">auto</span> viewport_width = aspect_ratio * viewport_height;</span></div><span class="line"></span>
<span class="line">            <span class="hljs-keyword">auto</span> focal_length = <span class="hljs-number">1.0</span>;</span>
<span class="line"></span>
<span class="line">            origin = point3(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);</span>
<span class="line">            horizontal = vec3(viewport_width, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>);</span>
<span class="line">            vertical = vec3(<span class="hljs-number">0.0</span>, viewport_height, <span class="hljs-number">0.0</span>);</span>
<span class="line">            lower_left_corner = origin - horizontal/<span class="hljs-number">2</span> - vertical/<span class="hljs-number">2</span> - vec3(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, focal_length);</span>
<span class="line">        }</span>
<span class="line"></span>
<span class="line">        <span class="hljs-function">ray <span class="hljs-title">get_ray</span><span class="hljs-params">(<span class="hljs-keyword">double</span> u, <span class="hljs-keyword">double</span> v)</span> <span class="hljs-keyword">const</span> </span>{</span>
<span class="line">            <span class="hljs-keyword">return</span> ray(origin, lower_left_corner + u*horizontal + v*vertical - origin);</span>
<span class="line">        }</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">private</span>:</span>
<span class="line">        point3 origin;</span>
<span class="line">        point3 lower_left_corner;</span>
<span class="line">        vec3 horizontal;</span>
<span class="line">        vec3 vertical;</span>
<span class="line">};</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_camera-fov">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;62:</b> <kbd>[camera.h]</kbd> Camera with adjustable field-of-view (fov)</div></center>
<p>

</p></div>

<p></p><p>

</p><div class="together">
When calling it with camera <code>cam(90, aspect_ratio)</code> and these spheres:

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{</span>
<span class="line">    ...</span>
<span class="line">    <span class="hljs-comment">// World</span></span>
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line">    <span class="hljs-keyword">auto</span> R = <span class="hljs-built_in">cos</span>(pi/<span class="hljs-number">4</span>);</span>
<span class="line">    hittable_list world;</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">auto</span> material_left  = make_shared&lt;lambertian&gt;(color(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>));</span>
<span class="line">    <span class="hljs-keyword">auto</span> material_right = make_shared&lt;lambertian&gt;(color(<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>));</span>
<span class="line"></span>
<span class="line">    world.add(make_shared&lt;sphere&gt;(point3(-R, <span class="hljs-number">0</span>, <span class="hljs-number">-1</span>), R, material_left));</span>
<span class="line">    world.add(make_shared&lt;sphere&gt;(point3( R, <span class="hljs-number">0</span>, <span class="hljs-number">-1</span>), R, material_right));</span>
<span class="line"></span></div><span class="line"></span>
<span class="line">    <span class="hljs-comment">// Camera</span></span>
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line">    <span class="hljs-function">camera <span class="hljs-title">cam</span><span class="hljs-params">(<span class="hljs-number">90.0</span>, aspect_ratio)</span></span>;</span></div><span class="line"></span>
<span class="line">    <span class="hljs-comment">// Render</span></span>
<span class="line"></span>
<span class="line">    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"P3\n"</span> &lt;&lt; image_width &lt;&lt; <span class="hljs-string">" "</span> &lt;&lt; image_height &lt;&lt; <span class="hljs-string">"\n255\n"</span>;</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = image_height<span class="hljs-number">-1</span>; j &gt;= <span class="hljs-number">0</span>; --j) {</span>
<span class="line">    ...</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_scene-wide-angle">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;63:</b> <kbd>[main.cc]</kbd> Scene with wide-angle camera</div></center>
<p>


gives:

</p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/img-1.17-wide-view.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing in One Weekend_files/img-1.17-wide-view.png"></a><center><span class="imagecaption">Image 17: A wide-angle view</span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="positioningandorientingthecamera">&nbsp;</a><a class="target" name="positionablecamera/positioningandorientingthecamera">&nbsp;</a><a class="target" name="toc11.2">&nbsp;</a><h2>Positioning and Orienting the Camera</h2>
<p>

To get an arbitrary viewpoint, let’s first name the points we care about. We’ll call the position
where we place the camera <em class="underscore">lookfrom</em>, and the point we look at <em class="underscore">lookat</em>. (Later, if you want, you
could define a direction to look in instead of a point to look at.)

</p><p>

We also need a way to specify the roll, or sideways tilt, of the camera: the rotation around the
lookat-lookfrom axis. Another way to think about it is that even if you keep <code>lookfrom</code> and <code>lookat</code>
constant, you can still rotate your head around your nose. What we need is a way to specify an “up”
vector for the camera. This up vector should lie in the plane orthogonal to the view direction.

</p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/fig-1.15-cam-view-dir.jpg" target="_blank"><img class="markdeep" src="./Ray Tracing in One Weekend_files/fig-1.15-cam-view-dir.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_cam-view-dir">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;15:</b> Camera view direction</span></center></div></center>

<p></p><p>

We can actually use any up vector we want, and simply project it onto this plane to get an up vector
for the camera. I use the common convention of naming a “view up” (<em class="underscore">vup</em>) vector. A couple of cross
products, and we now have a complete orthonormal basis <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-136-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;w&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1393" style="width: 4.252em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.402em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1003.3em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-1394"><span class="mo" id="MathJax-Span-1395" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1396" style="font-family: MathJax_Math-italic;">u</span><span class="mo" id="MathJax-Span-1397" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1398" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">v</span><span class="mo" id="MathJax-Span-1399" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1400" style="font-family: MathJax_Math-italic; padding-left: 0.152em;">w</span><span class="mo" id="MathJax-Span-1401" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>u</mi><mo>,</mo><mi>v</mi><mo>,</mo><mi>w</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-136">(u,v,w)</script> to describe our camera’s
orientation.

</p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/fig-1.16-cam-view-up.jpg" target="_blank"><img class="markdeep" src="./Ray Tracing in One Weekend_files/fig-1.16-cam-view-up.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_cam-view-up">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;16:</b> Camera view up direction</span></center></div></center>

<p></p><p>

Remember that <code>vup</code>, <code>v</code>, and <code>w</code> are all in the same plane. Note that, like before when our fixed
camera faced -Z, our arbitrary view camera faces -w. And keep in mind that we can — but we don’t
have to — use world up <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-137-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1402" style="width: 3.952em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.152em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1003.05em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-1403"><span class="mo" id="MathJax-Span-1404" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-1405" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-1406" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-1407" style="font-family: MathJax_Main; padding-left: 0.152em;">1</span><span class="mo" id="MathJax-Span-1408" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-1409" style="font-family: MathJax_Main; padding-left: 0.152em;">0</span><span class="mo" id="MathJax-Span-1410" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo>,</mo><mn>0</mn><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-137">(0,1,0)</script> to specify vup. This is convenient and will naturally keep your
camera horizontally level until you decide to experiment with crazy camera angles.

</p><pre class="listing tilde"><code><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">camera</span> {</span></span>
<span class="line">    <span class="hljs-keyword">public</span>:</span>
<span class="line">        camera(</span><div class=" highlight"><span class="line">            point3 lookfrom,</span>
<span class="line">            point3 lookat,</span>
<span class="line">            vec3   vup,</span></div><span class="line">            <span class="hljs-keyword">double</span> vfov, <span class="hljs-comment">// vertical field-of-view in degrees</span></span>
<span class="line">            <span class="hljs-keyword">double</span> aspect_ratio</span>
<span class="line">        ) {</span>
<span class="line">            <span class="hljs-keyword">auto</span> theta = degrees_to_radians(vfov);</span>
<span class="line">            <span class="hljs-keyword">auto</span> h = <span class="hljs-built_in">tan</span>(theta/<span class="hljs-number">2</span>);</span>
<span class="line">            <span class="hljs-keyword">auto</span> viewport_height = <span class="hljs-number">2.0</span> * h;</span>
<span class="line">            <span class="hljs-keyword">auto</span> viewport_width = aspect_ratio * viewport_height;</span>
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line">            <span class="hljs-keyword">auto</span> w = unit_vector(lookfrom - lookat);</span>
<span class="line">            <span class="hljs-keyword">auto</span> u = unit_vector(cross(vup, w));</span>
<span class="line">            <span class="hljs-keyword">auto</span> v = cross(w, u);</span>
<span class="line"></span>
<span class="line">            origin = lookfrom;</span>
<span class="line">            horizontal = viewport_width * u;</span>
<span class="line">            vertical = viewport_height * v;</span>
<span class="line">            lower_left_corner = origin - horizontal/<span class="hljs-number">2</span> - vertical/<span class="hljs-number">2</span> - w;</span></div><span class="line">        }</span>
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line">        <span class="hljs-function">ray <span class="hljs-title">get_ray</span><span class="hljs-params">(<span class="hljs-keyword">double</span> s, <span class="hljs-keyword">double</span> t)</span> <span class="hljs-keyword">const</span> </span>{</span>
<span class="line">            <span class="hljs-keyword">return</span> ray(origin, lower_left_corner + s*horizontal + t*vertical - origin);</span>
<span class="line">        }</span></div><span class="line"></span>
<span class="line">    <span class="hljs-keyword">private</span>:</span>
<span class="line">        point3 origin;</span>
<span class="line">        point3 lower_left_corner;</span>
<span class="line">        vec3 horizontal;</span>
<span class="line">        vec3 vertical;</span>
<span class="line">};</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_camera-orient">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;64:</b> <kbd>[camera.h]</kbd> Positionable and orientable camera</div></center>
<p>


</p><div class="together">
We'll change back to the prior scene, and use the new viewpoint:

<p></p><pre class="listing tilde"><code><span class="line">hittable_list world;</span>
<span class="line"></span>
<span class="line"><span class="hljs-keyword">auto</span> material_ground = make_shared&lt;lambertian&gt;(color(<span class="hljs-number">0.8</span>, <span class="hljs-number">0.8</span>, <span class="hljs-number">0.0</span>));</span>
<span class="line"><span class="hljs-keyword">auto</span> material_center = make_shared&lt;lambertian&gt;(color(<span class="hljs-number">0.1</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">0.5</span>));</span>
<span class="line"><span class="hljs-keyword">auto</span> material_left   = make_shared&lt;dielectric&gt;(<span class="hljs-number">1.5</span>);</span>
<span class="line"><span class="hljs-keyword">auto</span> material_right  = make_shared&lt;metal&gt;(color(<span class="hljs-number">0.8</span>, <span class="hljs-number">0.6</span>, <span class="hljs-number">0.2</span>), <span class="hljs-number">0.0</span>);</span>
<span class="line"></span>
<span class="line">world.add(make_shared&lt;sphere&gt;(point3( <span class="hljs-number">0.0</span>, <span class="hljs-number">-100.5</span>, <span class="hljs-number">-1.0</span>), <span class="hljs-number">100.0</span>, material_ground));</span>
<span class="line">world.add(make_shared&lt;sphere&gt;(point3( <span class="hljs-number">0.0</span>,    <span class="hljs-number">0.0</span>, <span class="hljs-number">-1.0</span>),   <span class="hljs-number">0.5</span>, material_center));</span>
<span class="line">world.add(make_shared&lt;sphere&gt;(point3(<span class="hljs-number">-1.0</span>,    <span class="hljs-number">0.0</span>, <span class="hljs-number">-1.0</span>),   <span class="hljs-number">0.5</span>, material_left));</span>
<span class="line">world.add(make_shared&lt;sphere&gt;(point3(<span class="hljs-number">-1.0</span>,    <span class="hljs-number">0.0</span>, <span class="hljs-number">-1.0</span>), <span class="hljs-number">-0.45</span>, material_left));</span>
<span class="line">world.add(make_shared&lt;sphere&gt;(point3( <span class="hljs-number">1.0</span>,    <span class="hljs-number">0.0</span>, <span class="hljs-number">-1.0</span>),   <span class="hljs-number">0.5</span>, material_right));</span>
<span class="line"></span>
<span class="line"><span class="hljs-function">camera <span class="hljs-title">cam</span><span class="hljs-params">(point3(<span class="hljs-number">-2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>), point3(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">-1</span>), vec3(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>), <span class="hljs-number">90</span>, aspect_ratio)</span></span>;</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_scene-free-view">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;65:</b> <kbd>[main.cc]</kbd> Scene with alternate viewpoint</div></center>
<p>


to get:

</p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/img-1.18-view-distant.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing in One Weekend_files/img-1.18-view-distant.png"></a><center><span class="imagecaption">Image 18: A distant view</span></center></div></center>

<p></p><p>

And we can change field of view:

</p><pre class="listing tilde"><code><span class="line"><span class="hljs-function">camera <span class="hljs-title">cam</span><span class="hljs-params">(point3(<span class="hljs-number">-2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>), point3(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">-1</span>), vec3(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>), <span class="hljs-number">20</span>, aspect_ratio)</span></span>;</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_change-field-view">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;66:</b> <kbd>[main.cc]</kbd> Change field of view</div></center>
<p>


to get:

</p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/img-1.19-view-zoom.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing in One Weekend_files/img-1.19-view-zoom.png"></a><center><span class="imagecaption">Image 19: Zooming in</span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="defocusblur">&nbsp;</a><a class="target" name="defocusblur">&nbsp;</a><a class="target" name="toc12">&nbsp;</a><h1>Defocus Blur</h1>
<p>


Now our final feature: defocus blur. Note, all photographers will call it “depth of field” so be
aware of only using “defocus blur” among friends.

</p><p>

The reason we defocus blur in real cameras is because they need a big hole (rather than just a
pinhole) to gather light. This would defocus everything, but if we stick a lens in the hole, there
will be a certain distance where everything is in focus. You can think of a lens this way: all light
rays coming <em class="underscore">from</em> a specific point at the focus distance — and that hit the lens — will be bent
back <em class="underscore">to</em> a single point on the image sensor.

</p><p>

We call the distance between the projection point and the plane where everything is in perfect focus
the <em class="underscore">focus distance</em>. Be aware that the focus distance is not the same as the focal length — the
<em class="underscore">focal length</em> is the distance between the projection point and the image plane.

</p><p>

In a physical camera, the focus distance is controlled by the distance between the lens and the
film/sensor. That is why you see the lens move relative to the camera when you change what is in
focus (that may happen in your phone camera too, but the sensor moves). The “aperture” is a hole to
control how big the lens is effectively. For a real camera, if you need more light you make the
aperture bigger, and will get more defocus blur. For our virtual camera, we can have a perfect
sensor and never need more light, so we only have an aperture when we want defocus blur.

</p>
<a class="target" name="athinlensapproximation">&nbsp;</a><a class="target" name="defocusblur/athinlensapproximation">&nbsp;</a><a class="target" name="toc12.1">&nbsp;</a><h2>A Thin Lens Approximation</h2>
<p>

</p><div class="together">
A real camera has a complicated compound lens. For our code we could simulate the order: sensor,
then lens, then aperture. Then we could figure out where to send the rays, and flip the image after
it's computed (the image is projected upside down on the film). Graphics people, however, usually
use a thin lens approximation:

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/fig-1.17-cam-lens.jpg" target="_blank"><img class="markdeep" src="./Ray Tracing in One Weekend_files/fig-1.17-cam-lens.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_cam-lens">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;17:</b> Camera lens model</span></center></div></center>

<p></p><p>

</p></div>

<p></p><p>

</p><div class="together">
We don’t need to simulate any of the inside of the camera. For the purposes of rendering an image
outside the camera, that would be unnecessary complexity. Instead, I usually start rays from the
lens, and send them toward the focus plane (<code>focus_dist</code> away from the lens), where everything on
that plane is in perfect focus.

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/fig-1.18-cam-film-plane.jpg" target="_blank"><img class="markdeep" src="./Ray Tracing in One Weekend_files/fig-1.18-cam-film-plane.jpg"></a><center><span class="imagecaption"><a class="target" name="figure_cam-film-plane">&nbsp;</a><b style="font-style:normal;">Figure&nbsp;18:</b> Camera focus plane</span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="generatingsamplerays">&nbsp;</a><a class="target" name="defocusblur/generatingsamplerays">&nbsp;</a><a class="target" name="toc12.2">&nbsp;</a><h2>Generating Sample Rays</h2>
<p>

Normally, all scene rays originate from the <code>lookfrom</code> point. In order to accomplish defocus blur,
generate random scene rays originating from inside a disk centered at the <code>lookfrom</code> point. The
larger the radius, the greater the defocus blur. You can think of our original camera as having a
defocus disk of radius zero (no blur at all), so all rays originated at the disk center
(<code>lookfrom</code>).

</p><pre class="listing tilde"><code><span class="line"><span class="hljs-function">vec3 <span class="hljs-title">random_in_unit_disk</span><span class="hljs-params">()</span> </span>{</span>
<span class="line">    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {</span>
<span class="line">        <span class="hljs-keyword">auto</span> p = vec3(random_double(<span class="hljs-number">-1</span>,<span class="hljs-number">1</span>), random_double(<span class="hljs-number">-1</span>,<span class="hljs-number">1</span>), <span class="hljs-number">0</span>);</span>
<span class="line">        <span class="hljs-keyword">if</span> (p.length_squared() &gt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">continue</span>;</span>
<span class="line">        <span class="hljs-keyword">return</span> p;</span>
<span class="line">    }</span>
<span class="line">}</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_rand-in-unit-disk">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;67:</b> <kbd>[vec3.h]</kbd> Generate random point inside unit disk</div></center>
<pre class="listing tilde"><code><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">camera</span> {</span></span>
<span class="line">    <span class="hljs-keyword">public</span>:</span>
<span class="line">        camera(</span>
<span class="line">            point3 lookfrom,</span>
<span class="line">            point3 lookat,</span>
<span class="line">            vec3   vup,</span>
<span class="line">            <span class="hljs-keyword">double</span> vfov, <span class="hljs-comment">// vertical field-of-view in degrees</span></span><div class=" highlight"><span class="line">            <span class="hljs-keyword">double</span> aspect_ratio,</span>
<span class="line">            <span class="hljs-keyword">double</span> aperture,</span>
<span class="line">            <span class="hljs-keyword">double</span> focus_dist</span></div><span class="line">        ) {</span>
<span class="line">            <span class="hljs-keyword">auto</span> theta = degrees_to_radians(vfov);</span>
<span class="line">            <span class="hljs-keyword">auto</span> h = <span class="hljs-built_in">tan</span>(theta/<span class="hljs-number">2</span>);</span>
<span class="line">            <span class="hljs-keyword">auto</span> viewport_height = <span class="hljs-number">2.0</span> * h;</span>
<span class="line">            <span class="hljs-keyword">auto</span> viewport_width = aspect_ratio * viewport_height;</span>
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line">            w = unit_vector(lookfrom - lookat);</span>
<span class="line">            u = unit_vector(cross(vup, w));</span>
<span class="line">            v = cross(w, u);</span></div><span class="line"></span>
<span class="line">            origin = lookfrom;</span><div class=" highlight"><span class="line">            horizontal = focus_dist * viewport_width * u;</span>
<span class="line">            vertical = focus_dist * viewport_height * v;</span>
<span class="line">            lower_left_corner = origin - horizontal/<span class="hljs-number">2</span> - vertical/<span class="hljs-number">2</span> - focus_dist*w;</span>
<span class="line"></span>
<span class="line">            lens_radius = aperture / <span class="hljs-number">2</span>;</span></div><span class="line">        }</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">        <span class="hljs-function">ray <span class="hljs-title">get_ray</span><span class="hljs-params">(<span class="hljs-keyword">double</span> s, <span class="hljs-keyword">double</span> t)</span> <span class="hljs-keyword">const</span> </span>{</span><div class=" highlight"><span class="line">            vec3 rd = lens_radius * random_in_unit_disk();</span>
<span class="line">            vec3 offset = u * rd.x() + v * rd.y();</span>
<span class="line"></span>
<span class="line">            <span class="hljs-keyword">return</span> ray(</span>
<span class="line">                origin + offset,</span>
<span class="line">                lower_left_corner + s*horizontal + t*vertical - origin - offset</span>
<span class="line">            );</span></div><span class="line">        }</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">private</span>:</span>
<span class="line">        point3 origin;</span>
<span class="line">        point3 lower_left_corner;</span>
<span class="line">        vec3 horizontal;</span>
<span class="line">        vec3 vertical;</span><div class=" highlight"><span class="line">        vec3 u, v, w;</span>
<span class="line">        <span class="hljs-keyword">double</span> lens_radius;</span></div><span class="line">};</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_camera-dof">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;68:</b> <kbd>[camera.h]</kbd> Camera with adjustable depth-of-field (dof)</div></center>
<p>


</p><div class="together">
Using a big aperture:

<p></p><pre class="listing tilde"><code><span class="line"><span class="hljs-function">point3 <span class="hljs-title">lookfrom</span><span class="hljs-params">(<span class="hljs-number">3</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>)</span></span>;</span>
<span class="line"><span class="hljs-function">point3 <span class="hljs-title">lookat</span><span class="hljs-params">(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">-1</span>)</span></span>;</span>
<span class="line"><span class="hljs-function">vec3 <span class="hljs-title">vup</span><span class="hljs-params">(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)</span></span>;</span>
<span class="line"><span class="hljs-keyword">auto</span> dist_to_focus = (lookfrom-lookat).length();</span>
<span class="line"><span class="hljs-keyword">auto</span> aperture = <span class="hljs-number">2.0</span>;</span>
<span class="line"></span>
<span class="line"><span class="hljs-function">camera <span class="hljs-title">cam</span><span class="hljs-params">(lookfrom, lookat, vup, <span class="hljs-number">20</span>, aspect_ratio, aperture, dist_to_focus)</span></span>;</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_scene-camera-dof">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;69:</b> <kbd>[main.cc]</kbd> Scene camera with depth-of-field</div></center>
<p>


We get:

</p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/img-1.20-depth-of-field.png" target="_blank"><img class="markdeep pixel" src="./Ray Tracing in One Weekend_files/img-1.20-depth-of-field.png"></a><center><span class="imagecaption">Image 20: Spheres with depth-of-field</span></center></div></center>

<p></p><p>

</p></div>

<p></p>
<a class="target" name="wherenext?">&nbsp;</a><a class="target" name="wherenext?">&nbsp;</a><a class="target" name="toc13">&nbsp;</a><h1>Where Next?</h1>

<a class="target" name="afinalrender">&nbsp;</a><a class="target" name="wherenext?/afinalrender">&nbsp;</a><a class="target" name="toc13.1">&nbsp;</a><h2>A Final Render</h2>
<p>

</p><div class="together">
First let’s make the image on the cover of this book — lots of random spheres:

<p></p><pre class="listing tilde"><code><div class=" highlight"><span class="line"><span class="hljs-function">hittable_list <span class="hljs-title">random_scene</span><span class="hljs-params">()</span> </span>{</span>
<span class="line">    hittable_list world;</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">auto</span> ground_material = make_shared&lt;lambertian&gt;(color(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>));</span>
<span class="line">    world.add(make_shared&lt;sphere&gt;(point3(<span class="hljs-number">0</span>,<span class="hljs-number">-1000</span>,<span class="hljs-number">0</span>), <span class="hljs-number">1000</span>, ground_material));</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> a = <span class="hljs-number">-11</span>; a &lt; <span class="hljs-number">11</span>; a++) {</span>
<span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> b = <span class="hljs-number">-11</span>; b &lt; <span class="hljs-number">11</span>; b++) {</span>
<span class="line">            <span class="hljs-keyword">auto</span> choose_mat = random_double();</span>
<span class="line">            <span class="hljs-function">point3 <span class="hljs-title">center</span><span class="hljs-params">(a + <span class="hljs-number">0.9</span>*random_double(), <span class="hljs-number">0.2</span>, b + <span class="hljs-number">0.9</span>*random_double())</span></span>;</span>
<span class="line"></span>
<span class="line">            <span class="hljs-keyword">if</span> ((center - point3(<span class="hljs-number">4</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">0</span>)).length() &gt; <span class="hljs-number">0.9</span>) {</span>
<span class="line">                <span class="hljs-built_in">shared_ptr</span>&lt;material&gt; sphere_material;</span>
<span class="line"></span>
<span class="line">                <span class="hljs-keyword">if</span> (choose_mat &lt; <span class="hljs-number">0.8</span>) {</span>
<span class="line">                    <span class="hljs-comment">// diffuse</span></span>
<span class="line">                    <span class="hljs-keyword">auto</span> albedo = color::random() * color::random();</span>
<span class="line">                    sphere_material = make_shared&lt;lambertian&gt;(albedo);</span>
<span class="line">                    world.add(make_shared&lt;sphere&gt;(center, <span class="hljs-number">0.2</span>, sphere_material));</span>
<span class="line">                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (choose_mat &lt; <span class="hljs-number">0.95</span>) {</span>
<span class="line">                    <span class="hljs-comment">// metal</span></span>
<span class="line">                    <span class="hljs-keyword">auto</span> albedo = color::random(<span class="hljs-number">0.5</span>, <span class="hljs-number">1</span>);</span>
<span class="line">                    <span class="hljs-keyword">auto</span> fuzz = random_double(<span class="hljs-number">0</span>, <span class="hljs-number">0.5</span>);</span>
<span class="line">                    sphere_material = make_shared&lt;metal&gt;(albedo, fuzz);</span>
<span class="line">                    world.add(make_shared&lt;sphere&gt;(center, <span class="hljs-number">0.2</span>, sphere_material));</span>
<span class="line">                } <span class="hljs-keyword">else</span> {</span>
<span class="line">                    <span class="hljs-comment">// glass</span></span>
<span class="line">                    sphere_material = make_shared&lt;dielectric&gt;(<span class="hljs-number">1.5</span>);</span>
<span class="line">                    world.add(make_shared&lt;sphere&gt;(center, <span class="hljs-number">0.2</span>, sphere_material));</span>
<span class="line">                }</span>
<span class="line">            }</span>
<span class="line">        }</span>
<span class="line">    }</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">auto</span> material1 = make_shared&lt;dielectric&gt;(<span class="hljs-number">1.5</span>);</span>
<span class="line">    world.add(make_shared&lt;sphere&gt;(point3(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>), <span class="hljs-number">1.0</span>, material1));</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">auto</span> material2 = make_shared&lt;lambertian&gt;(color(<span class="hljs-number">0.4</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">0.1</span>));</span>
<span class="line">    world.add(make_shared&lt;sphere&gt;(point3(<span class="hljs-number">-4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>), <span class="hljs-number">1.0</span>, material2));</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">auto</span> material3 = make_shared&lt;metal&gt;(color(<span class="hljs-number">0.7</span>, <span class="hljs-number">0.6</span>, <span class="hljs-number">0.5</span>), <span class="hljs-number">0.0</span>);</span>
<span class="line">    world.add(make_shared&lt;sphere&gt;(point3(<span class="hljs-number">4</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>), <span class="hljs-number">1.0</span>, material3));</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">return</span> world;</span>
<span class="line">}</span></div><span class="line"></span>
<span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{</span>
<span class="line"></span>
<span class="line">    <span class="hljs-comment">// Image</span></span>
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> aspect_ratio = <span class="hljs-number">3.0</span> / <span class="hljs-number">2.0</span>;</span>
<span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> image_width = <span class="hljs-number">1200</span>;</span></div><span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> image_height = <span class="hljs-keyword">static_cast</span>&lt;<span class="hljs-keyword">int</span>&gt;(image_width / aspect_ratio);</span><div class=" highlight"><span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> samples_per_pixel = <span class="hljs-number">500</span>;</span></div><span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> max_depth = <span class="hljs-number">50</span>;</span>
<span class="line"></span>
<span class="line">    <span class="hljs-comment">// World</span></span>
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line">    <span class="hljs-keyword">auto</span> world = random_scene();</span></div><span class="line"></span>
<span class="line">    <span class="hljs-comment">// Camera</span></span>
<span class="line"></span>
<span class="line"></span><div class=" highlight"><span class="line">    <span class="hljs-function">point3 <span class="hljs-title">lookfrom</span><span class="hljs-params">(<span class="hljs-number">13</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>)</span></span>;</span>
<span class="line">    <span class="hljs-function">point3 <span class="hljs-title">lookat</span><span class="hljs-params">(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>)</span></span>;</span></div><span class="line">    <span class="hljs-function">vec3 <span class="hljs-title">vup</span><span class="hljs-params">(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)</span></span>;</span><div class=" highlight"><span class="line">    <span class="hljs-keyword">auto</span> dist_to_focus = <span class="hljs-number">10.0</span>;</span>
<span class="line">    <span class="hljs-keyword">auto</span> aperture = <span class="hljs-number">0.1</span>;</span></div><span class="line"></span>
<span class="line">    <span class="hljs-function">camera <span class="hljs-title">cam</span><span class="hljs-params">(lookfrom, lookat, vup, <span class="hljs-number">20</span>, aspect_ratio, aperture, dist_to_focus)</span></span>;</span>
<span class="line"></span>
<span class="line">    <span class="hljs-comment">// Render</span></span>
<span class="line"></span>
<span class="line">    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"P3\n"</span> &lt;&lt; image_width &lt;&lt; <span class="hljs-string">' '</span> &lt;&lt; image_height &lt;&lt; <span class="hljs-string">"\n255\n"</span>;</span>
<span class="line"></span>
<span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = image_height<span class="hljs-number">-1</span>; j &gt;= <span class="hljs-number">0</span>; --j) {</span>
<span class="line">        ...</span>
<span class="line">}</span></code></pre><center><div class="listingcaption tilde"><a class="target" name="listing_scene-final">&nbsp;</a><b style="font-style:normal;">Listing&nbsp;70:</b> <kbd>[main.cc]</kbd> Final scene</div></center>
<p>

</p></div>

<p></p><p>

</p><div class="together">
This gives:

<p></p><p>

  </p><center><div class="image" style=""><a href="./Ray Tracing in One Weekend_files/img-1.21-book1-final.jpg" target="_blank"><img class="markdeep" src="./Ray Tracing in One Weekend_files/img-1.21-book1-final.jpg"></a><center><span class="imagecaption">Image 21: Final scene</span></center></div></center>

<p></p><p>

</p></div>

<p></p><p>

An interesting thing you might note is the glass balls don’t really have shadows which makes them
look like they are floating. This is not a bug — you don’t see glass balls much in real life, where
they also look a bit strange, and indeed seem to float on cloudy days. A point on the big sphere
under a glass ball still has lots of light hitting it because the sky is re-ordered rather than
blocked.

</p>
<a class="target" name="nextsteps">&nbsp;</a><a class="target" name="wherenext?/nextsteps">&nbsp;</a><a class="target" name="toc13.2">&nbsp;</a><h2>Next Steps</h2>
<p>

You now have a cool ray tracer! What next?

</p><p>

</p><ol start="1">
  <li class="number">Lights — You can do this explicitly, by sending shadow rays to lights, or it can be done
       implicitly by making some objects emit light, biasing scattered rays toward them, and then
       downweighting those rays to cancel out the bias. Both work. I am in the minority in favoring
       the latter approach.

<p></p><p>

</p></li>
  <li class="number">Triangles — Most cool models are in triangle form. The model I/O is the worst and almost
       everybody tries to get somebody else’s code to do this.

<p></p><p>

</p></li>
  <li class="number">Surface Textures — This lets you paste images on like wall paper. Pretty easy and a good thing
       to do.

<p></p><p>

</p></li>
  <li class="number">Solid textures — Ken Perlin has his code online. Andrew Kensler has some very cool info at his
       blog.

<p></p><p>

</p></li>
  <li class="number">Volumes and Media — Cool stuff and will challenge your software architecture. I favor making
       volumes have the hittable interface and probabilistically have intersections based on density.
       Your rendering code doesn’t even have to know it has volumes with that method.

<p></p><p>

</p></li>
  <li class="number">Parallelism — Run <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-138-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1411" style="width: 1.153em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.903em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.052em, 1000.9em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-1412"><span class="mi" id="MathJax-Span-1413" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi></math></span></span><script type="math/tex" id="MathJax-Element-138">N</script> copies of your code on <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-139-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1414" style="width: 1.153em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.903em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.052em, 1000.9em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-1415"><span class="mi" id="MathJax-Span-1416" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi></math></span></span><script type="math/tex" id="MathJax-Element-139">N</script> cores with different random seeds. Average
       the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-140-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1417" style="width: 1.153em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.903em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.052em, 1000.9em, 2.052em, -999.998em); top: -1.898em; left: 0em;"><span class="mrow" id="MathJax-Span-1418"><span class="mi" id="MathJax-Span-1419" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span></span><span style="display: inline-block; width: 0px; height: 1.902em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi></math></span></span><script type="math/tex" id="MathJax-Element-140">N</script> runs. This averaging can also be done hierarchically where <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-141-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;/&lt;/mo&gt;&lt;/mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1420" style="width: 2.402em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.902em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1001.85em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-1421"><span class="mi" id="MathJax-Span-1422" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span class="texatom" id="MathJax-Span-1423"><span class="mrow" id="MathJax-Span-1424"><span class="mo" id="MathJax-Span-1425" style="font-family: MathJax_Main;">/</span></span></span><span class="mn" id="MathJax-Span-1426" style="font-family: MathJax_Main;">2</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mn>2</mn></math></span></span><script type="math/tex" id="MathJax-Element-141">N/2</script> pairs can be averaged
       to get <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-142-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;/&lt;/mo&gt;&lt;/mrow&gt;&lt;mn&gt;4&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1427" style="width: 2.402em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.902em; height: 0px; font-size: 125%;"><span style="position: absolute; clip: rect(1.252em, 1001.85em, 2.552em, -999.998em); top: -2.147em; left: 0em;"><span class="mrow" id="MathJax-Span-1428"><span class="mi" id="MathJax-Span-1429" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span class="texatom" id="MathJax-Span-1430"><span class="mrow" id="MathJax-Span-1431"><span class="mo" id="MathJax-Span-1432" style="font-family: MathJax_Main;">/</span></span></span><span class="mn" id="MathJax-Span-1433" style="font-family: MathJax_Main;">4</span></span><span style="display: inline-block; width: 0px; height: 2.152em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mn>4</mn></math></span></span><script type="math/tex" id="MathJax-Element-142">N/4</script> images, and pairs of those can be averaged. That method of parallelism should
       extend well into the thousands of cores with very little coding.</li></ol>

<p></p><p>

Have fun, and please send me your cool images!

</p>
<a class="target" name="acknowledgments">&nbsp;</a><a class="target" name="acknowledgments">&nbsp;</a><a class="target" name="toc14">&nbsp;</a><h1>Acknowledgments</h1>
<p>


</p><div class="credit-list"> <strong class="asterisk">Original Manuscript Help</strong>

<p></p><p>

</p><ul>
  <li class="minus">Dave Hart
</li>
  <li class="minus">Jean Buckley</li></ul>

<p></p><p>

</p></div>

<p></p><p>

</p><div class="credit-list"> <strong class="asterisk">Web Release</strong>

<p></p><p>

</p><ul>
  <li class="minus"><a href="https://github.com/bernakabadayi">Berna Kabadayı</a>
</li>
  <li class="minus"><a href="https://github.com/lmancini">Lorenzo Mancini</a>
</li>
  <li class="minus"><a href="https://github.com/lorihollasch">Lori Whippler Hollasch</a>
</li>
  <li class="minus"><a href="https://github.com/ronaldfw">Ronald Wotzlaw</a></li></ul>

<p></p><p>

</p></div>

<p></p><p>

</p><div class="credit-list"> <strong class="asterisk">Corrections and Improvements</strong>

<p></p><p>

</p><ul>
  <li class="minus"><a href="https://github.com/jammm">Aaryaman Vasishta</a>
</li>
  <li class="minus">Andrew Kensler
</li>
  <li class="minus"><a href="https://github.com/antoniogamiz">Antonio Gamiz</a>
</li>
  <li class="minus">Apoorva Joshi
</li>
  <li class="minus"><a href="https://github.com/aras-p">Aras Pranckevičius</a>
</li>
  <li class="minus">Becker
</li>
  <li class="minus">Ben Kerl
</li>
  <li class="minus">Benjamin Summerton
</li>
  <li class="minus">Bennett Hardwick
</li>
  <li class="minus">Dan Drummond
</li>
  <li class="minus"><a href="https://github.com/dafhi">David Chambers</a>
</li>
  <li class="minus">David Hart
</li>
  <li class="minus"><a href="https://github.com/erich666">Eric Haines</a>
</li>
  <li class="minus">Fabio Sancinetti
</li>
  <li class="minus">Filipe Scur
</li>
  <li class="minus">Frank He
</li>
  <li class="minus"><a href="https://github.com/celeph">Gerrit Wessendorf</a>
</li>
  <li class="minus">Grue Debry
</li>
  <li class="minus">Ingo Wald
</li>
  <li class="minus">Jason Stone
</li>
  <li class="minus">Jean Buckley
</li>
  <li class="minus">Joey Cho
</li>
  <li class="minus"><a href="https://github.com/rjkilpatrick">John Kilpatrick</a>
</li>
  <li class="minus"><a href="https://github.com/D-K-E">Kaan Eraslan</a>
</li>
  <li class="minus"><a href="https://github.com/lmancini">Lorenzo Mancini</a>
</li>
  <li class="minus"><a href="https://github.com/manas96">Manas Kale</a>
</li>
  <li class="minus">Marcus Ottosson
</li>
  <li class="minus"><a href="https://github.com/mrmcsoftware">Mark Craig</a>
</li>
  <li class="minus">Matthew Heimlich
</li>
  <li class="minus">Nakata Daisuke
</li>
  <li class="minus">Paul Melis
</li>
  <li class="minus">Phil Cristensen
</li>
  <li class="minus"><a href="https://github.com/ronaldfw">Ronald Wotzlaw</a>
</li>
  <li class="minus"><a href="https://github.com/shaunplee">Shaun P. Lee</a>
</li>
  <li class="minus"><a href="https://github.com/estshorter">Shota Kawajiri</a>
</li>
  <li class="minus">Tatsuya Ogawa
</li>
  <li class="minus">Thiago Ize
</li>
  <li class="minus">Vahan Sosoyan
</li>
  <li class="minus"><a href="https://github.com/oxine">ZeHao Chen</a></li></ul>

<p></p><p>

</p></div>

<p></p><p>

</p><div class="credit-list"> <strong class="asterisk">Special Thanks</strong>

<p></p><p>

  </p><div class="indented">
  Thanks to the team at <a href="https://limnu.com/">Limnu</a> for help on the figures.

<p></p><p>

  These books are entirely written in Morgan McGuire's fantastic and free
  <a href="https://casual-effects.com/markdeep/">Markdeep</a> library. To see what this looks like, view the
  page source from your browser.

</p><p>

  Thanks to <a href="https://github.com/hhu">Helen Hu</a> for graciously donating her
  <a href="https://github.com/RayTracing/" class="url">https://github.com/RayTracing/</a> GitHub organization to this project.

</p><p>

  </p></div>
</div>

<p></p><p>

<link rel="stylesheet" href="./Ray Tracing in One Weekend_files/book.css">

</p>
<a class="target" name="citingthisbook">&nbsp;</a><a class="target" name="citingthisbook">&nbsp;</a><a class="target" name="toc15">&nbsp;</a><h1>Citing This Book</h1>
<p>

Consistent citations make it easier to identify the source, location and versions of this work. If
you are citing this book, we ask that you try to use one of the following forms if possible.

</p>
<a class="target" name="basicdata">&nbsp;</a><a class="target" name="citingthisbook/basicdata">&nbsp;</a><a class="target" name="toc15.1">&nbsp;</a><h2>Basic Data</h2>
<p>


</p><ul>
  <li class="minus"><strong class="asterisk">Title (series)</strong>: “Ray Tracing in One Weekend Series”
</li>
  <li class="minus"><strong class="asterisk">Title (book)</strong>: “Ray Tracing in One Weekend”
</li>
  <li class="minus"><strong class="asterisk">Author</strong>: Peter Shirley
</li>
  <li class="minus"><strong class="asterisk">Editors</strong>: Steve Hollasch, Trevor David Black
</li>
  <li class="minus"><strong class="asterisk">Version/Edition</strong>: v3.2.3
</li>
  <li class="minus"><strong class="asterisk">Date</strong>: 2020-12-07
</li>
  <li class="minus"><strong class="asterisk">URL (series)</strong>: <a href="https://raytracing.github.io/" class="url">https://raytracing.github.io/</a>
</li>
  <li class="minus"><strong class="asterisk">URL (book)</strong>: <a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html" class="url">https://raytracing.github.io/books/RayTracingInOneWeekend.html</a></li></ul>

<p></p>
<a class="target" name="snippets">&nbsp;</a><a class="target" name="citingthisbook/snippets">&nbsp;</a><a class="target" name="toc15.2">&nbsp;</a><h2>Snippets</h2>

<a class="target" name="markdown">&nbsp;</a><a class="target" name="citingthisbook/snippets/markdown">&nbsp;</a><a class="target" name="toc15.2.1">&nbsp;</a><h3>Markdown</h3>
<pre class="listing tilde"><code><span class="line">[<span class="hljs-meta">_Ray Tracing in One Weekend_</span>](https:<span class="hljs-comment">//raytracing.github.io/books/RayTracingInOneWeekend.html)</span></span></code></pre>
<a class="target" name="html">&nbsp;</a><a class="target" name="citingthisbook/snippets/html">&nbsp;</a><a class="target" name="toc15.2.2">&nbsp;</a><h3>HTML</h3>
<pre class="listing tilde"><code><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://raytracing.github.io/books/RayTracingInOneWeekend.html"</span>&gt;</span></span>
<span class="line">    <span class="hljs-tag">&lt;<span class="hljs-name">cite</span>&gt;</span>Ray Tracing in One Weekend<span class="hljs-tag">&lt;/<span class="hljs-name">cite</span>&gt;</span></span>
<span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span></code></pre>
<a class="target" name="latexandbibtex">&nbsp;</a><a class="target" name="citingthisbook/snippets/latexandbibtex">&nbsp;</a><a class="target" name="toc15.2.3">&nbsp;</a><h3>LaTeX and BibTex</h3>
<pre class="listing tilde"><code><span class="line">~\cite{Shirley2020RTW1}</span>
<span class="line"></span>
<span class="line"><span class="hljs-meta">@misc</span>{Shirley2020RTW1,</span>
<span class="line">   title = {Ray Tracing in One Weekend},</span>
<span class="line">   author = {Peter Shirley},</span>
<span class="line">   year = {<span class="hljs-number">2020</span>},</span>
<span class="line">   month = {December},</span>
<span class="line">   note = {\small \texttt{https:<span class="hljs-comment">//raytracing.github.io/books/RayTracingInOneWeekend.html}},</span></span>
<span class="line">   url = {https:<span class="hljs-comment">//raytracing.github.io/books/RayTracingInOneWeekend.html}</span></span>
<span class="line">}</span></code></pre>
<a class="target" name="biblatex">&nbsp;</a><a class="target" name="citingthisbook/snippets/biblatex">&nbsp;</a><a class="target" name="toc15.2.4">&nbsp;</a><h3>BibLaTeX</h3>
<pre class="listing tilde"><code><span class="line">\usepackage{biblatex}</span>
<span class="line"></span>
<span class="line">~\cite{Shirley2020RTW1}</span>
<span class="line"></span>
<span class="line"><span class="hljs-meta">@online</span>{Shirley2020RTW1,</span>
<span class="line">   title = {Ray Tracing in One Weekend},</span>
<span class="line">   author = {Peter Shirley},</span>
<span class="line">   year = {<span class="hljs-number">2020</span>},</span>
<span class="line">   month = {December}</span>
<span class="line">   url = {https:<span class="hljs-comment">//raytracing.github.io/books/RayTracingInOneWeekend.html}</span></span>
<span class="line">}</span></code></pre>
<a class="target" name="ieee">&nbsp;</a><a class="target" name="citingthisbook/snippets/ieee">&nbsp;</a><a class="target" name="toc15.2.5">&nbsp;</a><h3>IEEE</h3>
<pre class="listing tilde"><code><span class="line">“<span class="hljs-selector-tag">Ray</span> <span class="hljs-selector-tag">Tracing</span> <span class="hljs-selector-tag">in</span> <span class="hljs-selector-tag">One</span> <span class="hljs-selector-tag">Weekend</span>.” <span class="hljs-selector-tag">raytracing</span><span class="hljs-selector-class">.github</span><span class="hljs-selector-class">.io</span>/<span class="hljs-selector-tag">books</span>/<span class="hljs-selector-tag">RayTracingInOneWeekend</span><span class="hljs-selector-class">.html</span></span>
<span class="line">(accessed MMM. DD, YYYY)</span></code></pre>
<a class="target" name="mla:">&nbsp;</a><a class="target" name="citingthisbook/snippets/mla:">&nbsp;</a><a class="target" name="toc15.2.6">&nbsp;</a><h3>MLA:</h3>
<pre class="listing tilde"><code><span class="line"><span class="hljs-selector-tag">Ray</span> <span class="hljs-selector-tag">Tracing</span> <span class="hljs-selector-tag">in</span> <span class="hljs-selector-tag">One</span> <span class="hljs-selector-tag">Weekend</span>. <span class="hljs-selector-tag">raytracing</span><span class="hljs-selector-class">.github</span><span class="hljs-selector-class">.io</span>/<span class="hljs-selector-tag">books</span>/<span class="hljs-selector-tag">RayTracingInOneWeekend</span><span class="hljs-selector-class">.html</span></span>
<span class="line"><span class="hljs-selector-tag">Accessed</span> <span class="hljs-selector-tag">DD</span> <span class="hljs-selector-tag">MMM</span>. <span class="hljs-selector-tag">YYYY</span>.</span></code></pre><p>










<link rel="stylesheet" href="./Ray Tracing in One Weekend_files/book.css">

</p><p>

</p></span><div id="mdContextMenu" style="visibility: hidden; left: 829px; top: 58663px;"><div onclick="(location=&quot;https://raytracing.github.io/books/RayTracingInOneWeekend.html#dielectrics/schlickapproximation&quot;)">Visit URL “https:/…end.html#dielectrics/schlickapproximation”</div><div onclick="navigator.clipboard.writeText(&quot;https://raytracing.github.io/books/RayTracingInOneWeekend.html#dielectrics/schlickapproximation&quot;)&amp;&amp;(document.getElementById(&#39;mdContextMenu&#39;).style.visibility=&#39;hidden&#39;)">Copy URL “https:/…end.html#dielectrics/schlickapproximation”</div><div onclick="navigator.clipboard.writeText(&#39;Schlick Approximation subsection&#39;)&amp;&amp;(document.getElementById(&#39;mdContextMenu&#39;).style.visibility=&#39;hidden&#39;)">Copy Markdeep “Schlick Approximation subsection”</div><div onclick="navigator.clipboard.writeText(&#39;Subsection [schlick approximation]&#39;)&amp;&amp;(document.getElementById(&#39;mdContextMenu&#39;).style.visibility=&#39;hidden&#39;)">Copy Markdeep “Subsection [schlick approximation]”</div><div onclick="navigator.clipboard.writeText(&#39;&lt;a href=&quot;https://raytracing.github.io/books/RayTracingInOneWeekend.html#dielectrics/schlickapproximation&quot;&gt;Schlick Approximation&lt;/a&gt;&#39;)&amp;&amp;(document.getElementById(&#39;mdContextMenu&#39;).style.visibility=&#39;hidden&#39;)">Copy HTML “&lt;a href=…&gt;”</div></div><div class="markdeepFooter"><i>formatted by <a href="https://casual-effects.com/markdeep" style="color:#999">Markdeep&nbsp;1.13&nbsp;&nbsp;</a></i><div style="display:inline-block;font-size:13px;font-family:&#39;Times New Roman&#39;,serif;vertical-align:middle;transform:translate(-3px,-1px)rotate(135deg);">✒</div></div><div style="position: absolute; width: 0px; height: 0px; overflow: hidden; padding: 0px; border: 0px; margin: 0px;"><div id="MathJax_Font_Test" style="position: absolute; visibility: hidden; top: 0px; left: 0px; width: auto; min-width: 0px; max-width: none; padding: 0px; border: 0px; margin: 0px; white-space: nowrap; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; font-size: 40px; font-weight: normal; font-style: normal; font-family: MathJax_Size2, sans-serif;"></div></div></body></html>